import{r as x,a as xo,R as Ke,u as He,b as Xe,L as Mt,c as Ft,_ as jt,B as bo,d as So,e as Je}from"./vendor-1754416489227.js";import{C as bn,a as Sn,L as wn,P as Cn,b as vn,p as An,c as Tn,d as Dn,e as wo,B as Co,i as vo,A as Ao}from"./charts-1754416489227.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=r(i);fetch(i.href,s)}})();var kn={exports:{}},ar={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var To=x,Do=Symbol.for("react.element"),ko=Symbol.for("react.fragment"),Eo=Object.prototype.hasOwnProperty,$o=To.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,jo={key:!0,ref:!0,__self:!0,__source:!0};function En(t,e,r){var n,i={},s=null,a=null;r!==void 0&&(s=""+r),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(a=e.ref);for(n in e)Eo.call(e,n)&&!jo.hasOwnProperty(n)&&(i[n]=e[n]);if(t&&t.defaultProps)for(n in e=t.defaultProps,e)i[n]===void 0&&(i[n]=e[n]);return{$$typeof:Do,type:t,key:s,ref:a,props:i,_owner:$o.current}}ar.Fragment=ko;ar.jsx=En;ar.jsxs=En;kn.exports=ar;var o=kn.exports,Dr={},Vr=xo;Dr.createRoot=Vr.createRoot,Dr.hydrateRoot=Vr.hydrateRoot;const yr=!1,No=()=>{const t=new Date,e=t.toTimeString().slice(0,8),r=t.getMilliseconds().toString().padStart(3,"0");return`${e}.${r}`},Ro=t=>{const e=No();return typeof t=="string"?`[${e}] ${t}`:`[${e}]`},l={debug:(t,...e)=>{},info:(t,...e)=>{},warn:(t,...e)=>{},error:(t,...e)=>{console.error(Ro(t),...e)},log:(t,...e)=>{},raw:{log:(...t)=>yr,warn:(...t)=>yr,error:(...t)=>console.error(...t),info:(...t)=>yr},fetch:(t,e="")=>{const n=`✅ ✅ ✅ FETCH ${new Date().toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3})} - ${t}`,i=e?`${n} (${e})`:n;console.log(`%c${i}`,"color: #00ff00; font-weight: bold; font-size: 14px; background: #000; padding: 2px 4px;")}},$n=x.createContext(),qr="rgb(140,185,162)",Po="#8CB9A2",Gr="#e31507",xr="#000",Io="#000000";function Mo(t,e){if(!e)return t;const r=t.trim().toLowerCase();return r===xr||r===Io||r==="black"||r.startsWith("rgb(0,0,0)")?qr:r===qr||r===Po||r.startsWith("rgb(140,185,162)")?xr:r===Gr?Gr:xr}function Fo({children:t}){const[e,r]=x.useState(!1),n=()=>r(i=>!i);return o.jsx($n.Provider,{value:{isInverted:e,toggleTheme:n},children:t})}function Ue(){return x.useContext($n)}function ne(t){const{isInverted:e}=Ue();return Mo(t,e)}function jn(t,e){return function(){return t.apply(e,arguments)}}const{toString:Oo}=Object.prototype,{getPrototypeOf:Br}=Object,{iterator:lr,toStringTag:Nn}=Symbol,cr=(t=>e=>{const r=Oo.call(e);return t[r]||(t[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),Ve=t=>(t=t.toLowerCase(),e=>cr(e)===t),dr=t=>e=>typeof e===t,{isArray:St}=Array,Rt=dr("undefined");function Ot(t){return t!==null&&!Rt(t)&&t.constructor!==null&&!Rt(t.constructor)&&_e(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const Rn=Ve("ArrayBuffer");function Bo(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&Rn(t.buffer),e}const Lo=dr("string"),_e=dr("function"),Pn=dr("number"),Bt=t=>t!==null&&typeof t=="object",_o=t=>t===!0||t===!1,Kt=t=>{if(cr(t)!=="object")return!1;const e=Br(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Nn in t)&&!(lr in t)},zo=t=>{if(!Bt(t)||Ot(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch{return!1}},Uo=Ve("Date"),Wo=Ve("File"),Ho=Ve("Blob"),Vo=Ve("FileList"),qo=t=>Bt(t)&&_e(t.pipe),Go=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||_e(t.append)&&((e=cr(t))==="formdata"||e==="object"&&_e(t.toString)&&t.toString()==="[object FormData]"))},Jo=Ve("URLSearchParams"),[Qo,Yo,Ko,Xo]=["ReadableStream","Request","Response","Headers"].map(Ve),Zo=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Lt(t,e,{allOwnKeys:r=!1}={}){if(t===null||typeof t>"u")return;let n,i;if(typeof t!="object"&&(t=[t]),St(t))for(n=0,i=t.length;n<i;n++)e.call(null,t[n],n,t);else{if(Ot(t))return;const s=r?Object.getOwnPropertyNames(t):Object.keys(t),a=s.length;let c;for(n=0;n<a;n++)c=s[n],e.call(null,t[c],c,t)}}function In(t,e){if(Ot(t))return null;e=e.toLowerCase();const r=Object.keys(t);let n=r.length,i;for(;n-- >0;)if(i=r[n],e===i.toLowerCase())return i;return null}const ct=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Mn=t=>!Rt(t)&&t!==ct;function kr(){const{caseless:t}=Mn(this)&&this||{},e={},r=(n,i)=>{const s=t&&In(e,i)||i;Kt(e[s])&&Kt(n)?e[s]=kr(e[s],n):Kt(n)?e[s]=kr({},n):St(n)?e[s]=n.slice():e[s]=n};for(let n=0,i=arguments.length;n<i;n++)arguments[n]&&Lt(arguments[n],r);return e}const ei=(t,e,r,{allOwnKeys:n}={})=>(Lt(e,(i,s)=>{r&&_e(i)?t[s]=jn(i,r):t[s]=i},{allOwnKeys:n}),t),ti=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),ri=(t,e,r,n)=>{t.prototype=Object.create(e.prototype,n),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),r&&Object.assign(t.prototype,r)},ni=(t,e,r,n)=>{let i,s,a;const c={};if(e=e||{},t==null)return e;do{for(i=Object.getOwnPropertyNames(t),s=i.length;s-- >0;)a=i[s],(!n||n(a,t,e))&&!c[a]&&(e[a]=t[a],c[a]=!0);t=r!==!1&&Br(t)}while(t&&(!r||r(t,e))&&t!==Object.prototype);return e},oi=(t,e,r)=>{t=String(t),(r===void 0||r>t.length)&&(r=t.length),r-=e.length;const n=t.indexOf(e,r);return n!==-1&&n===r},ii=t=>{if(!t)return null;if(St(t))return t;let e=t.length;if(!Pn(e))return null;const r=new Array(e);for(;e-- >0;)r[e]=t[e];return r},si=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&Br(Uint8Array)),ai=(t,e)=>{const n=(t&&t[lr]).call(t);let i;for(;(i=n.next())&&!i.done;){const s=i.value;e.call(t,s[0],s[1])}},li=(t,e)=>{let r;const n=[];for(;(r=t.exec(e))!==null;)n.push(r);return n},ci=Ve("HTMLFormElement"),di=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,n,i){return n.toUpperCase()+i}),Jr=(({hasOwnProperty:t})=>(e,r)=>t.call(e,r))(Object.prototype),ui=Ve("RegExp"),Fn=(t,e)=>{const r=Object.getOwnPropertyDescriptors(t),n={};Lt(r,(i,s)=>{let a;(a=e(i,s,t))!==!1&&(n[s]=a||i)}),Object.defineProperties(t,n)},pi=t=>{Fn(t,(e,r)=>{if(_e(t)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const n=t[r];if(_e(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},gi=(t,e)=>{const r={},n=i=>{i.forEach(s=>{r[s]=!0})};return St(t)?n(t):n(String(t).split(e)),r},hi=()=>{},fi=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e;function mi(t){return!!(t&&_e(t.append)&&t[Nn]==="FormData"&&t[lr])}const yi=t=>{const e=new Array(10),r=(n,i)=>{if(Bt(n)){if(e.indexOf(n)>=0)return;if(Ot(n))return n;if(!("toJSON"in n)){e[i]=n;const s=St(n)?[]:{};return Lt(n,(a,c)=>{const u=r(a,i+1);!Rt(u)&&(s[c]=u)}),e[i]=void 0,s}}return n};return r(t,0)},xi=Ve("AsyncFunction"),bi=t=>t&&(Bt(t)||_e(t))&&_e(t.then)&&_e(t.catch),On=((t,e)=>t?setImmediate:e?((r,n)=>(ct.addEventListener("message",({source:i,data:s})=>{i===ct&&s===r&&n.length&&n.shift()()},!1),i=>{n.push(i),ct.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",_e(ct.postMessage)),Si=typeof queueMicrotask<"u"?queueMicrotask.bind(ct):typeof process<"u"&&process.nextTick||On,wi=t=>t!=null&&_e(t[lr]),j={isArray:St,isArrayBuffer:Rn,isBuffer:Ot,isFormData:Go,isArrayBufferView:Bo,isString:Lo,isNumber:Pn,isBoolean:_o,isObject:Bt,isPlainObject:Kt,isEmptyObject:zo,isReadableStream:Qo,isRequest:Yo,isResponse:Ko,isHeaders:Xo,isUndefined:Rt,isDate:Uo,isFile:Wo,isBlob:Ho,isRegExp:ui,isFunction:_e,isStream:qo,isURLSearchParams:Jo,isTypedArray:si,isFileList:Vo,forEach:Lt,merge:kr,extend:ei,trim:Zo,stripBOM:ti,inherits:ri,toFlatObject:ni,kindOf:cr,kindOfTest:Ve,endsWith:oi,toArray:ii,forEachEntry:ai,matchAll:li,isHTMLForm:ci,hasOwnProperty:Jr,hasOwnProp:Jr,reduceDescriptors:Fn,freezeMethods:pi,toObjectSet:gi,toCamelCase:di,noop:hi,toFiniteNumber:fi,findKey:In,global:ct,isContextDefined:Mn,isSpecCompliantForm:mi,toJSONObject:yi,isAsyncFn:xi,isThenable:bi,setImmediate:On,asap:Si,isIterable:wi};function ue(t,e,r,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i,this.status=i.status?i.status:null)}j.inherits(ue,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:j.toJSONObject(this.config),code:this.code,status:this.status}}});const Bn=ue.prototype,Ln={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{Ln[t]={value:t}});Object.defineProperties(ue,Ln);Object.defineProperty(Bn,"isAxiosError",{value:!0});ue.from=(t,e,r,n,i,s)=>{const a=Object.create(Bn);return j.toFlatObject(t,a,function(u){return u!==Error.prototype},c=>c!=="isAxiosError"),ue.call(a,t.message,e,r,n,i),a.cause=t,a.name=t.name,s&&Object.assign(a,s),a};const Ci=null;function Er(t){return j.isPlainObject(t)||j.isArray(t)}function _n(t){return j.endsWith(t,"[]")?t.slice(0,-2):t}function Qr(t,e,r){return t?t.concat(e).map(function(i,s){return i=_n(i),!r&&s?"["+i+"]":i}).join(r?".":""):e}function vi(t){return j.isArray(t)&&!t.some(Er)}const Ai=j.toFlatObject(j,{},null,function(e){return/^is[A-Z]/.test(e)});function ur(t,e,r){if(!j.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,r=j.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,S){return!j.isUndefined(S[m])});const n=r.metaTokens,i=r.visitor||d,s=r.dots,a=r.indexes,u=(r.Blob||typeof Blob<"u"&&Blob)&&j.isSpecCompliantForm(e);if(!j.isFunction(i))throw new TypeError("visitor must be a function");function p(f){if(f===null)return"";if(j.isDate(f))return f.toISOString();if(j.isBoolean(f))return f.toString();if(!u&&j.isBlob(f))throw new ue("Blob is not supported. Use a Buffer instead.");return j.isArrayBuffer(f)||j.isTypedArray(f)?u&&typeof Blob=="function"?new Blob([f]):Buffer.from(f):f}function d(f,m,S){let y=f;if(f&&!S&&typeof f=="object"){if(j.endsWith(m,"{}"))m=n?m:m.slice(0,-2),f=JSON.stringify(f);else if(j.isArray(f)&&vi(f)||(j.isFileList(f)||j.endsWith(m,"[]"))&&(y=j.toArray(f)))return m=_n(m),y.forEach(function(L,N){!(j.isUndefined(L)||L===null)&&e.append(a===!0?Qr([m],N,s):a===null?m:m+"[]",p(L))}),!1}return Er(f)?!0:(e.append(Qr(S,m,s),p(f)),!1)}const h=[],C=Object.assign(Ai,{defaultVisitor:d,convertValue:p,isVisitable:Er});function k(f,m){if(!j.isUndefined(f)){if(h.indexOf(f)!==-1)throw Error("Circular reference detected in "+m.join("."));h.push(f),j.forEach(f,function(y,v){(!(j.isUndefined(y)||y===null)&&i.call(e,y,j.isString(v)?v.trim():v,m,C))===!0&&k(y,m?m.concat(v):[v])}),h.pop()}}if(!j.isObject(t))throw new TypeError("data must be an object");return k(t),e}function Yr(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function Lr(t,e){this._pairs=[],t&&ur(t,this,e)}const zn=Lr.prototype;zn.append=function(e,r){this._pairs.push([e,r])};zn.toString=function(e){const r=e?function(n){return e.call(this,n,Yr)}:Yr;return this._pairs.map(function(i){return r(i[0])+"="+r(i[1])},"").join("&")};function Ti(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Un(t,e,r){if(!e)return t;const n=r&&r.encode||Ti;j.isFunction(r)&&(r={serialize:r});const i=r&&r.serialize;let s;if(i?s=i(e,r):s=j.isURLSearchParams(e)?e.toString():new Lr(e,r).toString(n),s){const a=t.indexOf("#");a!==-1&&(t=t.slice(0,a)),t+=(t.indexOf("?")===-1?"?":"&")+s}return t}class Kr{constructor(){this.handlers=[]}use(e,r,n){return this.handlers.push({fulfilled:e,rejected:r,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){j.forEach(this.handlers,function(n){n!==null&&e(n)})}}const Wn={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Di=typeof URLSearchParams<"u"?URLSearchParams:Lr,ki=typeof FormData<"u"?FormData:null,Ei=typeof Blob<"u"?Blob:null,$i={isBrowser:!0,classes:{URLSearchParams:Di,FormData:ki,Blob:Ei},protocols:["http","https","file","blob","url","data"]},_r=typeof window<"u"&&typeof document<"u",$r=typeof navigator=="object"&&navigator||void 0,ji=_r&&(!$r||["ReactNative","NativeScript","NS"].indexOf($r.product)<0),Ni=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Ri=_r&&window.location.href||"http://localhost",Pi=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:_r,hasStandardBrowserEnv:ji,hasStandardBrowserWebWorkerEnv:Ni,navigator:$r,origin:Ri},Symbol.toStringTag,{value:"Module"})),Pe={...Pi,...$i};function Ii(t,e){return ur(t,new Pe.classes.URLSearchParams,{visitor:function(r,n,i,s){return Pe.isNode&&j.isBuffer(r)?(this.append(n,r.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)},...e})}function Mi(t){return j.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Fi(t){const e={},r=Object.keys(t);let n;const i=r.length;let s;for(n=0;n<i;n++)s=r[n],e[s]=t[s];return e}function Hn(t){function e(r,n,i,s){let a=r[s++];if(a==="__proto__")return!0;const c=Number.isFinite(+a),u=s>=r.length;return a=!a&&j.isArray(i)?i.length:a,u?(j.hasOwnProp(i,a)?i[a]=[i[a],n]:i[a]=n,!c):((!i[a]||!j.isObject(i[a]))&&(i[a]=[]),e(r,n,i[a],s)&&j.isArray(i[a])&&(i[a]=Fi(i[a])),!c)}if(j.isFormData(t)&&j.isFunction(t.entries)){const r={};return j.forEachEntry(t,(n,i)=>{e(Mi(n),i,r,0)}),r}return null}function Oi(t,e,r){if(j.isString(t))try{return(e||JSON.parse)(t),j.trim(t)}catch(n){if(n.name!=="SyntaxError")throw n}return(r||JSON.stringify)(t)}const _t={transitional:Wn,adapter:["xhr","http","fetch"],transformRequest:[function(e,r){const n=r.getContentType()||"",i=n.indexOf("application/json")>-1,s=j.isObject(e);if(s&&j.isHTMLForm(e)&&(e=new FormData(e)),j.isFormData(e))return i?JSON.stringify(Hn(e)):e;if(j.isArrayBuffer(e)||j.isBuffer(e)||j.isStream(e)||j.isFile(e)||j.isBlob(e)||j.isReadableStream(e))return e;if(j.isArrayBufferView(e))return e.buffer;if(j.isURLSearchParams(e))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let c;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Ii(e,this.formSerializer).toString();if((c=j.isFileList(e))||n.indexOf("multipart/form-data")>-1){const u=this.env&&this.env.FormData;return ur(c?{"files[]":e}:e,u&&new u,this.formSerializer)}}return s||i?(r.setContentType("application/json",!1),Oi(e)):e}],transformResponse:[function(e){const r=this.transitional||_t.transitional,n=r&&r.forcedJSONParsing,i=this.responseType==="json";if(j.isResponse(e)||j.isReadableStream(e))return e;if(e&&j.isString(e)&&(n&&!this.responseType||i)){const a=!(r&&r.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(c){if(a)throw c.name==="SyntaxError"?ue.from(c,ue.ERR_BAD_RESPONSE,this,null,this.response):c}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Pe.classes.FormData,Blob:Pe.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};j.forEach(["delete","get","head","post","put","patch"],t=>{_t.headers[t]={}});const Bi=j.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Li=t=>{const e={};let r,n,i;return t&&t.split(`
`).forEach(function(a){i=a.indexOf(":"),r=a.substring(0,i).trim().toLowerCase(),n=a.substring(i+1).trim(),!(!r||e[r]&&Bi[r])&&(r==="set-cookie"?e[r]?e[r].push(n):e[r]=[n]:e[r]=e[r]?e[r]+", "+n:n)}),e},Xr=Symbol("internals");function Tt(t){return t&&String(t).trim().toLowerCase()}function Xt(t){return t===!1||t==null?t:j.isArray(t)?t.map(Xt):String(t)}function _i(t){const e=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(t);)e[n[1]]=n[2];return e}const zi=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function br(t,e,r,n,i){if(j.isFunction(n))return n.call(this,e,r);if(i&&(e=r),!!j.isString(e)){if(j.isString(n))return e.indexOf(n)!==-1;if(j.isRegExp(n))return n.test(e)}}function Ui(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,r,n)=>r.toUpperCase()+n)}function Wi(t,e){const r=j.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(t,n+r,{value:function(i,s,a){return this[n].call(this,e,i,s,a)},configurable:!0})})}let ze=class{constructor(e){e&&this.set(e)}set(e,r,n){const i=this;function s(c,u,p){const d=Tt(u);if(!d)throw new Error("header name must be a non-empty string");const h=j.findKey(i,d);(!h||i[h]===void 0||p===!0||p===void 0&&i[h]!==!1)&&(i[h||u]=Xt(c))}const a=(c,u)=>j.forEach(c,(p,d)=>s(p,d,u));if(j.isPlainObject(e)||e instanceof this.constructor)a(e,r);else if(j.isString(e)&&(e=e.trim())&&!zi(e))a(Li(e),r);else if(j.isObject(e)&&j.isIterable(e)){let c={},u,p;for(const d of e){if(!j.isArray(d))throw TypeError("Object iterator must return a key-value pair");c[p=d[0]]=(u=c[p])?j.isArray(u)?[...u,d[1]]:[u,d[1]]:d[1]}a(c,r)}else e!=null&&s(r,e,n);return this}get(e,r){if(e=Tt(e),e){const n=j.findKey(this,e);if(n){const i=this[n];if(!r)return i;if(r===!0)return _i(i);if(j.isFunction(r))return r.call(this,i,n);if(j.isRegExp(r))return r.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,r){if(e=Tt(e),e){const n=j.findKey(this,e);return!!(n&&this[n]!==void 0&&(!r||br(this,this[n],n,r)))}return!1}delete(e,r){const n=this;let i=!1;function s(a){if(a=Tt(a),a){const c=j.findKey(n,a);c&&(!r||br(n,n[c],c,r))&&(delete n[c],i=!0)}}return j.isArray(e)?e.forEach(s):s(e),i}clear(e){const r=Object.keys(this);let n=r.length,i=!1;for(;n--;){const s=r[n];(!e||br(this,this[s],s,e,!0))&&(delete this[s],i=!0)}return i}normalize(e){const r=this,n={};return j.forEach(this,(i,s)=>{const a=j.findKey(n,s);if(a){r[a]=Xt(i),delete r[s];return}const c=e?Ui(s):String(s).trim();c!==s&&delete r[s],r[c]=Xt(i),n[c]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const r=Object.create(null);return j.forEach(this,(n,i)=>{n!=null&&n!==!1&&(r[i]=e&&j.isArray(n)?n.join(", "):n)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,r])=>e+": "+r).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...r){const n=new this(e);return r.forEach(i=>n.set(i)),n}static accessor(e){const n=(this[Xr]=this[Xr]={accessors:{}}).accessors,i=this.prototype;function s(a){const c=Tt(a);n[c]||(Wi(i,a),n[c]=!0)}return j.isArray(e)?e.forEach(s):s(e),this}};ze.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);j.reduceDescriptors(ze.prototype,({value:t},e)=>{let r=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(n){this[r]=n}}});j.freezeMethods(ze);function Sr(t,e){const r=this||_t,n=e||r,i=ze.from(n.headers);let s=n.data;return j.forEach(t,function(c){s=c.call(r,s,i.normalize(),e?e.status:void 0)}),i.normalize(),s}function Vn(t){return!!(t&&t.__CANCEL__)}function wt(t,e,r){ue.call(this,t??"canceled",ue.ERR_CANCELED,e,r),this.name="CanceledError"}j.inherits(wt,ue,{__CANCEL__:!0});function qn(t,e,r){const n=r.config.validateStatus;!r.status||!n||n(r.status)?t(r):e(new ue("Request failed with status code "+r.status,[ue.ERR_BAD_REQUEST,ue.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function Hi(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function Vi(t,e){t=t||10;const r=new Array(t),n=new Array(t);let i=0,s=0,a;return e=e!==void 0?e:1e3,function(u){const p=Date.now(),d=n[s];a||(a=p),r[i]=u,n[i]=p;let h=s,C=0;for(;h!==i;)C+=r[h++],h=h%t;if(i=(i+1)%t,i===s&&(s=(s+1)%t),p-a<e)return;const k=d&&p-d;return k?Math.round(C*1e3/k):void 0}}function qi(t,e){let r=0,n=1e3/e,i,s;const a=(p,d=Date.now())=>{r=d,i=null,s&&(clearTimeout(s),s=null),t(...p)};return[(...p)=>{const d=Date.now(),h=d-r;h>=n?a(p,d):(i=p,s||(s=setTimeout(()=>{s=null,a(i)},n-h)))},()=>i&&a(i)]}const rr=(t,e,r=3)=>{let n=0;const i=Vi(50,250);return qi(s=>{const a=s.loaded,c=s.lengthComputable?s.total:void 0,u=a-n,p=i(u),d=a<=c;n=a;const h={loaded:a,total:c,progress:c?a/c:void 0,bytes:u,rate:p||void 0,estimated:p&&c&&d?(c-a)/p:void 0,event:s,lengthComputable:c!=null,[e?"download":"upload"]:!0};t(h)},r)},Zr=(t,e)=>{const r=t!=null;return[n=>e[0]({lengthComputable:r,total:t,loaded:n}),e[1]]},en=t=>(...e)=>j.asap(()=>t(...e)),Gi=Pe.hasStandardBrowserEnv?((t,e)=>r=>(r=new URL(r,Pe.origin),t.protocol===r.protocol&&t.host===r.host&&(e||t.port===r.port)))(new URL(Pe.origin),Pe.navigator&&/(msie|trident)/i.test(Pe.navigator.userAgent)):()=>!0,Ji=Pe.hasStandardBrowserEnv?{write(t,e,r,n,i,s){const a=[t+"="+encodeURIComponent(e)];j.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),j.isString(n)&&a.push("path="+n),j.isString(i)&&a.push("domain="+i),s===!0&&a.push("secure"),document.cookie=a.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Qi(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function Yi(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function Gn(t,e,r){let n=!Qi(e);return t&&(n||r==!1)?Yi(t,e):e}const tn=t=>t instanceof ze?{...t}:t;function ut(t,e){e=e||{};const r={};function n(p,d,h,C){return j.isPlainObject(p)&&j.isPlainObject(d)?j.merge.call({caseless:C},p,d):j.isPlainObject(d)?j.merge({},d):j.isArray(d)?d.slice():d}function i(p,d,h,C){if(j.isUndefined(d)){if(!j.isUndefined(p))return n(void 0,p,h,C)}else return n(p,d,h,C)}function s(p,d){if(!j.isUndefined(d))return n(void 0,d)}function a(p,d){if(j.isUndefined(d)){if(!j.isUndefined(p))return n(void 0,p)}else return n(void 0,d)}function c(p,d,h){if(h in e)return n(p,d);if(h in t)return n(void 0,p)}const u={url:s,method:s,data:s,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:c,headers:(p,d,h)=>i(tn(p),tn(d),h,!0)};return j.forEach(Object.keys({...t,...e}),function(d){const h=u[d]||i,C=h(t[d],e[d],d);j.isUndefined(C)&&h!==c||(r[d]=C)}),r}const Jn=t=>{const e=ut({},t);let{data:r,withXSRFToken:n,xsrfHeaderName:i,xsrfCookieName:s,headers:a,auth:c}=e;e.headers=a=ze.from(a),e.url=Un(Gn(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),c&&a.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):"")));let u;if(j.isFormData(r)){if(Pe.hasStandardBrowserEnv||Pe.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if((u=a.getContentType())!==!1){const[p,...d]=u?u.split(";").map(h=>h.trim()).filter(Boolean):[];a.setContentType([p||"multipart/form-data",...d].join("; "))}}if(Pe.hasStandardBrowserEnv&&(n&&j.isFunction(n)&&(n=n(e)),n||n!==!1&&Gi(e.url))){const p=i&&s&&Ji.read(s);p&&a.set(i,p)}return e},Ki=typeof XMLHttpRequest<"u",Xi=Ki&&function(t){return new Promise(function(r,n){const i=Jn(t);let s=i.data;const a=ze.from(i.headers).normalize();let{responseType:c,onUploadProgress:u,onDownloadProgress:p}=i,d,h,C,k,f;function m(){k&&k(),f&&f(),i.cancelToken&&i.cancelToken.unsubscribe(d),i.signal&&i.signal.removeEventListener("abort",d)}let S=new XMLHttpRequest;S.open(i.method.toUpperCase(),i.url,!0),S.timeout=i.timeout;function y(){if(!S)return;const L=ze.from("getAllResponseHeaders"in S&&S.getAllResponseHeaders()),K={data:!c||c==="text"||c==="json"?S.responseText:S.response,status:S.status,statusText:S.statusText,headers:L,config:t,request:S};qn(function(J){r(J),m()},function(J){n(J),m()},K),S=null}"onloadend"in S?S.onloadend=y:S.onreadystatechange=function(){!S||S.readyState!==4||S.status===0&&!(S.responseURL&&S.responseURL.indexOf("file:")===0)||setTimeout(y)},S.onabort=function(){S&&(n(new ue("Request aborted",ue.ECONNABORTED,t,S)),S=null)},S.onerror=function(){n(new ue("Network Error",ue.ERR_NETWORK,t,S)),S=null},S.ontimeout=function(){let N=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const K=i.transitional||Wn;i.timeoutErrorMessage&&(N=i.timeoutErrorMessage),n(new ue(N,K.clarifyTimeoutError?ue.ETIMEDOUT:ue.ECONNABORTED,t,S)),S=null},s===void 0&&a.setContentType(null),"setRequestHeader"in S&&j.forEach(a.toJSON(),function(N,K){S.setRequestHeader(K,N)}),j.isUndefined(i.withCredentials)||(S.withCredentials=!!i.withCredentials),c&&c!=="json"&&(S.responseType=i.responseType),p&&([C,f]=rr(p,!0),S.addEventListener("progress",C)),u&&S.upload&&([h,k]=rr(u),S.upload.addEventListener("progress",h),S.upload.addEventListener("loadend",k)),(i.cancelToken||i.signal)&&(d=L=>{S&&(n(!L||L.type?new wt(null,t,S):L),S.abort(),S=null)},i.cancelToken&&i.cancelToken.subscribe(d),i.signal&&(i.signal.aborted?d():i.signal.addEventListener("abort",d)));const v=Hi(i.url);if(v&&Pe.protocols.indexOf(v)===-1){n(new ue("Unsupported protocol "+v+":",ue.ERR_BAD_REQUEST,t));return}S.send(s||null)})},Zi=(t,e)=>{const{length:r}=t=t?t.filter(Boolean):[];if(e||r){let n=new AbortController,i;const s=function(p){if(!i){i=!0,c();const d=p instanceof Error?p:this.reason;n.abort(d instanceof ue?d:new wt(d instanceof Error?d.message:d))}};let a=e&&setTimeout(()=>{a=null,s(new ue(`timeout ${e} of ms exceeded`,ue.ETIMEDOUT))},e);const c=()=>{t&&(a&&clearTimeout(a),a=null,t.forEach(p=>{p.unsubscribe?p.unsubscribe(s):p.removeEventListener("abort",s)}),t=null)};t.forEach(p=>p.addEventListener("abort",s));const{signal:u}=n;return u.unsubscribe=()=>j.asap(c),u}},es=function*(t,e){let r=t.byteLength;if(r<e){yield t;return}let n=0,i;for(;n<r;)i=n+e,yield t.slice(n,i),n=i},ts=async function*(t,e){for await(const r of rs(t))yield*es(r,e)},rs=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:r,value:n}=await e.read();if(r)break;yield n}}finally{await e.cancel()}},rn=(t,e,r,n)=>{const i=ts(t,e);let s=0,a,c=u=>{a||(a=!0,n&&n(u))};return new ReadableStream({async pull(u){try{const{done:p,value:d}=await i.next();if(p){c(),u.close();return}let h=d.byteLength;if(r){let C=s+=h;r(C)}u.enqueue(new Uint8Array(d))}catch(p){throw c(p),p}},cancel(u){return c(u),i.return()}},{highWaterMark:2})},pr=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Qn=pr&&typeof ReadableStream=="function",ns=pr&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),Yn=(t,...e)=>{try{return!!t(...e)}catch{return!1}},os=Qn&&Yn(()=>{let t=!1;const e=new Request(Pe.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),nn=64*1024,jr=Qn&&Yn(()=>j.isReadableStream(new Response("").body)),nr={stream:jr&&(t=>t.body)};pr&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!nr[e]&&(nr[e]=j.isFunction(t[e])?r=>r[e]():(r,n)=>{throw new ue(`Response type '${e}' is not supported`,ue.ERR_NOT_SUPPORT,n)})})})(new Response);const is=async t=>{if(t==null)return 0;if(j.isBlob(t))return t.size;if(j.isSpecCompliantForm(t))return(await new Request(Pe.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(j.isArrayBufferView(t)||j.isArrayBuffer(t))return t.byteLength;if(j.isURLSearchParams(t)&&(t=t+""),j.isString(t))return(await ns(t)).byteLength},ss=async(t,e)=>{const r=j.toFiniteNumber(t.getContentLength());return r??is(e)},as=pr&&(async t=>{let{url:e,method:r,data:n,signal:i,cancelToken:s,timeout:a,onDownloadProgress:c,onUploadProgress:u,responseType:p,headers:d,withCredentials:h="same-origin",fetchOptions:C}=Jn(t);p=p?(p+"").toLowerCase():"text";let k=Zi([i,s&&s.toAbortSignal()],a),f;const m=k&&k.unsubscribe&&(()=>{k.unsubscribe()});let S;try{if(u&&os&&r!=="get"&&r!=="head"&&(S=await ss(d,n))!==0){let K=new Request(e,{method:"POST",body:n,duplex:"half"}),se;if(j.isFormData(n)&&(se=K.headers.get("content-type"))&&d.setContentType(se),K.body){const[J,z]=Zr(S,rr(en(u)));n=rn(K.body,nn,J,z)}}j.isString(h)||(h=h?"include":"omit");const y="credentials"in Request.prototype;f=new Request(e,{...C,signal:k,method:r.toUpperCase(),headers:d.normalize().toJSON(),body:n,duplex:"half",credentials:y?h:void 0});let v=await fetch(f,C);const L=jr&&(p==="stream"||p==="response");if(jr&&(c||L&&m)){const K={};["status","statusText","headers"].forEach(R=>{K[R]=v[R]});const se=j.toFiniteNumber(v.headers.get("content-length")),[J,z]=c&&Zr(se,rr(en(c),!0))||[];v=new Response(rn(v.body,nn,J,()=>{z&&z(),m&&m()}),K)}p=p||"text";let N=await nr[j.findKey(nr,p)||"text"](v,t);return!L&&m&&m(),await new Promise((K,se)=>{qn(K,se,{data:N,headers:ze.from(v.headers),status:v.status,statusText:v.statusText,config:t,request:f})})}catch(y){throw m&&m(),y&&y.name==="TypeError"&&/Load failed|fetch/i.test(y.message)?Object.assign(new ue("Network Error",ue.ERR_NETWORK,t,f),{cause:y.cause||y}):ue.from(y,y&&y.code,t,f)}}),Nr={http:Ci,xhr:Xi,fetch:as};j.forEach(Nr,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const on=t=>`- ${t}`,ls=t=>j.isFunction(t)||t===null||t===!1,Kn={getAdapter:t=>{t=j.isArray(t)?t:[t];const{length:e}=t;let r,n;const i={};for(let s=0;s<e;s++){r=t[s];let a;if(n=r,!ls(r)&&(n=Nr[(a=String(r)).toLowerCase()],n===void 0))throw new ue(`Unknown adapter '${a}'`);if(n)break;i[a||"#"+s]=n}if(!n){const s=Object.entries(i).map(([c,u])=>`adapter ${c} `+(u===!1?"is not supported by the environment":"is not available in the build"));let a=e?s.length>1?`since :
`+s.map(on).join(`
`):" "+on(s[0]):"as no adapter specified";throw new ue("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return n},adapters:Nr};function wr(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new wt(null,t)}function sn(t){return wr(t),t.headers=ze.from(t.headers),t.data=Sr.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Kn.getAdapter(t.adapter||_t.adapter)(t).then(function(n){return wr(t),n.data=Sr.call(t,t.transformResponse,n),n.headers=ze.from(n.headers),n},function(n){return Vn(n)||(wr(t),n&&n.response&&(n.response.data=Sr.call(t,t.transformResponse,n.response),n.response.headers=ze.from(n.response.headers))),Promise.reject(n)})}const Xn="1.11.0",gr={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{gr[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});const an={};gr.transitional=function(e,r,n){function i(s,a){return"[Axios v"+Xn+"] Transitional option '"+s+"'"+a+(n?". "+n:"")}return(s,a,c)=>{if(e===!1)throw new ue(i(a," has been removed"+(r?" in "+r:"")),ue.ERR_DEPRECATED);return r&&!an[a]&&(an[a]=!0,console.warn(i(a," has been deprecated since v"+r+" and will be removed in the near future"))),e?e(s,a,c):!0}};gr.spelling=function(e){return(r,n)=>(console.warn(`${n} is likely a misspelling of ${e}`),!0)};function cs(t,e,r){if(typeof t!="object")throw new ue("options must be an object",ue.ERR_BAD_OPTION_VALUE);const n=Object.keys(t);let i=n.length;for(;i-- >0;){const s=n[i],a=e[s];if(a){const c=t[s],u=c===void 0||a(c,s,t);if(u!==!0)throw new ue("option "+s+" must be "+u,ue.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new ue("Unknown option "+s,ue.ERR_BAD_OPTION)}}const Zt={assertOptions:cs,validators:gr},Qe=Zt.validators;let dt=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Kr,response:new Kr}}async request(e,r){try{return await this._request(e,r)}catch(n){if(n instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const s=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?s&&!String(n.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+s):n.stack=s}catch{}}throw n}}_request(e,r){typeof e=="string"?(r=r||{},r.url=e):r=e||{},r=ut(this.defaults,r);const{transitional:n,paramsSerializer:i,headers:s}=r;n!==void 0&&Zt.assertOptions(n,{silentJSONParsing:Qe.transitional(Qe.boolean),forcedJSONParsing:Qe.transitional(Qe.boolean),clarifyTimeoutError:Qe.transitional(Qe.boolean)},!1),i!=null&&(j.isFunction(i)?r.paramsSerializer={serialize:i}:Zt.assertOptions(i,{encode:Qe.function,serialize:Qe.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),Zt.assertOptions(r,{baseUrl:Qe.spelling("baseURL"),withXsrfToken:Qe.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let a=s&&j.merge(s.common,s[r.method]);s&&j.forEach(["delete","get","head","post","put","patch","common"],f=>{delete s[f]}),r.headers=ze.concat(a,s);const c=[];let u=!0;this.interceptors.request.forEach(function(m){typeof m.runWhen=="function"&&m.runWhen(r)===!1||(u=u&&m.synchronous,c.unshift(m.fulfilled,m.rejected))});const p=[];this.interceptors.response.forEach(function(m){p.push(m.fulfilled,m.rejected)});let d,h=0,C;if(!u){const f=[sn.bind(this),void 0];for(f.unshift(...c),f.push(...p),C=f.length,d=Promise.resolve(r);h<C;)d=d.then(f[h++],f[h++]);return d}C=c.length;let k=r;for(h=0;h<C;){const f=c[h++],m=c[h++];try{k=f(k)}catch(S){m.call(this,S);break}}try{d=sn.call(this,k)}catch(f){return Promise.reject(f)}for(h=0,C=p.length;h<C;)d=d.then(p[h++],p[h++]);return d}getUri(e){e=ut(this.defaults,e);const r=Gn(e.baseURL,e.url,e.allowAbsoluteUrls);return Un(r,e.params,e.paramsSerializer)}};j.forEach(["delete","get","head","options"],function(e){dt.prototype[e]=function(r,n){return this.request(ut(n||{},{method:e,url:r,data:(n||{}).data}))}});j.forEach(["post","put","patch"],function(e){function r(n){return function(s,a,c){return this.request(ut(c||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:s,data:a}))}}dt.prototype[e]=r(),dt.prototype[e+"Form"]=r(!0)});let ds=class Zn{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(s){r=s});const n=this;this.promise.then(i=>{if(!n._listeners)return;let s=n._listeners.length;for(;s-- >0;)n._listeners[s](i);n._listeners=null}),this.promise.then=i=>{let s;const a=new Promise(c=>{n.subscribe(c),s=c}).then(i);return a.cancel=function(){n.unsubscribe(s)},a},e(function(s,a,c){n.reason||(n.reason=new wt(s,a,c),r(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const r=this._listeners.indexOf(e);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const e=new AbortController,r=n=>{e.abort(n)};return this.subscribe(r),e.signal.unsubscribe=()=>this.unsubscribe(r),e.signal}static source(){let e;return{token:new Zn(function(i){e=i}),cancel:e}}};function us(t){return function(r){return t.apply(null,r)}}function ps(t){return j.isObject(t)&&t.isAxiosError===!0}const Rr={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Rr).forEach(([t,e])=>{Rr[e]=t});function eo(t){const e=new dt(t),r=jn(dt.prototype.request,e);return j.extend(r,dt.prototype,e,{allOwnKeys:!0}),j.extend(r,e,null,{allOwnKeys:!0}),r.create=function(i){return eo(ut(t,i))},r}const Se=eo(_t);Se.Axios=dt;Se.CanceledError=wt;Se.CancelToken=ds;Se.isCancel=Vn;Se.VERSION=Xn;Se.toFormData=ur;Se.AxiosError=ue;Se.Cancel=Se.CanceledError;Se.all=function(e){return Promise.all(e)};Se.spread=us;Se.isAxiosError=ps;Se.mergeConfig=ut;Se.AxiosHeaders=ze;Se.formToJSON=t=>Hn(j.isHTMLForm(t)?new FormData(t):t);Se.getAdapter=Kn.getAdapter;Se.HttpStatusCode=Rr;Se.default=Se;const{Axios:xl,AxiosError:bl,CanceledError:Sl,isCancel:wl,CancelToken:Cl,VERSION:vl,all:Al,Cancel:Tl,isAxiosError:Dl,spread:kl,toFormData:El,AxiosHeaders:$l,HttpStatusCode:jl,formToJSON:Nl,getAdapter:Rl,mergeConfig:Pl}=Se,gs="/api";async function hs(t){try{t=t.toUpperCase(),l.log(`🌐 Fetching 3 years of 5-minute historical data for ${t}`);const e=new Date,n=new Date(e.getFullYear()-3,e.getMonth(),e.getDate()).toISOString().split("T")[0],i=e.toISOString().split("T")[0],s=`${gs}/twelvedata-historical?symbol=${t}&start_date=${n}&end_date=${i}&interval=5min&outputsize=5000`;l.log(`📡 Requesting historical data: ${t} from ${n} to ${i} (5min intervals)`);const c=(await Se.get(s)).data;if(!c||c.status!=="ok"||!c.historicalData)return l.warn(`❗ No historical data received for ${t}:`,c),[];l.log(`📥 Raw historical data for ${t}: ${c.historicalData.length} datapoints`);const u=c.historicalData.map(p=>({timestamp:p.timestamp,price:parseFloat(p.close||p.price),symbol:p.symbol}));return l.log(`📊 Processed ${u.length} datapoints for ${t} (trading hours filter disabled)`),u}catch(e){return l.error(`❌ fetchThreeYearHistoricalData error for ${t}:`,e),[]}}function Pr(t){if(t.length<2)return!0;for(let e=1;e<t.length;e++){const r=new Date(t[e-1].timestamp),i=(new Date(t[e].timestamp)-r)/(1e3*60);if(i<4||i>6)return l.warn(`⚠️ Irregular spacing detected: ${i.toFixed(1)} minutes between points ${e-1} and ${e}`),!1}return!0}class fs{constructor(){this.maxDataPoints=1e4,this.cleanupDays=1095}saveWatchlistDatapoint(e,r){try{const n=`burnlist_chart_data_${e}`;let i=JSON.parse(localStorage.getItem(n)||"[]");return i.push({timestamp:r.timestamp,averageReturn:r.averageReturn,tickerCount:r.tickerCount,fetchTimestamp:new Date().toISOString()}),i.length>1e3&&(i=i.slice(-1e3)),localStorage.setItem(n,JSON.stringify(i)),console.log(`📊 Saved watchlist datapoint for ${e}: ${r.averageReturn.toFixed(2)}% (${r.tickerCount} tickers)`),!0}catch(n){return console.error(`❌ Error saving watchlist datapoint for ${e}:`,n),!1}}getWatchlistChartData(e,r=1e3){try{const n=`burnlist_chart_data_${e}`;return JSON.parse(localStorage.getItem(n)||"[]").slice(-r)}catch(n){return console.error(`❌ Error getting chart data for ${e}:`,n),[]}}savePriceDatapoint(e,r){const{meta:n,values:i,status:s}=r;if(s!=="ok"||!i||i.length===0)return console.warn(`Invalid Twelve Data response for ${e}`),null;const a=i[0],c=this.convertTwelveDataDateTime(a.datetime,n.exchange_timezone),u=this.alignToFiveMinutes(c);return{price:parseFloat(a.close),timestamp:u,symbol:e}}alignToFiveMinutes(e){const r=new Date(e),n=r.getMinutes(),i=Math.floor(n/5)*5;return r.setMinutes(i,0,0),r.toISOString()}updateTickerHistoricalData(e,r){try{const n=JSON.parse(localStorage.getItem("burnlist_watchlists")||"{}");let i=!1;return Object.values(n).forEach(s=>{if(s.items){const a=s.items.find(c=>c.symbol===e);if(a){a.historicalData||(a.historicalData=[]);const c=a.historicalData.findIndex(u=>{const p=new Date(u.timestamp).getTime(),d=new Date(r.timestamp).getTime();return Math.abs(p-d)/(1e3*60)<5});c===-1?(a.historicalData.push(r),a.historicalData.sort((u,p)=>new Date(u.timestamp)-new Date(p.timestamp)),Pr(a.historicalData)||l.warn(`⚠️ Irregular 5-minute spacing detected for ${e} after update`),a.historicalData.length>this.maxDataPoints&&(a.historicalData=a.historicalData.slice(-this.maxDataPoints)),a.currentPrice=r.price,i=!0):(a.historicalData[c]=r,a.currentPrice=r.price,i=!0)}}}),i&&(localStorage.setItem("burnlist_watchlists",JSON.stringify(n)),console.log(`💾 Updated historical data for ${e} across all watchlists (5-minute aligned)`)),i}catch(n){return console.error(`❌ Error updating historical data for ${e}:`,n),!1}}convertTwelveDataDateTime(e,r="America/New_York"){try{return new Date(e).toISOString()}catch(n){return console.error("Error converting datetime:",n),new Date().toISOString()}}getHistoricalData(e,r=1e4){try{const n=JSON.parse(localStorage.getItem("burnlist_watchlists")||"{}");for(const i of Object.values(n))if(i.items){const s=i.items.find(a=>a.symbol===e);if(s&&s.historicalData)return s.historicalData.slice(-r)}return[]}catch(n){return console.error(`❌ Error getting historical data for ${e}:`,n),[]}}calculateAverageReturn(e,r="1D"){try{const n=this.getHistoricalData(e);if(n.length<2)return null;const i=n[0],s=n[n.length-1];if(!i||!s)return null;const a=i.price,c=s.price;if(a<=0)return null;const u=(c-a)/a*100;return{symbol:e,startPrice:a,endPrice:c,returnPercent:u,timeframe:r,dataPoints:n.length}}catch(n){return console.error(`❌ Error calculating average return for ${e}:`,n),null}}cleanupOldData(){try{const e=JSON.parse(localStorage.getItem("burnlist_watchlists")||"{}"),r=new Date;r.setDate(r.getDate()-this.cleanupDays);let n=0;return Object.values(e).forEach(i=>{i.items&&i.items.forEach(s=>{if(s.historicalData){const a=s.historicalData.length;s.historicalData=s.historicalData.filter(c=>new Date(c.timestamp)>r),n+=a-s.historicalData.length}})}),n>0&&(localStorage.setItem("burnlist_watchlists",JSON.stringify(e)),console.log(`🧹 Cleaned up ${n} old datapoints (3-year retention)`)),n}catch(e){return console.error("❌ Error cleaning up old data:",e),0}}getHistoricalDataStats(){try{const e=JSON.parse(localStorage.getItem("burnlist_watchlists")||"{}"),r={totalTickers:0,tickersWithHistoricalData:0,totalDataPoints:0,averageDataPointsPerTicker:0,oldestDataPoint:null,newestDataPoint:null,fiveMinuteAlignedTickers:0};let n=Date.now(),i=0;return Object.values(e).forEach(s=>{s.items&&s.items.forEach(a=>{r.totalTickers++,a.historicalData&&a.historicalData.length>0&&(r.tickersWithHistoricalData++,r.totalDataPoints+=a.historicalData.length,Pr(a.historicalData)&&r.fiveMinuteAlignedTickers++,a.historicalData.forEach(c=>{const u=new Date(c.timestamp).getTime();u<n&&(n=u,r.oldestDataPoint=c.timestamp),u>i&&(i=u,r.newestDataPoint=c.timestamp)}))})}),r.tickersWithHistoricalData>0&&(r.averageDataPointsPerTicker=Math.round(r.totalDataPoints/r.tickersWithHistoricalData)),r}catch(e){return console.error("❌ Error getting historical data stats:",e),null}}exportHistoricalData(){try{const e=JSON.parse(localStorage.getItem("burnlist_watchlists")||"{}"),r={timestamp:new Date().toISOString(),watchlists:{},stats:this.getHistoricalDataStats()};return Object.entries(e).forEach(([n,i])=>{r.watchlists[n]={name:i.name,slug:i.slug,items:i.items.map(s=>({symbol:s.symbol,buyPrice:s.buyPrice,buyDate:s.buyDate,historicalDataCount:s.historicalData?s.historicalData.length:0,historicalData:s.historicalData||[]}))}}),r}catch(e){return console.error("❌ Error exporting historical data:",e),null}}}const Ir=new fs;class ms{constructor(){this.listeners=new Map,this.lastNAVUpdate=null,this.updateQueue=[],this.isProcessing=!1}subscribe(e,r){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(r),l.debug(`[NAV EVENT] Subscribed to NAV updates for ${e}`),()=>{const n=this.listeners.get(e);n&&(n.delete(r),n.size===0&&this.listeners.delete(e)),l.debug(`[NAV EVENT] Unsubscribed from NAV updates for ${e}`)}}emit(e,r,n="batch"){const i=new Date().toISOString(),s={watchlistSlug:e,navData:r,source:n,timestamp:i,isRealTime:n==="realtime"};this.lastNAVUpdate={watchlistSlug:e,timestamp:i,source:n},this.updateQueue.push(s),l.debug(`[NAV EVENT] Emitting NAV update for ${e} (${n})`),this.isProcessing||this.processQueue()}async processQueue(){if(!(this.isProcessing||this.updateQueue.length===0)){this.isProcessing=!0;try{for(;this.updateQueue.length>0;){const e=this.updateQueue.shift();await this.notifyListeners(e)}}catch(e){l.error("[NAV EVENT] Error processing update queue:",e)}finally{this.isProcessing=!1}}}async notifyListeners(e){const{watchlistSlug:r,navData:n,source:i,timestamp:s,isRealTime:a}=e,c=this.listeners.get(r);if(!c||c.size===0){l.debug(`[NAV EVENT] No listeners for ${r}`);return}l.debug(`[NAV EVENT] Notifying ${c.size} listeners for ${r}`);const u=Array.from(c).map(p=>{try{return p(n,{source:i,timestamp:s,isRealTime:a})}catch(d){return l.error("[NAV EVENT] Error in listener callback:",d),Promise.resolve()}});await Promise.all(u)}getLastUpdate(e){return this.lastNAVUpdate&&this.lastNAVUpdate.watchlistSlug===e?this.lastNAVUpdate:null}isDataStale(e){const r=this.getLastUpdate(e);if(!r)return!0;const n=new Date().getTime(),i=new Date(r.timestamp).getTime(),s=5*60*1e3;return n-i>s}getTimeSinceLastUpdate(e){const r=this.getLastUpdate(e);if(!r)return 1/0;const n=new Date().getTime(),i=new Date(r.timestamp).getTime();return n-i}clear(){this.listeners.clear(),this.updateQueue=[],this.lastNAVUpdate=null,this.isProcessing=!1,l.debug("[NAV EVENT] Cleared all listeners and queue")}getStatus(){const e=Array.from(this.listeners.values()).reduce((n,i)=>n+i.size,0),r=Array.from(this.listeners.keys());return{totalListeners:e,activeWatchlists:r,queueLength:this.updateQueue.length,isProcessing:this.isProcessing,lastUpdate:this.lastNAVUpdate}}}const pt=new ms;class ys{constructor(){this.isRunning=!1,this.alignmentTimer=null,this.lastAlignedTime=null,this.pendingUpdates=new Map,this.updateInterval=5*60*1e3,this.alignmentTolerance=30*1e3}start(){if(this.isRunning){l.warn("[REAL-TIME NAV] Already running");return}this.isRunning=!0,l.log("[REAL-TIME NAV] Starting real-time NAV calculator"),this.alignToNextInterval()}stop(){this.isRunning=!1,this.alignmentTimer&&(clearTimeout(this.alignmentTimer),this.alignmentTimer=null),l.log("[REAL-TIME NAV] Stopped real-time NAV calculator")}alignToNextInterval(){if(!this.isRunning)return;const e=new Date,r=e.getMinutes(),n=e.getSeconds(),i=e.getMilliseconds(),s=5-r%5,c=(s*60-n)*1e3-i;l.debug(`[REAL-TIME NAV] Current time: ${e.toISOString()}`),l.debug(`[REAL-TIME NAV] Minutes to next 5-min boundary: ${s}`),l.debug(`[REAL-TIME NAV] Waiting ${c}ms until next interval`),this.alignmentTimer=setTimeout(()=>{this.performAlignedCalculation()},c)}async performAlignedCalculation(){if(!this.isRunning)return;const e=new Date;this.lastAlignedTime=e,l.log(`[REAL-TIME NAV] Performing aligned calculation at ${e.toISOString()}`);const r=Array.from(this.pendingUpdates.entries()).map(async([n,i])=>{try{await this.calculateAndEmitNAV(n,i.items,i.timeframe,"aligned")}catch(s){l.error(`[REAL-TIME NAV] Error calculating NAV for ${n}:`,s)}});await Promise.all(r),this.pendingUpdates.clear(),this.alignToNextInterval()}queueAlignedCalculation(e,r,n="MAX"){if(!this.isRunning){l.warn("[REAL-TIME NAV] System not running, cannot queue calculation");return}this.pendingUpdates.set(e,{items:r,timeframe:n}),l.debug(`[REAL-TIME NAV] Queued aligned calculation for ${e}`)}async calculateAndEmitNAV(e,r,n="MAX",i="realtime"){if(!r||r.length===0){l.warn(`[REAL-TIME NAV] No items provided for ${e}`);return}try{l.debug(`[REAL-TIME NAV] Calculating NAV for ${e} (${r.length} items, ${n})`);let s=0,a=0;r.forEach(p=>{try{const d=p.historicalData&&p.historicalData.length>0?p.historicalData[p.historicalData.length-1].price:0,h=p.currentPrice||(p.historicalData&&p.historicalData.length>0?p.historicalData[0].price:0);if(d>0&&h>0){const C=(h-d)/d*100;s+=C,a++}}catch(d){l.error(`Error calculating return for ${p.symbol}:`,d)}});const c=a>0?s/a:0,u=[{timestamp:new Date().toISOString(),returnPercent:c,valid:!0,source:i,validTickers:a,totalTickers:r.length}];u&&u.length>0?(pt.emit(e,u,i),l.debug(`[REAL-TIME NAV] Emitted NAV update for ${e} (${u.length} points)`)):l.warn(`[REAL-TIME NAV] No NAV data generated for ${e}`)}catch(s){l.error(`[REAL-TIME NAV] Error calculating NAV for ${e}:`,s)}}async triggerImmediateCalculation(e,r,n="MAX"){if(!this.isRunning){l.warn("[REAL-TIME NAV] System not running, cannot trigger immediate calculation");return}l.debug(`[REAL-TIME NAV] Triggering immediate calculation for ${e}`),await this.calculateAndEmitNAV(e,r,n,"realtime")}isNearBoundary(){const e=new Date,r=e.getMinutes(),n=e.getSeconds(),s=r%5*60+n;return s<=30||s>=270}getNextBoundaryTime(){const e=new Date,n=5-e.getMinutes()%5,i=new Date(e);return i.setMinutes(e.getMinutes()+n,0,0),i}getTimeUntilNextBoundary(){const e=new Date;return this.getNextBoundaryTime().getTime()-e.getTime()}getStatus(){const e=new Date,r=this.getNextBoundaryTime(),n=this.getTimeUntilNextBoundary(),i=this.isNearBoundary();return{isRunning:this.isRunning,lastAlignedTime:this.lastAlignedTime,nextBoundaryTime:r,timeUntilNextBoundary:n,isNearBoundary:i,pendingUpdates:this.pendingUpdates.size,currentTime:e.toISOString()}}}const xt=new ys;bn.register(Sn,wn,Cn,vn,An,Tn,Dn);const Ye="rgb(149,184,163)",Dt="#e31507",xs="#FFD700",bs="#FFA500",Ss="#800080",zr=Ke.memo(({portfolioReturnData:t,watchlistSlug:e,timeframe:r="W",height:n=300,showTooltip:i=!0,mini:s=!1,suppressEmptyMessage:a=!1,hideAxes:c=!1,hideBorder:u=!1,navData:p=[],navMetadata:d={}})=>{ne(Ye),ne("black");const h=ne("#888"),[C,k]=x.useState(null),[f,m]=x.useState(!1),[S,y]=x.useState(null),[v,L]=x.useState([]),N=x.useRef(null),K=x.useRef(null);x.useEffect(()=>{if(e)return l.debug(`[WATCHLIST CHART] Subscribing to real-time updates for ${e}`),N.current=pt.subscribe(e,(E,V)=>{l.debug(`[WATCHLIST CHART] Received NAV update for ${e}`,V);const I=se(E);L(I),k(new Date(V.timestamp)),y(V.source),m(!1)}),K.current=setInterval(()=>{const E=pt.isDataStale(e);m(E)},1e4),()=>{N.current&&(N.current(),N.current=null),K.current&&(clearInterval(K.current),K.current=null)}},[e]);const se=E=>{var W,Q;if(!E||E.length===0)return[];const V=E.filter(_=>_.valid).length,I=E.filter(_=>!_.valid).length,te=E.filter(_=>_.bootstrapped).length,oe=E.filter(_=>_.anomaly).length,F=E.length,Y=E.reduce((_,ie)=>_+(ie.confidenceScore||0),0)/F,P=E.reduce((_,ie)=>_+(ie.fullWeightTickers||0),0)/F,A=E.reduce((_,ie)=>_+(ie.fallbackTickers||0),0)/F,T=((W=E[0])==null?void 0:W.cohortSize)||0;l.debug(`[WATCHLIST CHART] NAV Quality: ${V} valid, ${I} fallback, ${te} bootstrapped, ${oe} anomalies (${(V/F*100).toFixed(1)}% quality, avg confidence: ${Y.toFixed(2)})`),l.debug(`[WATCHLIST CHART] Cohort: ${T} tickers, avg full weight: ${P.toFixed(1)}, avg fallback: ${A.toFixed(1)}`);const $=((Q=E[0])==null?void 0:Q.returnPercent)||0;return l.debug(`[WATCHLIST CHART] Normalizing NAV data - baseline value: ${$.toFixed(2)}%`),E.map((_,ie)=>({timestampValue:new Date(_.timestamp).getTime(),returnPercent:_.returnPercent-$,etfPrice:_.etfPrice||0,xIndex:ie,valid:_.valid,source:_.source,dataCoverage:_.dataCoverage,validTickers:_.validTickers,totalTickers:_.totalTickers,reason:_.reason,bootstrapped:_.bootstrapped,fallbackStrategy:_.fallbackStrategy,confidenceScore:_.confidenceScore,anomaly:_.anomaly,marketStatus:_.marketStatus,volatility:_.volatility,cohortSize:_.cohortSize,fullWeightTickers:_.fullWeightTickers,fallbackTickers:_.fallbackTickers}))},J=x.useMemo(()=>{var E;if(p&&p.length>0)return l.debug(`[WATCHLIST CHART] Using provided navData: ${p.length} points`),p.map((V,I)=>({timestampValue:new Date(V.timestamp).getTime(),returnPercent:V.returnPercent,etfPrice:V.etfPrice||0,xIndex:I,valid:!0,source:"simple-nav",dataCoverage:V.validTickers/V.totalTickers,validTickers:V.validTickers,totalTickers:V.totalTickers,confidenceScore:1}));if(v.length>0)return l.debug(`[WATCHLIST CHART] Using real-time NAV data: ${v.length} points`),v;if(t&&t.length>0){l.debug(`[WATCHLIST CHART] Using NEW NAV Calculator with ${t.length} tickers for timeframe ${r}`);try{let V=0,I=0;t.forEach(oe=>{try{const F=oe.buyPrice||0,Y=oe.currentPrice||(oe.historicalData&&oe.historicalData.length>0?oe.historicalData[0].price:0);if(F>0&&Y>0){const P=(Y-F)/F*100;V+=P,I++}}catch(F){l.error(`Error calculating return for ${oe.symbol}:`,F)}});const te=I>0?V/I:0;return l.debug(`[WATCHLIST CHART] Simple NAV calculation result: ${te.toFixed(2)}%`),[{timestampValue:new Date().getTime(),returnPercent:te,xIndex:0,valid:!0,source:"simple",dataCoverage:I/t.length,validTickers:I,totalTickers:t.length,confidenceScore:1}]}catch(V){l.error(`[WATCHLIST CHART] Error in NAV Calculator for timeframe ${r}:`,V)}}else l.warn(`[WATCHLIST CHART] No portfolio data available for timeframe ${r}`);if(e){const V=Ir.getWatchlistChartData(e);if(V.length>0){l.debug(`[WATCHLIST CHART] Using OLD chart data for ${e}: ${V.length} datapoints`);const I=((E=V[0])==null?void 0:E.averageReturn)||0;return l.debug(`[WATCHLIST CHART] Normalizing OLD chart data - baseline value: ${I.toFixed(2)}%`),V.map((te,oe)=>({timestampValue:new Date(te.timestamp).getTime(),returnPercent:te.averageReturn-I,xIndex:oe,valid:!0,source:"legacy",dataCoverage:1,validTickers:te.tickerCount||0,totalTickers:te.tickerCount||0,confidenceScore:.8}))}else l.warn(`[WATCHLIST CHART] No legacy chart data available for ${e}`)}return l.warn(`[WATCHLIST CHART] No data available for timeframe ${r}, returning empty array`),[]},[t,r,e,v]),z=()=>{if(!C)return"No data";const V=new Date().getTime()-C.getTime(),I=Math.floor(V/(1e3*60));return I<1?`${Math.floor(V/1e3)}s ago`:I<60?`${I}m ago`:`${Math.floor(I/60)}h ago`},R=()=>C?f?Dt:S==="realtime"?Ye:h:h;if(!J||J.length===0)return null;const b=J.map((E,V)=>V),q=J.map(E=>E.returnPercent),D=J.map(E=>Number.isFinite(E.returnPercent)?E.returnPercent:0),M=Math.min(...D),re=Math.max(...D),Z=re-M;let O,w;if(Z===0){const E=M,V=Math.max(Math.abs(E)*.1,.5);O=E-V,w=E+V}else{const E=Math.max(Z*.1,1);O=M-E,w=re+E}if(Math.abs(w-O)<2){const E=(w+O)/2;O=E-1,w=E+1}O>0&&(O=0),w<0&&(w=0);const H={labels:b,datasets:[{label:"ETF NAV",data:q,borderColor:E=>{const V=E.dataIndex;if(V>=0&&V<J.length){const I=J[V],te=I.returnPercent,oe=I.confidenceScore||0;return I.anomaly?Ss:oe<50?xs:I.driftWarning?bs:te>=0?Ye:Dt}return Ye},backgroundColor:"transparent",fill:!1,tension:.4,borderWidth:E=>{const V=E.dataIndex;if(V>=0&&V<J.length){const I=J[V],te=I.confidenceScore||0;return I.anomaly?5:te<30?4:te<50||I.driftWarning?3:2}return 2}}]},U={responsive:!0,maintainAspectRatio:!1,layout:{padding:{left:0,right:0,top:0,bottom:0}},plugins:{legend:{display:!1},tooltip:{enabled:i&&!s,mode:"index",intersect:!1,backgroundColor:"rgba(0,0,0,0.95)",titleColor:E=>!E||!E.tooltipItems||!E.tooltipItems[0]||!E.tooltipItems[0].parsed||E.tooltipItems[0].parsed.y>=0?Ye:Dt,bodyColor:E=>!E||!E.tooltipItems||!E.tooltipItems[0]||!E.tooltipItems[0].parsed||E.tooltipItems[0].parsed.y>=0?Ye:Dt,borderColor:E=>!E||!E.tooltipItems||!E.tooltipItems[0]||!E.tooltipItems[0].parsed||E.tooltipItems[0].parsed.y>=0?Ye:Dt,borderWidth:2,displayColors:!1,padding:8,cornerRadius:6,titleFont:{family:"Courier New",size:15},bodyFont:{family:"Courier New",size:12},callbacks:{title:function(E){if(!E||!E[0]||!E[0].parsed||!J||!J.length)return"";const V=E[0].dataIndex;if(V<0||V>=J.length)return"";const I=J[V],te=E[0].parsed.y;let F=`Return: ${te>=0?"+":""}${te.toFixed(2)}%`;return I&&I.etfPrice!==void 0&&I.etfPrice>0&&(F+=` | ETF: $${I.etfPrice.toFixed(2)}`),F},label:function(E){if(console.log("🔍 Label callback called with context:",E),!E)return console.log("❌ No context"),"";const V=E.dataIndex;console.log("🔍 Data index:",V);const I=J[V];if(console.log("🔍 Point data:",I),I&&I.timestampValue){const te=new Date(I.timestampValue);if(!isNaN(te.getTime())){const oe=String(te.getDate()).padStart(2,"0"),F=String(te.getMonth()+1).padStart(2,"0"),Y=String(te.getFullYear()).slice(-2),P=te.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),A=`${oe}-${F}-${Y} ${P}`;return console.log("✅ Returning date/time:",A),A}}return console.log("❌ No valid timestamp found"),"No date"}}}},scales:{x:{display:!s&&!c,grid:{display:!1},min:-1,max:b.length,ticks:{display:!1,color:"#ffffff",font:{family:"Courier New",size:10}},border:{display:!1}},y:{display:!c,grid:{display:!c,color:E=>E.tick.value===0?"rgba(149, 184, 163, 0.3)":"transparent",lineWidth:1,drawBorder:!1,drawOnChartArea:!0,drawTicks:!1,offset:!1,borderDash:E=>E.tick.value===0?[5,5]:[]},ticks:{display:!1,color:"#ffffff",font:{family:"Courier New",size:10},callback:function(E){return E===0?"0%":`${E>0?"+":""}${E.toFixed(1)}%`}},border:{display:!1},min:O,max:w}},elements:{point:{radius:0,hoverRadius:0},line:{tension:.4}},interaction:{intersect:!1,mode:"index"}};return o.jsxs("div",{style:{width:"100%",height:n,backgroundColor:"transparent",fontFamily:"Courier New",overflow:"hidden",position:"relative"},children:[!s&&o.jsxs("div",{style:{position:"absolute",top:5,right:5,fontSize:"10px",color:R(),opacity:f?.6:1,transition:"opacity 0.3s ease",zIndex:10,fontFamily:"Courier New"},children:[z(),S&&` (${S})`]}),o.jsx(wo,{data:H,options:U})]})}),ln=["Today’s Edge","Quiet Capital","Simple Gains","Still Waters ETF","Monochrome Alpha","Code Zen","Tokyo Drift Fund","6AM Markets","Silent Buy-In","Whisper Equity","Margins & Moonlight","Espresso Exposure","The Black Candle","No Noise Holdings","White Line Risk","Bare NAV","Precision & Profit","Nōnai Investment","Folded Capital","Ink Thin Margin","ETF Me Later","Bull Sheet","Bagholders Anonymous","Pump & Zen","2% Club","Fade the Fed","Just the Tip… of the Chart","Buy High, Cry Later","Margin of Safety? Never Heard of Her","Quant & Furious","Diamond Hands Club","Degen Lite","Buffett’s Burner Wallet","Icarus Capital","Stoploss Therapy","Roaring Zen","YoloZen ETF","Theta Is My Safe Word","Long and Wrong","The Drawdown Diaries","Kintsugi Holdings","Kyō Balance","Tanaka Trades","Nami (Wave) Fund","Kanjo Capital","Tora Volatility","Kyū Capital","Nikkei Nights","Sumi Ink Index","Origami Alpha","404: Ticker Not Found","async(portfolio)","Fetching Gains…","The JSON Fund","SimuLedger","Web3Bois","Ctrl+Alt+Rebalance","LoFi Alpha","API or Die","Console.Log(Rich)","Fade","Wick","Drift","Latch","Fold","Snap","Bite","Risk","Ping","ZenVest","Dead Cat ETF","Rangebound AF","Opex Overload","Smart Beta Beta","Macro Micro Fund","CPI Szn","Taper Tears","FOMO Fund","Gensler’s Sandbox","Gamma Goblins","The Contrarian","The Ghost Trader","The Quiet Bull","The Daily Monk","The Candle Whisperer","The Macro Stoic","The Alpha Hermit","The Tape Reader","The Vol Addict","The Hedge Poet","Buy Buy Baby","NAVy Seals","Beta Males","Quants of Solitude","Emotional Damage Holdings","Mo’ Money, No Backend","Risk Management-ish","All Weather-ish","Zero Day Holds","Return of the MACD"],je=[];for(let t=0;t<256;++t)je.push((t+256).toString(16).slice(1));function ws(t,e=0){return(je[t[e+0]]+je[t[e+1]]+je[t[e+2]]+je[t[e+3]]+"-"+je[t[e+4]]+je[t[e+5]]+"-"+je[t[e+6]]+je[t[e+7]]+"-"+je[t[e+8]]+je[t[e+9]]+"-"+je[t[e+10]]+je[t[e+11]]+je[t[e+12]]+je[t[e+13]]+je[t[e+14]]+je[t[e+15]]).toLowerCase()}let Cr;const Cs=new Uint8Array(16);function vs(){if(!Cr){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Cr=crypto.getRandomValues.bind(crypto)}return Cr(Cs)}const As=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),cn={randomUUID:As};function Pt(t,e,r){var i;if(cn.randomUUID&&!t)return cn.randomUUID();t=t||{};const n=t.random??((i=t.rng)==null?void 0:i.call(t))??vs();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,ws(n)}const zt="/api";function to(t){return{d:"1day",w:"1week",m:"1month","1min":"1min","5min":"5min","15min":"15min","30min":"30min","1h":"1h","1day":"1day","1week":"1week","1month":"1month"}[t]||"1min"}async function Ts(t,e="1min"){try{t=t.toUpperCase();const r=to(e),n=`${zt}/twelvedata-quote?symbols=${t}&interval=${r}`;l.fetch(`Quote fetch for ${t}`,`timeframe: ${e}, interval: ${r}`);const s=(await Se.get(n)).data;if(l.log(`📥 Raw Twelve Data data for ${t}:`,s),l.log(`📊 Data length: ${s.length} records`),s.length>0&&l.log("📊 First record:",s[0]),!s||!Array.isArray(s)||s.length===0)return l.warn(`❗ No data received for ${t}:`,s),null;const a=s.find(c=>c.symbol===t);return a?(l.log(`📡 fetchQuote → ${t}: $${a.price} @ ${a.timestamp}`),{symbol:t,buyPrice:a.price,buyDate:a.timestamp,historicalData:[{price:a.price,timestamp:a.timestamp,fetchTimestamp:a.fetchTimestamp,symbol:t}]}):(l.warn(`❗ No data found for ${t} in response`),null)}catch(r){return l.error(`❌ fetchQuote error for ${t}:`,r),r.response?l.error(`❌ Server error for ${t}:`,{status:r.response.status,statusText:r.response.statusText,data:r.response.data}):r.request?l.error(`❌ Network error for ${t}:`,r.request):l.error(`❌ Other error for ${t}:`,r.message),null}}async function Ur(t,e,r=null,n="1h",i=null){try{t=t.toUpperCase();const s=e instanceof Date?e.toISOString():e,a=r?r instanceof Date?r.toISOString():r:null;let c=`${zt}/twelvedata-historical?symbol=${t}&start_date=${s}&interval=${n}`;a&&(c+=`&end_date=${a}`),i&&Number.isInteger(i)&&i>0&&(c+=`&outputsize=${i}`),c+=`&_t=${Date.now()}`,l.fetch(`Historical data fetch for ${t}`,`from ${s} to ${a||"now"} (interval: ${n}${i?`, outputsize: ${i}`:""})`);const p=(await Se.get(c)).data;if(l.log(`📥 Raw Twelve Data historical data for ${t}:`,p),!p||p.status!=="ok"||!p.historicalData)return l.warn(`❗ No historical data received for ${t}:`,p),null;if(l.log(`📡 fetchHistoricalData → ${t}: ${p.historicalData.length} datapoints`),p.historicalData.length>0){const d=p.historicalData[p.historicalData.length-1];l.log(`💰 Latest Historical Data for ${t}:`,{price:d.price,close:d.close,open:d.open,high:d.high,low:d.low,timestamp:d.timestamp,fullPoint:d})}return{symbol:t,historicalData:p.historicalData.map(d=>({price:d.close||d.price,timestamp:d.timestamp,fetchTimestamp:new Date().toISOString(),symbol:t}))}}catch(s){return l.error(`❌ fetchHistoricalData error for ${t}:`,s),s.response?l.error(`❌ Server error for ${t}:`,{status:s.response.status,statusText:s.response.statusText,data:s.response.data}):s.request?l.error(`❌ Network error for ${t}:`,s.request):l.error(`❌ Other error for ${t}:`,s.message),null}}async function ro(t,e="1min"){try{const r=t.map(u=>u.toUpperCase()).join(", "),n=to(e),i=`${zt}/twelvedata-quote?symbols=${r}&interval=${n}`;l.fetch(`Batch quote fetch for ${t.length} symbols`,`${r} (interval: ${n})`);const a=(await Se.get(i)).data;if(l.log("📥 Raw Twelve Data batch data:",a),l.log(`📊 Data length: ${a.length} records`),!a||!Array.isArray(a)||a.length===0)return l.warn("❗ No batch data received:",a),[];const c=a.map(u=>{l.log(`💰 API Response for ${u.symbol}:`,{symbol:u.symbol,price:u.price,close:u.close,open:u.open,high:u.high,low:u.low,timestamp:u.timestamp,fullResponse:u});const p=u.close||u.price;return{symbol:u.symbol,buyPrice:p,buyDate:u.timestamp,historicalData:[{price:p,timestamp:u.timestamp,fetchTimestamp:u.fetchTimestamp,symbol:u.symbol}]}});return l.log(`📡 fetchBatchQuotes → ${c.length} symbols processed`),c}catch(r){return l.error("❌ fetchBatchQuotes error:",r),r.response?l.error("❌ Server error:",{status:r.response.status,statusText:r.response.statusText,data:r.response.data}):r.request?l.error("❌ Network error:",r.request):l.error("❌ Other error:",r.message),[]}}async function Ds(t,e,r=null,n="1day",i=null){try{const s=t.map(C=>C.toUpperCase()).join(", "),a=e instanceof Date?e.toISOString():e,c=r?r instanceof Date?r.toISOString():r:null;let u=`${zt}/twelvedata-historical?symbols=${s}&start_date=${a}&interval=${n}`;c&&(u+=`&end_date=${c}`),i&&Number.isInteger(i)&&i>0&&(u+=`&outputsize=${i}`),u+=`&_t=${Date.now()}`,l.info(`🌐 Requesting Twelve Data batch historical data for symbols: ${s} from ${a} to ${c||"now"} (interval: ${n}${i?`, outputsize: ${i}`:""})`);const d=(await Se.get(u)).data;if(l.log("📥 Raw Twelve Data batch historical data:",d),!d||d.status!=="ok"||!d.historicalData)return l.warn("❗ No batch historical data received:",d),{};l.log(`📡 fetchBatchHistoricalData → ${t.length} symbols processed`);const h={};return d.historicalData.forEach(C=>{h[C.symbol]||(h[C.symbol]=[]),h[C.symbol].push({price:C.close||C.price,timestamp:C.timestamp,fetchTimestamp:new Date().toISOString(),symbol:C.symbol})}),h}catch(s){return l.error("❌ fetchBatchHistoricalData error:",s),s.response?l.error("❌ Server error:",{status:s.response.status,statusText:s.response.statusText,data:s.response.data}):s.request?l.error("❌ Network error:",s.request):l.error("❌ Other error:",s.message),{}}}async function no(t,e,r=null,n="1day",i=null){try{const s=t.map(C=>C.toUpperCase()).join(", "),a=e instanceof Date?e.toISOString():e,c=r?r instanceof Date?r.toISOString():r:null;let u=`${zt}/twelvedata-market-data?symbols=${s}&start_date=${a}&interval=${n}`;c&&(u+=`&end_date=${c}`),i&&Number.isInteger(i)&&i>0&&(u+=`&outputsize=${i}`),u+=`&_t=${Date.now()}`,l.info(`🌐 Requesting Twelve Data market data for symbols: ${s} from ${a} to ${c||"now"} (interval: ${n}${i?`, outputsize: ${i}`:""})`);const d=(await Se.get(u)).data;if(l.log("📥 Raw Twelve Data market data:",d),!d||d.status!=="ok")return l.warn("❗ No market data received:",d),{quotes:{},historical:{}};l.log(`📡 fetchBatchMarketData → ${t.length} symbols processed`);const h=d.historicalData||{};return{quotes:d.quotes||{},historicalData:h}}catch(s){return l.error("❌ fetchBatchMarketData error:",s),s.response?l.error("❌ Server error:",{status:s.response.status,statusText:s.response.statusText,data:s.response.data}):s.request?l.error("❌ Network error:",s.request):l.error("❌ Other error:",s.message),{quotes:{},historical:{}}}}async function oo(t="1day"){try{const e=[{symbol:"SPY",name:"SP500"},{symbol:"QQQ",name:"NASDAQ"},{symbol:"DIA",name:"DOW"},{symbol:"UVXY",name:"VIX"}],n={"1day":1,"1week":7,"1month":30,"3month":90,"6month":180,"1year":365}[t]||1,i=new Date;let s;const a=k=>{const f=new Date(k),m=f.getDay();return m===0?f.setDate(f.getDate()-2):m===6&&f.setDate(f.getDate()-1),f.setUTCHours(21,0,0,0),f},c=a(i);let u=c;if(t==="yearToDate")s=new Date(i.getFullYear(),0,1);else if(t==="1day"){const k=new Date(c);if(k.setDate(k.getDate()-1),s=a(k),s.getTime()===u.getTime()){const f=new Date(c);f.setDate(f.getDate()-2),s=a(f)}}else if(t==="1week"){const k=new Date(c.getTime()-864e6);s=a(k)}else if(t==="1month"){const k=new Date(c.getTime()-27648e5);s=a(k)}else if(t==="3month"){const k=new Date(c.getTime()-8208e6);s=a(k)}else{const k=new Date(c.getTime()-n*24*60*60*1e3);s=a(k)}if(s.getTime()===u.getTime()){l.warn("⚠️ Start and end dates are the same, adjusting start date");const k=new Date(s);k.setDate(k.getDate()-1),s=a(k)}l.info("📅 Date calculation debug:"),l.info(`  - Now: ${i.toISOString()}`),l.info(`  - Current trading day: ${c.toISOString()}`),l.info(`  - Timeframe: ${t}, daysBack: ${n}`),l.info(`  - Start date: ${s.toISOString()}`),l.info(`  - End date: ${u.toISOString()}`),l.info(`  - Date range: ${Math.round((u-s)/(1e3*60*60*24))} days`),l.info(`  - Expected period: ${t==="yearToDate"?"YTD":t==="1day"?"1 day":`${n} days`}`);const p={},d=e.map(k=>k.symbol);let h;t==="yearToDate"?h=180:t==="1day"?h=2:t==="1week"?h=7:t==="1month"?h=22:t==="3month"?h=65:h=10,l.log(`🌐 Batch fetching market data for symbols: ${d.join(", ")}`);const C=await no(d,s.toISOString(),u.toISOString(),"1day",h);for(const k of e)try{const f=C.quotes[k.symbol]||{price:0,timestamp:null},m=f.price,S=f.timestamp;l.log(`🔍 Debug ${k.symbol}:`,{symbol:k.symbol,currentPriceData:f,currentPrice:m,currentTimestamp:S,quotesKeys:Object.keys(C.quotes||{})});const y=C.historicalData[k.symbol]||[];l.log(`📊 ${k.symbol} quote data:`),l.log(`  - Quote price: $${m} at ${S}`);let v=null,L=null;y.length>=1?(v=y[y.length-1].price,L=y[y.length-1].timestamp,l.log(`📊 ${k.symbol} period data (${y.length} entries):`),l.log(`  - First entry (start): $${v} at ${L}`),l.log(`  - Last entry (current): $${m} at ${S}`),l.log(`  - Return calculation: (${m} - ${v}) / ${v} × 100`)):(v=m,L=S,l.warn(`⚠️ No historical data for ${k.symbol}, using current price for both start and current`));const N=parseFloat(v)||0,K=parseFloat(m)||0,se=K-N,J=N!==0?(K-N)/N*100:0;l.log(`📊 ${k.name} calculation:`),l.log(`  - Start price: $${N} (${typeof N})`),l.log(`  - Current price: $${K} (${typeof K})`),l.log(`  - Price change: $${se}`),l.log(`  - Percentage change: ${J}%`),l.log(`  - Calculation: ((${K} - ${N}) / ${N}) * 100 = ${J}%`),(K===0||N===0)&&l.warn(`⚠️ Invalid price data for ${k.symbol}: current=${K}, start=${N}`),p[k.name.toLowerCase()]={name:k.name,symbol:k.symbol,price:K,change:se,changePercent:J,timestamp:S,startPrice:N,startTimestamp:L}}catch(f){l.error(`❌ Error fetching NAV-style data for ${k.symbol}:`,f)}return p}catch(e){return l.error("❌ fetchMarketOverview error:",e),{}}}const er=Object.freeze(Object.defineProperty({__proto__:null,fetchBatchHistoricalData:Ds,fetchBatchMarketData:no,fetchBatchQuotes:ro,fetchHistoricalData:Ur,fetchMarketOverview:oo,fetchQuote:Ts},Symbol.toStringTag,{value:"Module"}));class ks{constructor(){this.activeBurnlists=new Map,this.maxActiveBurnlists=5,this.manualUpdateQueue=[]}registerActiveBurnlist(e,r=[]){const n=Date.now();if(this.activeBurnlists.has(e)){const i=this.activeBurnlists.get(e);i.lastOpened=n,i.tickers=new Set(r),this.activeBurnlists.set(e,i),l.log(`📝 Updated active burnlist: ${e}`);return}if(this.activeBurnlists.size>=this.maxActiveBurnlists){const i=this.getOldestActiveBurnlist();i&&(this.activeBurnlists.delete(i),l.log(`🗑️ Removed oldest active burnlist: ${i}`))}this.activeBurnlists.set(e,{lastOpened:n,priority:this.calculatePriority(n),tickers:new Set(r)}),l.log(`✅ Registered active burnlist: ${e} (${this.activeBurnlists.size}/${this.maxActiveBurnlists})`)}unregisterActiveBurnlist(e){this.activeBurnlists.has(e)&&(this.activeBurnlists.delete(e),l.log(`❌ Unregistered active burnlist: ${e}`))}getActiveBurnlists(){return Array.from(this.activeBurnlists.entries()).map(([e,r])=>({slug:e,lastOpened:r.lastOpened,priority:r.priority,tickers:Array.from(r.tickers)}))}isActiveBurnlist(e){return this.activeBurnlists.has(e)}getBurnlistPriority(e){const r=this.activeBurnlists.get(e);return r?r.priority:0}getAllUniqueTickers(){const e=new Set;return this.activeBurnlists.forEach((r,n)=>{r.tickers.forEach(i=>e.add(i))}),Array.from(e)}getBurnlistsForTicker(e){const r=[];return this.activeBurnlists.forEach((n,i)=>{n.tickers.has(e)&&r.push(i)}),r}getOldestActiveBurnlist(){let e=null,r=Date.now();return this.activeBurnlists.forEach((n,i)=>{n.lastOpened<r&&(r=n.lastOpened,e=i)}),e}calculatePriority(e){const n=Date.now()-e;return Math.max(0,1e3-Math.floor(n/1e3))}requestManualUpdate(e){return this.isActiveBurnlist(e)?(l.log(`⚠️ Manual update requested for active burnlist: ${e}`),!1):this.manualUpdateQueue.find(n=>n.slug===e)?(l.log(`⚠️ Manual update already queued for: ${e}`),!1):(this.manualUpdateQueue.push({slug:e,timestamp:Date.now(),status:"pending"}),l.log(`📋 Queued manual update for: ${e}`),!0)}getManualUpdateQueue(){return this.manualUpdateQueue.map(e=>({...e}))}isManualUpdatePending(e){return this.manualUpdateQueue.some(r=>r.slug===e&&r.status==="pending")}markManualUpdateProcessing(e){const r=this.manualUpdateQueue.find(n=>n.slug===e);r&&(r.status="processing",l.log(`⚙️ Processing manual update for: ${e}`))}markManualUpdateCompleted(e){const r=this.manualUpdateQueue.findIndex(n=>n.slug===e);r!==-1&&(this.manualUpdateQueue.splice(r,1),l.log(`✅ Completed manual update for: ${e}`))}getNextManualUpdate(){return this.manualUpdateQueue.find(e=>e.status==="pending")}getSystemStatus(){return{activeBurnlists:this.activeBurnlists.size,maxActiveBurnlists:this.maxActiveBurnlists,manualUpdateQueue:this.manualUpdateQueue.length,totalUniqueTickers:this.getAllUniqueTickers().length}}cleanupOldManualUpdates(){const e=Date.now()-3e5,r=this.manualUpdateQueue.length;this.manualUpdateQueue=this.manualUpdateQueue.filter(i=>i.timestamp>e);const n=r-this.manualUpdateQueue.length;n>0&&l.log(`🧹 Cleaned up ${n} old manual update requests`)}}const st=new ks,Es=Object.freeze(Object.defineProperty({__proto__:null,default:st},Symbol.toStringTag,{value:"Module"}));class $s{constructor(){this.notifications=[],this.callbacks=new Set,this.apiStatus="online",this.lastApiCheck=Date.now()}addCallback(e){this.callbacks.add(e)}removeCallback(e){this.callbacks.delete(e)}notify(e,r){this.callbacks.forEach(n=>{try{n(e,r)}catch(i){console.error("❌ Error in notification callback:",i)}})}handleApiOffline(e){this.apiStatus="offline",this.lastApiCheck=Date.now();const r={type:"api-offline",message:"API is offline. Using cached data.",details:(e==null?void 0:e.message)||"Unknown error",timestamp:new Date().toISOString(),severity:"warning"};this.notifications.push(r),this.notify("api-offline",r),console.error("❌ API Offline:",e)}handleApiOnline(){const e=this.apiStatus==="offline";if(this.apiStatus="online",this.lastApiCheck=Date.now(),e){const r={type:"api-online",message:"API is back online.",timestamp:new Date().toISOString(),severity:"success"};this.notifications.push(r),this.notify("api-online",r),console.log("✅ API Online")}}handleRateLimitWarning(e){if(e.atLimit){const r={type:"rate-limit-reached",message:"Rate limit reached. Waiting for reset...",details:`${e.totalRate}/${e.maxCallsPerMinute} calls`,timestamp:new Date().toISOString(),severity:"error"};this.notifications.push(r),this.notify("rate-limit-reached",r),console.warn("⚠️ Rate limit reached")}else if(e.approaching){const r={type:"rate-limit-approaching",message:"Approaching rate limit.",details:`${e.totalRate}/${e.maxCallsPerMinute} calls`,timestamp:new Date().toISOString(),severity:"warning"};this.notifications.push(r),this.notify("rate-limit-approaching",r),console.warn("⚠️ Approaching rate limit")}}handleManualUpdateStatus(e,r){const n={type:"manual-update",message:`Manual update ${r} for ${e}`,slug:e,status:r,timestamp:new Date().toISOString(),severity:r==="completed"?"success":"info"};this.notifications.push(n),this.notify("manual-update",n),console.log(`📋 Manual update ${r} for ${e}`)}handleReturnChanges(e){if(e.length===0)return;const r={type:"return-changes",message:`${e.length} ticker(s) with significant return changes`,changes:e,timestamp:new Date().toISOString(),severity:"info"};this.notifications.push(r),this.notify("return-changes",r),console.log(`📊 ${e.length} significant return changes detected`)}handleSystemError(e,r){const n={type:"system-error",message:"System error occurred",details:(e==null?void 0:e.message)||"Unknown error",context:r,timestamp:new Date().toISOString(),severity:"error"};this.notifications.push(n),this.notify("system-error",n),console.error("❌ System Error:",e)}handleSyncStatus(e,r){const n={type:"sync-status",message:`Sync ${e}`,details:r,timestamp:new Date().toISOString(),severity:e==="completed"?"success":"info"};this.notifications.push(n),this.notify("sync-status",n),console.log(`🔄 Sync ${e}:`,r)}getApiStatus(){return{status:this.apiStatus,lastCheck:this.lastApiCheck,isOnline:this.apiStatus==="online"}}getRecentNotifications(e=10){return this.notifications.slice(-e).reverse()}clearOldNotifications(){const e=Date.now()-36e5,r=this.notifications.length;this.notifications=this.notifications.filter(i=>new Date(i.timestamp).getTime()>e);const n=r-this.notifications.length;n>0&&console.log(`🧹 Cleared ${n} old notifications`)}getNotificationStats(){const e={total:this.notifications.length,byType:{},bySeverity:{}};return this.notifications.forEach(r=>{e.byType[r.type]=(e.byType[r.type]||0)+1,e.bySeverity[r.severity]=(e.bySeverity[r.severity]||0)+1}),e}exportNotifications(){return{timestamp:new Date().toISOString(),apiStatus:this.getApiStatus(),notifications:this.notifications,stats:this.getNotificationStats()}}reset(){this.notifications=[],this.apiStatus="online",this.lastApiCheck=Date.now(),console.log("🔄 Notification manager reset")}}const Wt=new $s;class js{constructor(){this.isRunning=!1,this.cycleTimeouts=[],this.currentCycleStartTime=null,this.batchesInCurrentMinute=0,this.lastMinuteTimestamp=0,this.BATCH_SIZE=5,this.BATCHES_PER_CYCLE=20,this.CYCLE_DURATION_MS=3*60*1e3,this.BATCH_INTERVAL_MS=9*1e3,this.MAX_BATCHES_PER_MINUTE=11,this.stats={totalCycles:0,totalBatches:0,successfulBatches:0,failedBatches:0,lastError:null,lastCycleTime:null}}async start(){if(console.log("🔧 DEBUG: batchedFetchManager.start() called"),this.isRunning){console.log("⚠️ Batched fetch manager already running");return}this.isRunning=!0,console.log("🚀 Starting batched fetch manager (3-minute cycles, 9-second intervals)"),xt.start(),this.verifyRateLimitCompliance(),await this.startNewCycle()}stop(){this.isRunning=!1,xt.stop(),this.cycleTimeouts.forEach(e=>clearTimeout(e)),this.cycleTimeouts=[],console.log("🛑 Stopped batched fetch manager")}async startNewCycle(){if(console.log("🔧 DEBUG: startNewCycle called"),console.log("🔧 DEBUG: isRunning:",this.isRunning),!this.isRunning){console.log("🔧 DEBUG: Not running, returning");return}const e=this.isMarketOpen();if(console.log("🔧 DEBUG: Market open check:",e),!e){console.log("⏰ Market is closed (extended NYC hours: Mon-Fri, 4:00 AM - 8:00 PM ET). Skipping automatic fetch cycle."),console.log("⏰ Manual fetches (add ticker, edit buy date, click header) are still allowed anytime."),this.scheduleNextCycle();return}this.currentCycleStartTime=Date.now(),this.stats.totalCycles++,this.stats.lastCycleTime=new Date().toISOString(),console.log(`🔄 Starting fetch cycle #${this.stats.totalCycles} (extended NYC market hours)`);const r=st.getAllUniqueTickers();if(console.log("🔧 DEBUG: All tickers found:",r),r.length===0){console.log("📭 No active tickers to fetch, scheduling next cycle"),this.scheduleNextCycle();return}console.log(`📊 Processing ${r.length} tickers in ${this.BATCHES_PER_CYCLE} batches`);const n=this.createBatches(r,this.BATCH_SIZE),i=n.slice(0,this.BATCHES_PER_CYCLE);n.length>this.BATCHES_PER_CYCLE&&console.log(`⚠️ Limited to ${this.BATCHES_PER_CYCLE} batches, ${n.length-this.BATCHES_PER_CYCLE} batches will be processed in next cycle`),i.forEach((c,u)=>{const p=u*this.BATCH_INTERVAL_MS;console.log(`⏰ Scheduling batch ${u+1}/${i.length} in ${p/1e3}s`);const d=setTimeout(async()=>{await this.processBatch(c,u+1,i.length)},p);this.cycleTimeouts.push(d)});const s=i.length*this.BATCH_INTERVAL_MS+1e3,a=setTimeout(async()=>{await this.completeCycle(),this.scheduleNextCycle()},s);this.cycleTimeouts.push(a)}createBatches(e,r){const n=[];for(let i=0;i<e.length;i+=r)n.push(e.slice(i,i+r));return n}async processBatch(e,r,n){if(!this.isRunning)return;const i=Math.floor(Date.now()/6e4);if(i!==this.lastMinuteTimestamp&&(this.lastMinuteTimestamp=i,this.batchesInCurrentMinute=0),this.batchesInCurrentMinute>=this.MAX_BATCHES_PER_MINUTE){console.warn(`⚠️ Rate limit reached: ${this.batchesInCurrentMinute} batches in current minute, skipping batch ${r}`),this.stats.failedBatches++;return}this.batchesInCurrentMinute++,this.stats.totalBatches++,l.fetch(`Batch fetch ${r}/${n}`,`[${e.join(", ")}] (${this.batchesInCurrentMinute}/${this.MAX_BATCHES_PER_MINUTE} this minute, ${e.length} credits)`);try{const s=[];for(const a of e)try{const c=new Date,u=new Date(c.getTime()-6*60*60*1e3),p=await Ur(a,u.toISOString().split("T")[0],c.toISOString().split("T")[0],"5min",72);p&&s.push(p)}catch(c){console.error(`❌ Failed to fetch historical data for ${a}:`,c)}s&&s.length>0?(console.log(`✅ Batch ${r} successful: ${s.length} historical datasets received`),this.stats.successfulBatches++,this.updateBurnlistPrices(s)):(console.warn(`❌ Batch ${r} failed: no data received`),this.stats.failedBatches++)}catch(s){console.error(`❌ Batch ${r} error:`,s),this.stats.failedBatches++,this.stats.lastError=s.message}}updateBurnlistPrices(e){st.getActiveBurnlists().forEach(n=>{const i=this.updateWatchlistItems(n,e);if(i.length>0){console.log(`📊 Updated ${i.length} items in watchlist ${n}`);const s=JSON.parse(localStorage.getItem("burnlist_watchlists")||"{}"),a=Object.keys(s).find(c=>s[c].slug===n);if(a&&s[a].items){const c=s[a].items;xt.queueAlignedCalculation(n,c,"MAX")}}})}updateWatchlistItems(e,r){try{const n=JSON.parse(localStorage.getItem("burnlist_watchlists")||"{}"),i=Object.keys(n).find(c=>n[c].slug===e);if(!i||!n[i].items)return[];const s=n[i],a=[];return s.items.forEach(c=>{var p;const u=r.find(d=>d.symbol===c.symbol);if(u){console.log("🔧 DEBUG: Processing",c.symbol),console.log("🔧 DEBUG: Original buy price:",c.buyPrice),console.log("🔧 DEBUG: Original buy date:",c.buyDate),console.log("🔧 DEBUG: New historical data:",u);const d=c.buyPrice,h=c.buyDate,C=(p=u.historicalData[u.historicalData.length-1])==null?void 0:p.price;C&&(l.log(`💰 Setting current price for ${c.symbol}: $${C} (from historical data)`),c.currentPrice=C),c.historicalData||(c.historicalData=[]),u.historicalData.forEach(k=>{c.historicalData.find(m=>m.timestamp===k.timestamp)||c.historicalData.push({price:k.price,timestamp:k.timestamp,fetchTimestamp:new Date().toISOString(),symbol:c.symbol})}),c.historicalData.sort((k,f)=>new Date(k.timestamp)-new Date(f.timestamp)),c.historicalData.length>100&&(c.historicalData=c.historicalData.slice(-100)),c.buyPrice=d,c.buyDate=h,console.log("🔧 DEBUG: Final buy price after restore:",c.buyPrice),console.log("🔧 DEBUG: Final current price:",c.currentPrice),a.push(c)}}),a.length>0&&(localStorage.setItem("burnlist_watchlists",JSON.stringify(n)),window.dispatchEvent(new StorageEvent("storage",{key:"burnlist_watchlists",newValue:JSON.stringify(n),storageArea:localStorage})),console.log(`💾 Updated localStorage and triggered storage event for ${e}`)),a}catch(n){return console.error(`❌ Error updating watchlist items for ${e}:`,n),[]}}async completeCycle(){if(!this.isRunning)return;console.log(`🏁 Completing fetch cycle #${this.stats.totalCycles}`);const e=st.getActiveBurnlists();for(const n of e)await this.computeAndSaveWatchlistAverage(n);const r=Date.now()-this.currentCycleStartTime;console.log(`✨ Cycle #${this.stats.totalCycles} completed in ${(r/1e3).toFixed(1)}s`)}async computeAndSaveWatchlistAverage(e){try{const r=JSON.parse(localStorage.getItem("burnlist_watchlists")||"{}"),n=Object.keys(r).find(a=>r[a].slug===e);if(!n||!r[n].items)return;const s=r[n].items;try{let a=0,c=0;s.forEach(d=>{try{const h=d.historicalData&&d.historicalData.length>0?d.historicalData[d.historicalData.length-1].price:0,C=d.currentPrice||(d.historicalData&&d.historicalData.length>0?d.historicalData[0].price:0);if(h>0&&C>0){const k=(C-h)/h*100;a+=k,c++}}catch(h){l.error(`Error calculating return for ${d.symbol}:`,h)}});const u=c>0?a/c:0,p=[{timestamp:new Date().toISOString(),returnPercent:u,valid:!0,source:"batched",validTickers:c,totalTickers:s.length}];if(p&&p.length>0){const h=p[p.length-1].returnPercent,C={timestamp:new Date().toISOString(),averageReturn:parseFloat(h.toFixed(5)),tickerCount:s.length,timeframe:"MAX"};Ir.saveWatchlistDatapoint(e,C)&&console.log(`💾 Saved NEW NAV datapoint for ${e}: ${h.toFixed(2)}% (${s.length} tickers)`),pt.emit(e,p,"batch"),console.log(`📡 Emitted real-time NAV update for ${e}`)}else console.log(`⚠️ No NAV data generated for ${e}`)}catch(a){console.error(`❌ Error in NEW NAV calculation for ${e}:`,a);const c=this.calculateTimeframeBasedReturn(s,"MAX");if(c!==null){const u={timestamp:new Date().toISOString(),averageReturn:parseFloat(c.toFixed(5)),tickerCount:s.length,timeframe:"MAX"};Ir.saveWatchlistDatapoint(e,u)&&console.log(`💾 Saved FALLBACK datapoint for ${e}: ${c.toFixed(2)}% (${s.length} tickers)`)}}}catch(r){console.error(`❌ Error computing watchlist average for ${e}:`,r)}}calculateTimeframeBasedReturn(e,r="MAX"){if(!Array.isArray(e)||e.length===0)return null;let n=0,i=0;const s=new Date;return e.forEach(a=>{if(!a.currentPrice||!a.buyPrice||a.buyPrice<=0)return;let c=a.buyPrice;if(r!=="MAX"&&a.historicalData&&a.historicalData.length>0){const p=this.getTimeframeStartTime(r,s);if(p)if(new Date(a.buyDate)<=p){const h=this.findClosestHistoricalPrice(a.historicalData,p);h&&(c=h.price)}else{const h=a.historicalData[0];h&&h.price>0&&(c=h.price)}}const u=(a.currentPrice-c)/c*100;Number.isFinite(u)&&(n+=u,i++)}),i===0?null:n/i}getTimeframeStartTime(e,r=new Date){switch(e){case"D":return new Date(r.getTime()-24*60*60*1e3);case"W":return new Date(r.getTime()-7*24*60*60*1e3);case"M":return new Date(r.getTime()-30*24*60*60*1e3);case"YTD":return new Date(r.getFullYear(),0,1);case"MAX":default:return null}}findClosestHistoricalPrice(e,r){if(!e||e.length===0)return null;const n=r.getTime();let i=null,s=1/0;return e.forEach(a=>{const c=new Date(a.timestamp).getTime(),u=Math.abs(c-n);u<s&&(s=u,i=a)}),i}scheduleNextCycle(){if(!this.isRunning)return;const e=this.CYCLE_DURATION_MS;console.log(`⏰ Next fetch cycle in ${(e/1e3).toFixed(1)}s`);const r=setTimeout(()=>{this.startNewCycle()},e);this.cycleTimeouts.push(r)}isMarketOpen(){const e=new Date,r=new Date(e.toLocaleString("en-US",{timeZone:"America/New_York"})),n=r.getDay(),i=r.getHours();return!(n===0||n===6||i<4||i>=20)}verifyRateLimitCompliance(){const e=this.getStatus(),{configuration:r,currentCycle:n}=e;Math.ceil(100/r.batchSize)*r.batchIntervalMs;const s=r.maxBatchesPerMinute*r.batchSize,a={batchSize:r.batchSize===5,batchesPerCycle:r.batchesPerCycle===20,cycleDuration:Math.abs(r.cycleDurationMs-18e4)<1e3,batchInterval:r.batchIntervalMs===9e3,maxBatchesPerMinute:r.maxBatchesPerMinute===11,maxCreditsPerMinute:s===55,marketHoursCheck:this.isMarketOpen!==void 0},c=Object.values(a).every(Boolean);return console.log("🔍 Rate Limit Compliance Check:"),console.log(`  ✅ Batch size (5 tickers): ${a.batchSize}`),console.log(`  ✅ Batches per cycle (20): ${a.batchesPerCycle}`),console.log(`  ✅ Cycle duration (3min): ${a.cycleDuration}`),console.log(`  ✅ Batch interval (9s): ${a.batchInterval}`),console.log(`  ✅ Max batches/min (11): ${a.maxBatchesPerMinute}`),console.log(`  ✅ Max credits/min (55): ${a.maxCreditsPerMinute}`),console.log(`  ✅ Market hours check: ${a.marketHoursCheck}`),console.log(`  ${c?"✅":"❌"} Overall compliance: ${c?"PASS":"FAIL"}`),{compliance:a,allCompliant:c}}getStatus(){const e=this.currentCycleStartTime?Date.now()-this.currentCycleStartTime:0;return{isRunning:this.isRunning,stats:{...this.stats},currentCycle:{startTime:this.currentCycleStartTime,uptime:e,batchesInCurrentMinute:this.batchesInCurrentMinute},configuration:{batchSize:this.BATCH_SIZE,batchesPerCycle:this.BATCHES_PER_CYCLE,cycleDurationMs:this.CYCLE_DURATION_MS,batchIntervalMs:this.BATCH_INTERVAL_MS,maxBatchesPerMinute:this.MAX_BATCHES_PER_MINUTE},marketHours:{isOpen:this.isMarketOpen(),currentNYTime:new Date().toLocaleString("en-US",{timeZone:"America/New_York"})},realTimeNav:xt.getStatus()}}}const Ht=new js;class Ns{constructor(e=55){this.maxCallsPerMinute=e,this.automaticCalls=[],this.manualCalls=[],this.reservedForManual=10,this.batchSize=5}canMakeAutomaticRequest(){const r=Date.now()-6e4;this.automaticCalls=this.automaticCalls.filter(i=>i>r);const n=this.maxCallsPerMinute-this.reservedForManual;return this.automaticCalls.length<n}canMakeManualRequest(){const r=Date.now()-6e4;return this.manualCalls=this.manualCalls.filter(n=>n>r),this.manualCalls.length<this.reservedForManual}recordAutomaticRequest(){this.automaticCalls.push(Date.now()),l.log(`📊 Automatic API call recorded. Total: ${this.automaticCalls.length}`)}recordManualRequest(){this.manualCalls.push(Date.now()),l.log(`📊 Manual API call recorded. Total: ${this.manualCalls.length}`)}getRateLimitStatus(){const r=Date.now()-6e4,n=this.automaticCalls.filter(a=>a>r).length,i=this.manualCalls.filter(a=>a>r).length,s=n+i;return{automaticRate:n,manualRate:i,totalRate:s,maxCallsPerMinute:this.maxCallsPerMinute,reservedForManual:this.reservedForManual,availableForAutomatic:this.maxCallsPerMinute-this.reservedForManual,approaching:s>=this.maxCallsPerMinute*.8,atLimit:s>=this.maxCallsPerMinute,nextAutomaticAvailable:this.canMakeAutomaticRequest()?0:this.getNextAvailableTime("automatic"),nextManualAvailable:this.canMakeManualRequest()?0:this.getNextAvailableTime("manual")}}getNextAvailableTime(e){const r=Date.now(),n=r-6e4;if(e==="automatic"){const i=this.automaticCalls.filter(a=>a>n);return i.length<this.maxCallsPerMinute-this.reservedForManual?0:Math.min(...i)+6e4-r}else{const i=this.manualCalls.filter(a=>a>n);return i.length<this.reservedForManual?0:Math.min(...i)+6e4-r}}getMaxTickersPerMinute(){return(this.maxCallsPerMinute-this.reservedForManual)*this.batchSize}calculateRefreshInterval(e){const r=this.getMaxTickersPerMinute();return e<=r?6e4:e<=r*2?9e4:12e4}async waitForRateLimit(e="automatic"){const r=this.getNextAvailableTime(e);r>0&&(l.log(`⏳ Waiting ${Math.ceil(r/1e3)}s for rate limit reset (${e})`),await new Promise(n=>setTimeout(n,r)))}getStatusMessage(){const e=this.getRateLimitStatus();return e.atLimit?"Rate limit reached. Waiting for reset...":e.approaching?`Approaching rate limit: ${e.totalRate}/${e.maxCallsPerMinute} calls`:`API calls: ${e.totalRate}/${e.maxCallsPerMinute}`}}const tr=new Ns;function Wr(t){if(!t||typeof t!="object")return l.warn("⚠️ normalizeTicker received invalid input:",t),{symbol:"UNKNOWN",buyPrice:0,buyDate:new Date().toISOString(),historicalData:[],addedAt:new Date().toISOString(),type:"real"};let e=!1;const r=Array.isArray(t.historicalData)?t.historicalData.map(c=>{const u=Number(c==null?void 0:c.price),p=new Date(c==null?void 0:c.timestamp).toISOString();return(isNaN(u)||!(c!=null&&c.timestamp))&&l.warn("⚠️ Malformed historical entry:",c),u===0&&(l.warn("⚠️ Historical entry has price = 0:",c),e=!0),{price:isNaN(u)?0:u,timestamp:p}}):[];let n=Number(t.buyPrice);isNaN(n)&&(l.warn("⚠️ Invalid or missing buyPrice, defaulting to 0:",t),n=0,e=!0);let i;t.buyDate&&!isNaN(new Date(t.buyDate))?i=new Date(t.buyDate).toISOString():(i=new Date(t.addedAt||Date.now()).toISOString(),l.warn("⚠️ Invalid or missing buyDate, falling back to addedAt or now:",t));const s=new Date(t.addedAt||Date.now()).toISOString(),a={symbol:String(t.symbol||"UNKNOWN").toUpperCase(),buyPrice:n,buyDate:i,historicalData:r,addedAt:s,type:t.type||"real",incomplete:e,...t.currentPrice!==void 0&&{currentPrice:Number(t.currentPrice)}};return l.log("🧼 normalizeTicker →",a),a}const Me=new Map,vr=new Map;let It=0,or=Date.now();function Rs(){const t=Date.now();t-or>=6e4&&(It=0,or=t)}function dn(){return tr.canMakeAutomaticRequest()}function Ps(){Rs(),It++,l.log(`📊 Global API Request #${It} (Twelve Data)`)}function io(t){return vr.has(t)||vr.set(t,{count:0,resetTime:Date.now()}),vr.get(t)}function Is(t){const e=io(t);e.count++,l.log(`📊 Watchlist ${t} API Request #${e.count}`)}function Ms(){const t=new Date,e=new Date(t.toLocaleString("en-US",{timeZone:"America/New_York"})),r=e.getDay(),n=e.getHours();return!(r===0||r===6||n<4||n>=20)}function Fs(t,e=5){const r=[];for(let n=0;n<t.length;n+=e)r.push(t.slice(n,n+e));return r}class Os{constructor(){this.isInitialized=!1}async initialize(){if(!this.isInitialized)try{await Ht.start(),this.isInitialized=!0,l.log("✅ Twelve Data Fetch Manager initialized (automatic fetching enabled)")}catch(e){l.error("❌ Error initializing Twelve Data Fetch Manager:",e),Wt.handleSystemError(e,"fetch-manager-init")}}isFetchActive(e){const r=Me.get(e);return r&&r.status==="active"}getFetchStatus(e){const r=Me.get(e);if(!r)return{status:"idle",progress:0,message:"No active fetch"};const{status:n,currentBatch:i,totalBatches:s,message:a}=r,c=s>0?i/s*100:0;return{status:n,progress:Math.round(c),currentBatch:i,totalBatches:s,message:a}}cancelFetch(e){const r=Me.get(e);return r&&r.abortController?(r.abortController.abort(),Me.delete(e),l.log(`❌ Cancelled fetch for ${e}`),!0):!1}pauseFetch(e){const r=Me.get(e);return r&&r.status==="active"?(r.status="paused",l.log(`⏸️ Paused fetch for ${e}`),!0):!1}async resumeFetch(e,r,n){const i=Me.get(e);return i&&i.status==="paused"?(i.status="active",l.log(`▶️ Resumed fetch for ${e}`),await this._executeFetch(e,r,n,i.currentBatch),!0):!1}async startFetch(e,r,n,i=!1,s=!1,a="1min"){if(this.isInitialized||await this.initialize(),!i){const c=r.map(u=>u.symbol);st.registerActiveBurnlist(e,c)}if(!s&&!Ms()){const c="Market is closed. Click again to force refresh.";return l.log(`⚠️ ${c}`),{success:!1,message:c}}return i&&!st.isActiveBurnlist(e)?await this._handleManualUpdate(e,r,n):await this._executeFetch(e,r,n,0,a)}async _handleManualUpdate(e,r,n){try{return l.log(`📋 Processing manual update for ${e}`),st.requestManualUpdate(e)?(l.log(`Manual update requested for ${e} - will be processed in next batch cycle`),{success:!0,message:`Manual update queued for ${e}. Data will be refreshed in next batch cycle.`,batchedSystem:!0}):{success:!1,message:"Manual update already queued"}}catch(i){return l.error(`❌ Manual update error for ${e}:`,i),Wt.handleSystemError(i,"manual-update"),{success:!1,message:i.message}}}async _executeFetch(e,r,n,i=0,s="1min"){const a=new AbortController,c=r.map(d=>d.symbol),u=Fs(c,5),p=u.length;Me.set(e,{status:"active",currentBatch:i,totalBatches:p,abortController:a,message:`Processing ${c.length} tickers in ${p} batches`}),l.log(`🔄 Starting fetch for ${e}: ${c.length} tickers in ${p} batches`);try{let d=0;const h=[...r];for(let C=i;C<u.length;C++){if(a.signal.aborted){l.log(`❌ Fetch cancelled for ${e}`);break}const k=Me.get(e);if(k&&k.status==="paused"){l.log(`⏸️ Fetch paused for ${e}`);break}if(!dn()){l.log("⏳ Rate limit reached, waiting..."),await new Promise(m=>setTimeout(m,5e3));continue}const f=u[C];l.log(`📦 Processing batch ${C+1}/${p} for ${e}: ${f.join(", ")}`);try{const m=[];for(const y of f)try{const v=new Date,L=new Date(v.getTime()-24*60*60*1e3),N=await Ur(y,L.toISOString().split("T")[0],v.toISOString().split("T")[0],"1h",24);N&&m.push(N)}catch(v){console.error(`❌ Failed to fetch historical data for ${y}:`,v)}Ps(),Is(e),tr.recordAutomaticRequest(),m.forEach(y=>{var L;const v=h.findIndex(N=>N.symbol===y.symbol);if(v!==-1){const N=h[v],K=N.buyPrice,se=N.buyDate,J=(L=y.historicalData[y.historicalData.length-1])==null?void 0:L.price;J&&(l.log(`💰 Setting current price for ${y.symbol}: $${J} (from historical data)`),N.currentPrice=J),N.historicalData||(N.historicalData=[]),y.historicalData.forEach(z=>{N.historicalData.find(b=>b.timestamp===z.timestamp)||N.historicalData.push({price:z.price,timestamp:z.timestamp,fetchTimestamp:new Date().toISOString(),symbol:N.symbol})}),N.historicalData.sort((z,R)=>new Date(z.timestamp)-new Date(R.timestamp)),N.historicalData.length>100&&(N.historicalData=N.historicalData.slice(-100)),N.buyPrice=K,N.buyDate=se,h[v]=Wr(N),d++}});const S=Math.round((C+1)/p*100);Me.set(e,{...Me.get(e),currentBatch:C+1,message:`Processed ${C+1}/${p} batches`}),n&&n(h,S)}catch(m){l.error(`❌ Batch error for ${e}:`,m),Wt.handleSystemError(m,"batch-processing");continue}}return Me.set(e,{status:"completed",currentBatch:p,totalBatches:p,message:`Completed: ${d} tickers updated`}),l.log(`✅ Fetch completed for ${e}: ${d} tickers updated`),{success:!0,message:`Updated ${d} tickers`}}catch(d){return l.error(`❌ Fetch error for ${e}:`,d),Wt.handleSystemError(d,"fetch-execution"),Me.set(e,{status:"error",currentBatch:0,totalBatches:p,message:`Error: ${d.message}`}),{success:!1,message:d.message}}finally{a.signal.aborted||a.abort()}}async _processBatch(e,r,n,i,s){if(n.signal.aborted)return[];try{return await ro(e,s)}catch(a){return l.error("❌ Batch processing error:",a),[]}}getRequestStatus(){return{globalRequestCount:It,lastResetTime:or,canMakeRequest:dn(),rateLimitStatus:tr.getRateLimitStatus(),syncStatus:Ht.getStatus()}}getWatchlistRequestStatus(e){const r=io(e);return{count:r.count,resetTime:r.resetTime,isActive:this.isFetchActive(e),status:this.getFetchStatus(e)}}cleanup(){Me.forEach((e,r)=>{e.abortController&&e.abortController.abort()}),Me.clear(),Ht.stop(),l.log("🧹 Twelve Data Fetch Manager cleaned up")}getSystemStats(){return{fetchManager:{activeFetches:Me.size,globalRequestCount:It,lastResetTime:or},batchedFetchManager:Ht.getStatus(),rateLimiter:tr.getRateLimitStatus(),activeBurnlists:st.getSystemStatus()}}}const Le=new Os,Oe=({message:t,type:e="info",onClose:r})=>{if(!t)return null;const n=ne(e==="error"?"#1a0f0f":e==="success"?"#0f1a0f":e==="loading"?"#0a0a0a":"#0f0f0f"),i=ne("#8CB9A2"),s=ne(e==="error"?"#e31507":e==="success"?"#0de309":"#8CB9A2");return o.jsx("div",{style:{background:n,color:i,border:`2px solid ${s}`,padding:"12px 16px",textAlign:"center",fontFamily:"Courier New",fontSize:14,fontWeight:"bold",position:"relative",marginBottom:8,cursor:r?"pointer":"default",userSelect:"none",opacity:1,borderRadius:0,boxShadow:"0 2px 8px rgba(0,0,0,0.3)",letterSpacing:"0.5px",textTransform:"uppercase",minHeight:"44px",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(4px)"},onClick:r,"aria-label":r?"Dismiss notification":void 0,tabIndex:r?0:void 0,role:"alert",children:t})},Ce=({children:t,onClick:e,type:r="button",style:n={},disabled:i=!1,mobile:s=!1,loading:a,...c})=>{const u=ne(i?"#444":"#000"),p=ne("#8CB9A2"),d=ne("#8CB9A2"),h=s?{minHeight:"44px",fontSize:"16px",padding:"12px 16px",borderRadius:"0",transition:"all 0.2s ease"}:{};return o.jsx("button",{type:r,onClick:e,disabled:i,style:{backgroundColor:u,color:p,border:`1px solid ${d}`,padding:s?"12px 16px":"6px 16px",fontFamily:"Courier New",fontSize:s?"16px":"15px",cursor:i?"not-allowed":"pointer",opacity:i?.6:1,borderRadius:s?0:2,margin:s?"4px":"2px",minHeight:s?"44px":"auto",transition:"all 0.2s ease",...h,...n},...c,children:t})},Vt="rgb(140,185,162)",tt=()=>{const t=He(),e=Xe(),{isInverted:r}=Ue(),n=s=>s==="/"?e.pathname==="/"||e.pathname.startsWith("/burn/"):s==="/universes"?e.pathname==="/universes"||e.pathname.startsWith("/universe/"):s==="/market"?e.pathname==="/market":s==="/screeners"?e.pathname==="/screeners"||e.pathname.startsWith("/screeners/"):e.pathname===s,i=s=>({background:s?Vt:"transparent",color:s?"#000000":Vt,border:`1px solid ${Vt}`,padding:"8px 16px",fontFamily:"'Courier New', monospace",fontSize:"12px",fontWeight:"bold",cursor:"pointer",transition:"all 0.2s ease",minWidth:"80px",textAlign:"center"});return o.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",padding:"10px 20px",borderBottom:`1px solid ${Vt}`,background:"rgba(0,0,0,0.3)",gap:"10px"},children:[o.jsx(Ce,{onClick:()=>t("/"),style:i(n("/")),children:"BURNPAGE"}),o.jsx(Ce,{onClick:()=>t("/market"),style:i(n("/market")),children:"MARKET"}),o.jsx(Ce,{onClick:()=>t("/screeners"),style:i(n("/screeners")),children:"SCREENERS"}),o.jsx(Ce,{onClick:()=>t("/universes"),style:i(n("/universes")),children:"UNIVERSE"}),o.jsx(Ce,{onClick:()=>t("/journal"),style:i(n("/journal")),children:"JOURNAL"})]})},Ct="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAGSElEQVR4Xu2dsXMcNRjFpXWG8QwFlHSELiUlJWly8VCQNMxQ2Ng1FWPHlISSwRn/CRfsghJ3xmmcMmXo6HBJkSIzUHiGywotOExu4uN+n28VnbTvSvvtJ+l9b5+0WknrnX6DZsAPuvVqvJMABi4CCUACGDgDA2++HEACGDgDA2++HEACGDgDA2++HEACqI+BvZPxjdBee4+07N7a+mOCqxVTpQPsnRz8FBN2hyRtZ7RRJQek7R2mysbPFkDX3DDFjQRApVIQTg7AkzUwB3idGDkAF0sxSDkAT5UcQINArpZSkHIAnik5gByAq6UUpByAZ0oOIAfgasmJ3D8eX580zWbfdbg3+uJ+3zFLileMA+ydHMap3dBN8YKfv7szWj8CwMFDJICBS0ACkADKYEBdQJo8yQHS8FpMVAmgmFSlqagEkIbXYqJKAMWkKk1FJYA0vBYTVQIoJlVpKppdAA9ODn4jTYsr+VYjbmqlbxP/0F5ysW/d1vbaxkMS11D+k7h66HMS04LJXX52AcQ3d9OrNC3szcTyqWBD+UdRAHd7qd4rQXKXLwFwAUoAfau/i2e4AwzFywEoWXIAOQDVShqcHACPgZJ0QXIAOUCaO5tGlQPIAfQYyO4WdQGX8XT5ZJCeApimlmB3cIouwDITyMv3T0PrviLEhnby6+4nW78T7N6jw1OC8y6ctS/8DwRrKV+DQD4IJNxfYLgD0aCpVkQtsQBe38tPyYrGhlcFcwfgpVvKp1EHKABKzWU4CYAui19iB5AAXmVADmDSgxxADgB3BmkMYLqz+gfnTsCVyp+1EuU/ergDUUbVBVCm/sHxBFxJAHPrwsufG+oCIAFQpiQA0w2gpwBNBJluLQTu7Cq49kMC9s5/Q3BGzFFw4RdyTYryLVPRpI4d5vvjw499E9i0sWFRbBIHsBzRQgkoCzfwMYAEIAHgw5rLurNpbSUACQBORFFJFfUYqC5ADiAHkAOwDzZQCywLJweQA8gB5AB9upYGgX2ymTxWQV1Aiv3pDx4djENwm8l5XtYCvHvmg/uTVG97tPEBwd0/Ha++cz59PsKs695affvZlzc/Q+V7w+tQvDFBj4Ekpf9icn+yRgLguUqClACS0FpOUAmgnFwlqakEkITWAoJerCuUAArIVcoqSgAp2S0gtgRAkjR3GTYJspwYCWA589JfreaItxwBeP9459b6TcJMopnA5877p6R8F8KNiJs6VRRdlwFEBbB/On53cn4NLbQ1nQ9Q0ExglTORVADJXga9EQF0pwAtvv5YAkjw1bSSpoIlAAmAHdZc0suouruAfqz/5dAsuwMscmjNrPFl3QLod1SdXQD9Nsf2OrjsQWA/zEkAGgNoDMDuJb4kTU8BjNFkKI0BOLXqAnJ2AXEEfNa6gI4q9a75NH7qHU1b4vwbpqJTnE9wtfZ3n7TqXgbM/sVzDL4lHDTev08X2lrOJ7B0AaSeKTHYASyVeCMzoZYK9YJNMwbopWoLBJEAMHkSAKZKDpDkkCTMvwUoB8BsyQEwVXKAhRwgxez4zNzJAbCs5QCYKjnAQg6Aee4DKAfALMoBMFVyADkA/WwddqD8C1IMDrB/PL5ObpdJs/JRHPL9SLAWzEr7Yu7++NUY8I/WndMvcVnKp+3/y1B+olXRuFmmqWAa1bYggUbNvz+e15Qji3IA2iwJgDLlnATAucp+QoahqhgqAWCq1AUYqDJADYNAGlVdAGVKXQBnKiLpkihT0MxgdQGGBEgABrIwVF0ApioFUA5gYFUOYCALQxM4gOWjRbieERhaj84cCCuT57u3ttj5AJYKQKxlf37ThK/j/PJtGJrC8PkIbeu+2729/jMJjDdtp3oKIJW8wOC5eENMDK21/RIAlIAEEL8FGA27+w5Arp8cYMS2xlkSJAeAbMkB5ABVOqAcQA7AGKjVAlnru/n9OsdAcgCoAAmg0jsA5l8OUOsdIAFABrrFk5Om2STwFOcDWPbnkzpaMZb9+ZbY+HyA1p9tr208tMQmWDwGIMFeYvK/DbPUNi8298uwZAKI52Lc6c7H0O//GahWALHZceJEv3kMSADzGKr8/xJAVQm2b5eXAKoSgL0xEoCds6quGKQAKv4GlFmcgxSAmSXjBfae2FhAj3AJoEcySwyVWwB/A6OnkMyQojWgAAAAAElFTkSuQmCC",Re={WATCHLISTS:"burnlist_watchlists",UNIVERSES:"burnlist_universes",SCREENERS:"burnlist_screeners",TRADE_JOURNAL:"trade_journal_trades",FETCH_COUNT:"burnlist_fetch_count",LAST_REFRESH:"burnlist_last_refresh_",UNIVERSE_TOGGLES:"universe_toggles_",CHART_DATA:"burnlist_chart_data_"};class Bs{constructor(){this.isAvailable=this.checkAvailability()}checkAvailability(){try{const e="__storage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch{return!1}}get(e,r=null){if(!this.isAvailable)return r;try{const n=localStorage.getItem(e);return n?JSON.parse(n):r}catch(n){return console.error(`Failed to get item from localStorage: ${e}`,n),r}}set(e,r){if(!this.isAvailable)return!1;try{return localStorage.setItem(e,JSON.stringify(r)),!0}catch(n){return console.error(`Failed to set item in localStorage: ${e}`,n),!1}}remove(e){if(!this.isAvailable)return!1;try{return localStorage.removeItem(e),!0}catch(r){return console.error(`Failed to remove item from localStorage: ${e}`,r),!1}}clear(){if(!this.isAvailable)return!1;try{return localStorage.clear(),!0}catch(e){return console.error("Failed to clear localStorage",e),!1}}getWatchlists(){return this.get(Re.WATCHLISTS,{})}setWatchlists(e){return this.set(Re.WATCHLISTS,e)}getUniverses(){return this.get(Re.UNIVERSES,{})}setUniverses(e){return this.set(Re.UNIVERSES,e)}getTradeJournal(){return this.get(Re.TRADE_JOURNAL,[])}setTradeJournal(e){return this.set(Re.TRADE_JOURNAL,e)}getLastRefresh(e){return this.get(`${Re.LAST_REFRESH}${e}`)}setLastRefresh(e,r){return this.set(`${Re.LAST_REFRESH}${e}`,r)}getUniverseToggles(e){return this.get(`${Re.UNIVERSE_TOGGLES}${e}`,{})}setUniverseToggles(e,r){return this.set(`${Re.UNIVERSE_TOGGLES}${e}`,r)}getScreeners(){return this.get(Re.SCREENERS,{})}setScreeners(e){return this.set(Re.SCREENERS,e)}getFetchCount(){return this.get(Re.FETCH_COUNT,0)}setFetchCount(e){return this.set(Re.FETCH_COUNT,e)}getChartData(e){return this.get(`${Re.CHART_DATA}${e}`,[])}setChartData(e,r){return this.set(`${Re.CHART_DATA}${e}`,r)}}const De=new Bs,vt="/assets/logoblack-1754416489227.png",rt=()=>{const[t,e]=x.useState(""),[r,n]=x.useState("info"),[i,s]=x.useState(null);x.useEffect(()=>()=>{i&&clearTimeout(i)},[i]);const a=x.useCallback((u,p="info")=>{if(i&&clearTimeout(i),e(u),n(p),u){const d=setTimeout(()=>{e(""),n("info")},4e3);s(d)}},[i]),c=x.useCallback(()=>{i&&(clearTimeout(i),s(null)),e(""),n("info")},[i]);return{notification:t,notificationType:r,setNotification:a,setNotificationType:n,clearNotification:c}},Ar=t=>t.toString().toLowerCase().trim().replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-"),Ls="rgb(140,185,162)",_s=({watchlists:t={},setWatchlists:e})=>{const r=He();Xe();const[n,i]=x.useState("terminal"),{notification:s,notificationType:a,setNotification:c,setNotificationType:u}=rt(),[p,d]=x.useState(!1),[h,C]=x.useState(!1),k="MAX",[f,m]=x.useState(!1),[S,y]=x.useState(null),{isInverted:v,toggleTheme:L}=Ue(),N=ne(Ls),K=ne("black"),se=ne("#e31507"),J=ne("#888"),z=x.useMemo(()=>{const F=Object.values(t).flatMap(Y=>(Y.items||[]).map(P=>P.symbol)).filter(Y=>Y&&typeof Y=="string"&&!Y.startsWith("#"));return Array.from(new Set(F.map(Y=>Y.toUpperCase())))},[t]),[R,b]=x.useState(()=>De.getFetchCount());function q(){const F=new Date,Y=new Date(F.toLocaleString("en-US",{timeZone:"America/New_York"}));return Y.getHours()===9&&Y.getMinutes()===29}x.useEffect(()=>{const F=setInterval(()=>{q()&&(b(0),De.setFetchCount(0))},6e4);return()=>clearInterval(F)},[]);const D=F=>{if(!F)return"Unknown";try{const Y=new Date(F),P=String(Y.getDate()).padStart(2,"0"),A=String(Y.getMonth()+1).padStart(2,"0"),T=String(Y.getFullYear()).slice(-2);return`${P}-${A}-${T}`}catch{return"Unknown"}};x.useEffect(()=>()=>{Le.cancelFetch("homepage")},[]);const M=()=>{C(!0),setTimeout(()=>C(!1),150);const F=ln[Math.floor(Math.random()*ln.length)],Y=Ar(F);if(Object.values(t).some($=>$.name&&$.name.toLowerCase()===F.toLowerCase())){c("⚠️ Name already exists"),u("error");return}const A={id:Pt(),name:F,slug:Y,items:[],reason:"",startDate:null,createdAt:new Date().toISOString()},T={...t,[A.id]:A};e(T),De.setWatchlists(T),c(`Created watchlist: ${F}`)},re=F=>{const Y=Object.keys(t).find(T=>t[T].id===F);if(!Y){l.log("🗑️ Could not find watchlist with id:",F);return}const{[Y]:P,...A}=t;e(A),De.setWatchlists(A),P?l.log("🗑️ Deleted watchlist:",P.name):l.log("🗑️ Deleted watchlist with id:",F)};x.useCallback((F,Y)=>{if(Object.values(t).some(A=>A.id!==F&&A.name&&A.name.toLowerCase()===Y.toLowerCase())){c("⚠️ Name already exists"),u("error");return}e(A=>{const T={...A};return T[F]&&(T[F]={...T[F],name:Y,slug:Ar(Y)}),De.setWatchlists(T),T})},[e,t]);const Z=x.useCallback((F,Y)=>{const P={...t,[F]:{...t[F],reason:Y}};e(P),De.setWatchlists(P)},[e,t]),O=()=>{try{const F={watchlists:De.getWatchlists(),universes:De.getUniverses(),screeners:De.getScreeners(),screenerSettings:De.get(STORAGE_KEYS.SCREENER_SETTINGS,{}),tradeJournal:De.getTradeJournal(),fetchCount:De.getFetchCount()},Y={storage:F,exportInfo:{timestamp:new Date().toISOString(),totalKeys:Object.keys(F).length,keys:Object.keys(F)}},P=JSON.stringify(Y,null,2),A=new Blob([P],{type:"application/json"}),T=document.createElement("a");T.href=URL.createObjectURL(A),T.download=`burnlist_complete_backup_${new Date().toISOString().split("T")[0]}.json`,T.click(),c(`✅ All storage data exported (${Object.keys(F).length} keys)`,"success")}catch(F){l.error("Export error:",F),c("❌ Export failed","error")}},w=F=>{const Y=F.target.files[0];if(!Y)return;const P=new FileReader;P.onload=A=>{try{const T=JSON.parse(A.target.result);if(T.localStorage&&T.exportInfo){const $=T.localStorage;let W=0;if(Object.keys($).forEach(Q=>{try{const _=$[Q];typeof _=="string"?localStorage.setItem(Q,_):localStorage.setItem(Q,JSON.stringify(_)),W++}catch(_){l.warn(`Could not import localStorage key: ${Q}`,_)}}),$.burnlist_watchlists)try{const Q=typeof $.burnlist_watchlists=="string"?JSON.parse($.burnlist_watchlists):$.burnlist_watchlists;e(Q)}catch(Q){l.warn("Could not parse watchlists data",Q)}if($.burnlist_fetch_count)try{const Q=typeof $.burnlist_fetch_count=="string"?parseInt($.burnlist_fetch_count):$.burnlist_fetch_count;b(Q)}catch(Q){l.warn("Could not parse fetch count data",Q)}c(`✅ Complete backup imported (${W} keys)`,"success")}else{if(!T.watchlists||typeof T.watchlists!="object")throw new Error("Invalid data format: missing watchlists");e(T.watchlists),De.setWatchlists(T.watchlists),T.fetchCount!==void 0&&(b(T.fetchCount),De.setFetchCount(T.fetchCount)),T.tradeJournalTrades&&Array.isArray(T.tradeJournalTrades)&&De.setTradeJournal(T.tradeJournalTrades),c("✅ Legacy data imported successfully","success")}}catch(T){l.error("Import error:",T),c("❌ Import failed: Invalid file format","error")}},P.readAsText(Y),F.target.value=""},[H,U]=x.useState({});x.useEffect(()=>{if(p){const F={};Object.values(t).forEach(Y=>{F[Y.id]={value:Y.name,prev:Y.name}}),U(F)}else U({})},[p,t]);const E=(F,Y)=>{U(P=>({...P,[F]:{...P[F],value:Y}}))},V=F=>{var A;const Y=((A=H[F])==null?void 0:A.value)||"";if(Object.values(t).some(T=>T.id!==F&&T.name&&T.name.toLowerCase()===Y.toLowerCase())){c("⚠️ Name already exists"),u("error"),U(T=>({...T,[F]:{...T[F],value:T[F].prev}}));return}e(T=>{const $={...T};return $[F]&&($[F]={...$[F],name:Y,slug:Ar(Y)}),De.setWatchlists($),$}),U(T=>({...T,[F]:{...T[F],prev:Y}}))},I=x.useMemo(()=>Object.values(t),[t]),te=x.useMemo(()=>I.map(F=>{const Y=F.items||[];if(!Y.length)return 0;const P=Y.map(A=>{var Q,_;const T=A.historicalData;if(!Array.isArray(T)||T.length<2)return 0;const $=(Q=T[0])==null?void 0:Q.price,W=(_=T[T.length-1])==null?void 0:_.price;return typeof $!="number"||typeof W!="number"||$===0?0:(W-$)/$*100});return P.reduce((A,T)=>A+T,0)/P.length}),[I]),oe=x.useRef(null);return o.jsx("div",{style:{fontFamily:"Courier New",color:N,backgroundColor:K,minHeight:"100vh",padding:"0",transition:"background 0.3s, color 0.3s"},children:o.jsxs("div",{style:{padding:"32px"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:24,flexWrap:"wrap",gap:"12px"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:12},title:"Test tooltip - hover to see if tooltips work",children:[o.jsx("button",{onClick:L,style:{border:"none",background:"none",padding:0,cursor:"pointer",display:"flex",alignItems:"center",minHeight:"44px"},"aria-label":"Toggle theme",children:o.jsx("img",{src:v?vt:Ct,alt:"Burnlist Logo",style:{width:44,height:44,marginRight:10,transition:"filter 0.3s"}})}),o.jsx("strong",{style:{fontSize:"170%",lineHeight:"44px",display:"inline-block",color:N,height:"44px"},children:"BURNLIST v1.1"})]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[o.jsx("span",{style:{color:se,fontWeight:"bold",fontSize:12},children:z.length}),o.jsx("span",{style:{color:N,fontWeight:"bold",fontSize:12},children:R}),o.jsx("span",{onClick:()=>{const F=De.getWatchlists();l.log("🧪 Current storage watchlists:",F)},style:{cursor:"pointer",color:N},children:"ACCOUNT: local"})]})]}),o.jsx(tt,{}),s&&o.jsx("div",{style:{position:"fixed",top:24,left:0,right:0,zIndex:10001,display:"flex",justifyContent:"center",pointerEvents:"none"},children:o.jsx("div",{style:{minWidth:320,maxWidth:480,pointerEvents:"auto"},children:o.jsx(Oe,{message:s,type:a,onClose:()=>c("")})})}),f&&o.jsx(Oe,{message:"Loading watchlists...",type:"loading"}),S&&o.jsx(Oe,{message:S,type:"error",onClose:()=>y(null)}),Object.keys(t).length===0&&o.jsx("p",{children:"No watchlists found."}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(252px, 252px))",rowGap:"20px",columnGap:"20px",margin:"70px 0 1px 0",justifyContent:"center",alignItems:"start"},children:I.map((F,Y,P)=>{var me;const A=F.items||[],T=te[Y],$=T>=0;let W=null,Q=null,_=A.length===0?"None":"LOW";if(A.length>0){const de=A.map(pe=>{var ke,Ae;const fe=pe.historicalData;if(!Array.isArray(fe)||fe.length<2)return{symbol:pe.symbol,return:0};const we=(ke=fe[0])==null?void 0:ke.price,qe=(Ae=fe[fe.length-1])==null?void 0:Ae.price;if(typeof we!="number"||typeof qe!="number"||we===0)return{symbol:pe.symbol,return:0};const We=(qe-we)/we*100;return{symbol:pe.symbol,return:We}});W=de.reduce((pe,fe)=>fe.return>pe.return?fe:pe,de[0]),Q=de.reduce((pe,fe)=>fe.return<pe.return?fe:pe,de[0]);const ce=Math.min(...de.map(pe=>pe.return)),ye=Math.max(...de.map(pe=>pe.return))-ce;ce<-20||ye>50?_="HIGH":ce<-10||ye>30?_="MED":_="LOW"}let ie="Unknown";if(A.length>0){const de=A.flatMap(ce=>{var ge;return((ge=ce.historicalData)==null?void 0:ge.map(ye=>new Date(ye.timestamp).getTime()))||[]});if(de.length>0){const ce=Math.max(...de),ge=Date.now(),ye=Math.floor((ge-ce)/(1e3*60*60));ye<1?ie="Just now":ye<24?ie=`${ye}h ago`:ie=`${Math.floor(ye/24)}d ago`}}const he=o.jsxs("div",{style:{width:"100%",maxWidth:252,height:p?160:n==="graph"?200:120,fontFamily:"Courier New",background:"transparent",padding:"10px 8px",margin:0,border:`1px solid ${N}`,borderRadius:0,boxShadow:"none",display:"flex",flexDirection:"column",alignItems:"stretch",justifyContent:"flex-start",position:"relative",boxSizing:"border-box",overflow:"hidden"},children:[p?o.jsx("input",{value:((me=H[F.id])==null?void 0:me.value)??F.name,onChange:de=>E(F.id,de.target.value),onBlur:()=>V(F.id),onKeyDown:de=>{de.key==="Enter"&&(de.preventDefault(),V(F.id))},style:{fontFamily:"Courier New",fontSize:16,color:N,background:"transparent",border:`1px solid ${N}`,marginBottom:2,padding:"2px 4px",width:"100%",fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",minHeight:"24px"}}):o.jsx("div",{style:{fontSize:18,color:N,fontWeight:"bold",marginBottom:4,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",cursor:"pointer"},title:`Watchlist: ${F.name||`PORTFOLIO ${Y+1}`} | Stocks: ${A.length} | Created: ${D(F.createdAt)}`,onClick:()=>r(`/burn/${F.slug}`),children:F.name||`PORTFOLIO ${Y+1}`}),p&&o.jsx("button",{onClick:()=>re(F.id),style:{backgroundColor:"transparent",color:se,border:`1px solid ${se}`,padding:"1px 4px",marginBottom:2,fontSize:9,width:"100%",fontWeight:"bold",fontFamily:"Courier New",cursor:"pointer",minHeight:"16px"},title:"Delete this watchlist",children:"DELETE"}),p?o.jsx("input",{value:F.reason||"",onChange:de=>Z(F.id,de.target.value),style:{fontFamily:"Courier New",fontSize:12,color:N,background:"transparent",border:`1px solid ${N}`,marginBottom:2,padding:"1px 3px",width:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",minHeight:"18px"},placeholder:"Reason..."}):n!=="graph"&&o.jsx("div",{style:{fontSize:14,color:N,marginBottom:4,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:F.reason||"N/A"}),o.jsxs("div",{style:{fontSize:13,color:N,marginBottom:2,cursor:"help"},title:`Risk Level: ${_} | Best: ${(W==null?void 0:W.symbol)||"N/A"} | Worst: ${(Q==null?void 0:Q.symbol)||"N/A"}`,children:[A.length," stocks | Risk: ",_]}),o.jsx("div",{style:{fontSize:11,color:J,marginBottom:2,cursor:"help"},title:`Last Update: ${ie} | Data Age: ${ie}`,children:ie}),n!=="graph"&&A.length>0&&o.jsxs("div",{style:{fontSize:19,color:$?N:se,fontWeight:"bold",cursor:"help"},title:`Return: ${T>=0?"+":""}${T.toFixed(2)}% | Timeframe: MAX`,children:[T>=0?"+":"",T.toFixed(2),"%"]}),n==="graph"&&A.length>0&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{style:{fontSize:19,color:$?N:se,fontWeight:"bold",marginBottom:2},children:[T>=0?"+":"",T.toFixed(2),"%"]}),o.jsx("div",{style:{width:"100%",maxWidth:180,height:94,alignSelf:"flex-end",border:`1.5px solid ${N}`,borderRadius:0,background:"transparent",padding:1,marginTop:2,display:"flex",justifyContent:"flex-end",alignItems:"flex-end"},children:o.jsx(zr,{portfolioReturnData:A.map(de=>({symbol:de.symbol,buyDate:de.buyDate,historicalData:de.historicalData,timeframe:k})),showBacktestLine:!1,height:94,lineColor:$?N:se,hideAxes:!0,hideBorder:!0,showTooltip:!1,mini:!0})})]})]});return o.jsx("div",{style:{margin:0},children:p?he:o.jsx(Mt,{to:`/watchlist/${F.slug}`,style:{textDecoration:"none",color:"inherit"},children:he})},F.id)})}),o.jsxs("div",{className:"action-buttons-container",children:[o.jsx("style",{children:`
            .action-buttons-container {
              position: fixed;
              bottom: 20px;
              right: 20px;
              display: flex;
              gap: 8px;
              z-index: 1000;
            }
            
            @media (max-width: 768px) {
              .action-buttons-container {
                position: fixed;
                top: 50%;
                right: 10px;
                transform: translateY(-50%);
                flex-direction: column;
                gap: 8px;
              }
            }
            
            @media (max-width: 480px) {
              .action-buttons-container {
                position: fixed;
                top: 50%;
                right: 8px;
                transform: translateY(-50%);
                flex-direction: column;
                gap: 6px;
              }
            }
            
            .action-button {
              background: ${K};
              color: ${N};
              border: 1px solid ${N};
              font-size: 12px;
              padding: 6px 12px;
              box-shadow: 0 2px 4px rgba(0,0,0,0.3);
              min-height: 32px;
              font-family: 'Courier New', monospace;
              cursor: pointer;
              text-decoration: none;
              display: flex;
              align-items: center;
              justify-content: center;
            }
            
            @media (max-width: 768px) {
              .action-button {
                font-size: 10px;
                padding: 6px 8px;
                min-height: 32px;
                width: 60px;
              }
            }
            
            @media (max-width: 480px) {
              .action-button {
                font-size: 9px;
                padding: 4px 6px;
                min-height: 28px;
                width: 50px;
              }
            }
          `}),o.jsx("button",{onClick:M,className:"action-button",style:{backgroundColor:N,color:K,fontWeight:"bold",fontSize:"14px",transition:"all 0.2s ease-in-out",padding:"8px 16px"},children:"+++"}),o.jsx("button",{onClick:()=>{d(!p),l.log("🛠️ Edit mode:",!p)},className:"action-button",style:{textTransform:"lowercase",fontWeight:400,letterSpacing:1},children:p?"done":"edit"}),o.jsx("input",{type:"file",accept:".json",onChange:w,style:{display:"none"},ref:oe}),o.jsx("button",{onClick:()=>oe.current&&oe.current.click(),className:"action-button",style:{textTransform:"lowercase",fontWeight:400,letterSpacing:1},children:"import"}),o.jsx("button",{onClick:O,className:"action-button",style:{textTransform:"lowercase",fontWeight:400,letterSpacing:1},children:"export"})]})]})})},Mr=new Set,Fr=new Set;async function zs(){try{console.log("📊 NASDAQ symbol loading disabled (CORS issues) - using fallback"),["AAPL","MSFT","GOOGL","GOOG","AMZN","TSLA","META","NVDA","NFLX","ADBE","CRM","PYPL","INTC","AMD","QCOM","AVGO","TXN","MU","AMAT","KLAC","LRCX","ASML","TSM","NVDA","AMD","INTC","QCOM","AVGO","TXN","MU","AMAT","KLAC","LRCX","ASML","TSM","AAPL","MSFT","GOOGL","GOOG","AMZN","TSLA","META","NVDA","NFLX","ADBE","CRM","PYPL","INTC","AMD","QCOM"].forEach(e=>Mr.add(e)),console.log(`📊 Loaded ${Mr.size} NASDAQ symbols from fallback list`)}catch(t){console.warn("⚠️ Error loading NASDAQ symbols:",t)}}async function Us(){try{console.log("📊 NYSE symbol loading disabled (file not found) - using fallback"),["SPY","QQQ","IWM","VTI","VOO","VEA","VWO","BND","GLD","SLV","USO","TLT","TBT","TMF","TMV","UVXY","VXX","XLE","XLF","XLK","XLV","XLI","XLP","XLY","XLU","XLB","XLC","XBI","IBB","SOXL","SOXS","TQQQ","SQQQ","LABU","LABD","DPST","WDRN","JNUG","JDST","NUGT","DUST","YANG","YINN","ERX","ERY","FAS","FAZ","TNA","TZA","UPRO","SPXU","UDOW","SDOW","UMDD","SMDD","URTY","SRTY","JPM","BAC","WFC","C","GS","MS","AIG","GE","XOM","CVX","KO","PEP","WMT","HD","MCD","DIS","NKE","BA","CAT","MMM","IBM","INTC","CSCO","ORCL","VZ","T","ATT","CMCSA","CMCSK"].forEach(e=>Fr.add(e)),console.log(`📊 Loaded ${Fr.size} NYSE symbols from fallback list`)}catch(t){console.warn("⚠️ Error loading NYSE symbols:",t)}}let un=!1;async function so(){un||(await zs(),await Us(),un=!0)}async function Ws(t){if(!t)return"NASDAQ";await so();const e=t.toUpperCase();if(Mr.has(e))return"NASDAQ";if(Fr.has(e))return"NYSE";try{const r=await fetch(`https://query1.finance.yahoo.com/v8/finance/chart/${e}`);if(!r.ok)return console.warn(`⚠️ Could not fetch exchange info for ${t}, using pattern detection`),qt(e);const n=await r.json();if(n.chart&&n.chart.result&&n.chart.result[0]){const i=n.chart.result[0];if(i.meta&&i.meta.exchangeName){const s=i.meta.exchangeName.toUpperCase();return s.includes("NASDAQ")?"NASDAQ":s.includes("NYSE")||s.includes("NEW YORK")?"NYSE":s.includes("AMEX")||s.includes("ARCA")?"AMEX":qt(e)}}return qt(e)}catch(r){return console.warn(`⚠️ Error fetching exchange info for ${t}:`,r),qt(e)}}function qt(t){return t.length>=4&&t.length<=5?"NASDAQ":t.length===3?"NYSE":"NASDAQ"}const Tr=new Map;async function Hr(t){const e=t.toUpperCase();if(Tr.has(e))return Tr.get(e);const r=await Ws(e);return Tr.set(e,r),r}so();const bt=t=>{if(!t)return"-";const e=new Date(t);if(isNaN(e.getTime()))return"-";const r=String(e.getDate()).padStart(2,"0"),n=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getFullYear()).slice(-2);return`${r}-${n}-${i}`},pn="rgb(149,184,163)",Gt="#e31507",Hs=({item:t,index:e,editMode:r,selectedTimeframe:n="W",handleChangeSymbol:i,handleBuyPriceChange:s,handleBuyDateChange:a,handleRevertBuyDate:c,handleFetchHistoricalData:u,handleDelete:p,handleRefreshPrice:d,items:h,changePercent:C,lookedUpBuyPrice:k,isInactive:f=!1})=>{var z,R;const m=ne(pn),S=ne(Gt),y=ne("black");if(l.log(`🔍 [TICKER ROW RENDER] ${(t==null?void 0:t.symbol)||"unknown"}:`),l.log(`  - Index: ${e}`),l.log(`  - Timeframe: ${n}`),l.log(`  - Historical data points: ${((z=t==null?void 0:t.historicalData)==null?void 0:z.length)||0}`),l.log(`  - Buy price: $${t==null?void 0:t.buyPrice}`),l.log(`  - Current price: $${t==null?void 0:t.currentPrice}`),l.debug("TickerRow received item:",t),l.debug("Historical Data:",t.historicalData),!t||!Array.isArray(t.historicalData))return l.warn("⛔ Invalid item or missing historicalData for row",t),null;let v=NaN,L=NaN,N=0;try{if(n==="MAX"&&h&&h.length>0?(v=Number(t.buyPrice),l.log(`🔍 [TICKER ROW SHARED BASELINE] ${t.symbol}: Using shared baseline price = $${v}`)):(v=Number(t.buyPrice)||0,l.log(`🔍 [TICKER ROW INDIVIDUAL BASELINE] ${t.symbol}: Using individual baseline price = $${v}`)),t.historicalData&&t.historicalData.length>0){const b=t.historicalData[0],q=t.historicalData[t.historicalData.length-1];t.historicalData.length===1||new Date(b==null?void 0:b.timestamp)<new Date(q==null?void 0:q.timestamp)?L=Number(q==null?void 0:q.price):L=Number(b==null?void 0:b.price)}typeof t.currentPrice=="number"&&(L=t.currentPrice),!isNaN(v)&&!isNaN(L)&&v>0&&(N=(L-v)/v*100),l.log(`🔍 [TICKER ROW NAV DEBUG] ${t.symbol}:`),l.log(`  - Timeframe: ${n}`),l.log(`  - Baseline Price: $${v}`),l.log(`  - Current Price: $${L}`),l.log(`  - Return %: ${N.toFixed(2)}%`)}catch(b){l.error(`Error calculating NAV for ${t.symbol}:`,b),v=Number(t.buyPrice)||0,L=t.currentPrice||0,N=C||0}if(l.debug(`[DEBUG PRICES] ${t.symbol}:`),l.debug("item.buyPrice (stored):",t.buyPrice),l.debug("Historical data length:",(R=t.historicalData)==null?void 0:R.length),t.historicalData&&t.historicalData.length>0){const b=t.historicalData[0],q=t.historicalData[t.historicalData.length-1];l.debug(`First historical point: ${b==null?void 0:b.timestamp} → $${b==null?void 0:b.price}`),l.debug(`Last historical point: ${q==null?void 0:q.timestamp} → $${q==null?void 0:q.price}`),l.debug("Are timestamps ascending?",new Date(b==null?void 0:b.timestamp)<new Date(q==null?void 0:q.timestamp))}if(isNaN(v))return l.warn(`⛔ Skipping row: No valid buy price resolved for ${t.symbol}`),null;l.debug(`[ChangePercent Prop] ${t.symbol}:`,C),l.debug(`Rendering row for ${t.symbol}`);const K=async b=>{if(b)try{const q=await Hr(b),M=`https://www.tradingview.com/chart/i0seCgVv/?symbol=${encodeURIComponent(`${q}:${b.toUpperCase()}`)}`;window.open(M,"_blank")}catch(q){l.warn(`⚠️ Error opening chart for ${b}:`,q);const M=`https://www.tradingview.com/chart/i0seCgVv/?symbol=${encodeURIComponent(`NASDAQ:${b.toUpperCase()}`)}`;window.open(M,"_blank")}},J=(()=>{if(!t.historicalData||t.historicalData.length===0)return"Unknown";const b=t.historicalData[t.historicalData.length-1];if(!b||!b.timestamp)return"Unknown";const q=new Date(b.timestamp),M=new Date-q,re=Math.floor(M/(1e3*60*60));return re<1?"Just now":re<24?`${re}h ago`:`${Math.floor(re/24)}d ago`})();return o.jsxs("tr",{style:{borderBottom:`1px solid ${m}`,background:y},children:[o.jsx("td",{style:{padding:8,fontFamily:"'Courier New', Courier, monospace",color:m,fontSize:15,textAlign:"center"},title:`Symbol: ${t.symbol} | Type: ${t.type||"stock"} | Last updated: ${J}`,children:r?o.jsx("input",{type:"text",value:t.symbol,onChange:b=>{typeof i=="function"&&i(e,b.target.value)},style:{fontFamily:"'Courier New', Courier, monospace",fontSize:"1rem",backgroundColor:y,border:`1px solid ${m}`,color:m,padding:4,width:80,textAlign:"center"},title:"Edit ticker symbol"}):o.jsx("span",{onClick:()=>K(t.symbol),style:{cursor:"pointer",textDecoration:"underline",display:"flex",alignItems:"center",gap:"4px",justifyContent:"center"},title:`Click to open ${t.symbol} chart in new tab - Last updated: ${J}`,children:o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",justifyContent:"center"},children:[(()=>{if(h.filter(q=>q.symbol===t.symbol).length>1){const q=h.slice(0,e).filter(M=>M.symbol===t.symbol).length,D="*".repeat(q+1);return t.symbol+D}return t.symbol})(),f&&o.jsx("span",{style:{fontSize:"10px",color:S,fontWeight:"bold",backgroundColor:"rgba(227, 21, 7, 0.1)",padding:"2px 4px",borderRadius:"2px",border:`1px solid ${S}`},title:"No price update in over 1 trading day",children:"⚠ INACTIVE"})]})})}),o.jsx("td",{style:{padding:8,fontFamily:"'Courier New', Courier, monospace",color:m,fontSize:15,textAlign:"center"},title:`${r?"Stored Buy Price":"Baseline Price"}: $${isNaN(v)?"N/A":v.toFixed(2)} | Buy Date: ${t.buyDate}`,children:r?o.jsx("input",{type:"number",value:isNaN(v)?"":v,step:"0.01",min:"0",onChange:b=>{typeof s=="function"&&s(e,parseFloat(b.target.value))},style:{fontFamily:"'Courier New', Courier, monospace",fontSize:"1rem",backgroundColor:y,border:`1px solid ${m}`,color:m,padding:4,width:80,textAlign:"center"}}):isNaN(v)?"-":v.toFixed(2)}),o.jsx("td",{style:{padding:8,fontFamily:"'Courier New', Courier, monospace",color:m,fontSize:15,textAlign:"center"},title:`Buy Date: ${t.buyDate} | Formatted: ${bt(t.buyDate)}${t.buyDateMetadata?" | Custom date":""}`,children:r?o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,justifyContent:"center"},children:[o.jsx("input",{type:"date",value:t.buyDate?t.buyDate.slice(0,10):"",onChange:b=>{typeof a=="function"&&a(e,b.target.value)},style:{fontFamily:"'Courier New', Courier, monospace",fontSize:"1rem",backgroundColor:y,border:`1px solid ${m}`,color:m,padding:4,width:120,textAlign:"center"}}),t.buyDateMetadata&&typeof c=="function"&&o.jsx("button",{onClick:()=>c(e),title:`Revert to original buy date: ${t.buyDateMetadata.originalBuyDate?bt(t.buyDateMetadata.originalBuyDate):"original"}`,style:{fontFamily:"'Courier New', Courier, monospace",fontSize:"0.8rem",backgroundColor:"transparent",border:`1px solid ${m}`,color:m,padding:"2px 6px",cursor:"pointer",borderRadius:2,minWidth:"auto",height:"auto"},onMouseOver:b=>{b.target.style.backgroundColor=m,b.target.style.color=y},onMouseOut:b=>{b.target.style.backgroundColor="transparent",b.target.style.color=m},children:"↶"}),o.jsx("style",{children:`
                input[type="date"]::-webkit-calendar-picker-indicator {
                  filter: invert(1) brightness(0.8) sepia(1) saturate(5) hue-rotate(140deg);
                }
                input[type="date"]::-webkit-clear-button {
                  display: none !important;
                }
                input[type="date"]::-webkit-inner-spin-button {
                  display: none !important;
                }
              `})]}):o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,justifyContent:"center"},children:[bt(t.buyDate),t.buyDateMetadata&&o.jsx("span",{style:{fontSize:"0.8rem",opacity:.7},title:"Custom buy date",children:"⚙"})]})}),o.jsx("td",{style:{padding:8,fontFamily:"'Courier New', Courier, monospace",color:m,fontSize:15,textAlign:"center"},title:`Current Price: $${isNaN(L)?"N/A":L.toFixed(2)} | Last updated: ${J}`,children:isNaN(L)?"-":L.toFixed(2)}),o.jsx("td",{style:{padding:8,fontFamily:"'Courier New', Courier, monospace",color:m,fontSize:15,textAlign:"center"},children:(()=>{const b=Number(N),q=isFinite(b),D=()=>{const M=new Date;switch(n){case"D":return new Date(M.getTime()-864e5).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});case"W":return new Date(M.getTime()-7*24*60*60*1e3).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});case"M":return new Date(M.getTime()-30*24*60*60*1e3).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});case"YTD":return new Date(M.getFullYear(),0,1).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});case"MAX":return"original buy date";default:return"baseline date"}};return q?o.jsxs("span",{title:`ETF-style return: ${b>=0?"+":""}${b.toFixed(2)}% from ${D()} | Timeframe: ${n}`,style:{color:b>=0?pn:Gt,fontFamily:"'Courier New', Courier, monospace"},children:[b.toFixed(2),"%"]}):o.jsxs(o.Fragment,{children:[l.warn("⚠️ Missing or invalid changePercent for",t.symbol),o.jsx("span",{title:"Change % not available",style:{color:ne("#888888"),fontFamily:"'Courier New', Courier, monospace"},children:"0.00%"})]})})()}),r&&o.jsx("td",{style:{padding:8,textAlign:"center"},children:o.jsx(Ce,{onClick:()=>{typeof p=="function"&&p(e)},style:{background:"transparent",color:Gt,border:`1px solid ${Gt}`,fontFamily:"'Courier New', monospace",textTransform:"lowercase",fontWeight:400,letterSpacing:1,boxShadow:"none",borderRadius:2},children:"delete"})}),o.jsx("td",{})]},e)},Vs=Ke.memo(Hs),qs="rgb(140,185,162)",Gs=({children:t,style:e={}})=>{const r=ne(qs),n=ne("black");return o.jsx("div",{className:"mobile-table-wrapper",style:{border:`1px solid ${r}`,background:n,...e},children:t})},Js="rgb(140,185,162)",Qs="rgb(120,150,130)",Ys=({items:t,editMode:e,handleChangeSymbol:r,handleBuyPriceChange:n,handleBuyDateChange:i,handleRevertBuyDate:s,handleFetchHistoricalData:a,handleDelete:c,handleRefreshPrice:u,selectedTimeframe:p="W",showInactiveBadges:d=!1})=>{const h=ne(Js),C=ne("black"),k=ne(Qs);x.useMemo(()=>{if(!Array.isArray(t)||t.length===0)return 0;try{let y=0,v=0;t.forEach(N=>{try{const K=N.historicalData&&N.historicalData.length>0?N.historicalData[N.historicalData.length-1].price:0,se=N.currentPrice||(N.historicalData&&N.historicalData.length>0?N.historicalData[0].price:0);if(K>0&&se>0){const J=(se-K)/K*100;y+=J,v++}}catch(K){l.error(`Error calculating return for ${N.symbol}:`,K)}});const L=v>0?y/v:0;return l.log(`🔍 [TICKER TABLE NAV DEBUG] Average return: ${L.toFixed(2)}%`),L}catch(y){return l.error("Error calculating average return:",y),0}},[t,p]);const f=x.useMemo(()=>Array.isArray(t)?[...t].sort((y,v)=>(y.symbol||"").localeCompare(v.symbol||"")):[],[t]),m=y=>{if(!y.lastPriceUpdate)return!0;const v=new Date(y.lastPriceUpdate),L=new Date,N=new Date(L.getTime()-4*60*60*1e3);return v<N},S=y=>o.jsx("span",{style:{marginLeft:"4px"},children:"↑"});return!Array.isArray(t)||t.length===0?o.jsx("div",{style:{textAlign:"center",padding:60,color:k,fontFamily:"'Courier New'",background:"rgba(0,0,0,0.3)",borderRadius:"8px",border:`1px solid ${h}`,fontSize:"1.1rem"},children:"No tickers in watchlist."}):o.jsx(Gs,{children:o.jsxs("table",{style:{width:"100%",borderCollapse:"separate",borderSpacing:0,fontSize:"14.5px",background:"rgba(0,0,0,0.2)",borderRadius:"8px",overflow:"hidden"},children:[o.jsx("thead",{children:o.jsxs("tr",{style:{background:"linear-gradient(135deg, rgba(149,184,163,0.1) 0%, rgba(149,184,163,0.05) 100%)",borderBottom:`2px solid ${h}`},children:[o.jsxs("th",{style:{padding:"16px 12px",textAlign:"center",color:h,fontWeight:"bold",fontSize:"14.5px",userSelect:"none",transition:"background-color 0.2s",cursor:"pointer",borderRight:"1px solid rgba(149,184,163,0.2)",width:e?"16.66%":"20%"},children:["Symbol ",S()]}),o.jsx("th",{style:{padding:"16px 12px",textAlign:"center",color:h,fontWeight:"bold",fontSize:"14.5px",userSelect:"none",transition:"background-color 0.2s",cursor:"pointer",borderRight:"1px solid rgba(149,184,163,0.2)",width:e?"16.66%":"20%"},children:"Buy Price"}),o.jsx("th",{style:{padding:"16px 12px",textAlign:"center",color:h,fontWeight:"bold",fontSize:"14.5px",userSelect:"none",transition:"background-color 0.2s",cursor:"pointer",borderRight:"1px solid rgba(149,184,163,0.2)",width:e?"16.66%":"20%"},children:"Buy Date"}),o.jsx("th",{style:{padding:"16px 12px",textAlign:"center",color:h,fontWeight:"bold",fontSize:"14.5px",userSelect:"none",transition:"background-color 0.2s",cursor:"pointer",borderRight:"1px solid rgba(149,184,163,0.2)",width:e?"16.66%":"20%"},children:"Current Price"}),o.jsxs("th",{style:{padding:"16px 12px",textAlign:"center",color:h,fontWeight:"bold",fontSize:"14.5px",userSelect:"none",transition:"background-color 0.2s",cursor:"pointer",borderRight:"1px solid rgba(149,184,163,0.2)",width:e?"16.66%":"20%"},children:["Change % ",S()]}),e&&o.jsx("th",{style:{color:h,borderBottom:`1px solid ${h}`,fontFamily:"Courier New",background:C,padding:"16px 12px",textAlign:"center",fontWeight:"bold",fontSize:"14.5px",width:"16.66%"},children:"Actions"})]})}),o.jsx("tbody",{children:f.map((y,v)=>{l.log(`🩹 Rendering row for ${y.symbol}`);const L=t.findIndex(N=>N.symbol===y.symbol&&N.buyDate===y.buyDate&&N.buyPrice===y.buyPrice);return o.jsx(Vs,{item:{...y},index:L,editMode:e,handleChangeSymbol:r,handleBuyPriceChange:typeof n=="function"?n:void 0,handleBuyDateChange:typeof i=="function"?i:void 0,handleRevertBuyDate:typeof s=="function"?s:void 0,handleFetchHistoricalData:typeof a=="function"?a:void 0,handleDelete:typeof c=="function"?c:void 0,handleRefreshPrice:typeof u=="function"?u:void 0,items:t,selectedTimeframe:p,changePercent:0,lookedUpBuyPrice:0,isInactive:d?m(y):!1},`${y.symbol}-${L}`)})})]})})},ao=Ke.memo(Ys),Ks="rgb(149,184,163)",lo=({editMode:t,setEditMode:e})=>(ne("black"),o.jsx("div",{style:{marginTop:0,textAlign:"right"},children:o.jsx(Ce,{onClick:()=>e(!t),style:{background:"transparent",color:Ks,border:"none",fontFamily:"'Courier New', monospace",textTransform:"lowercase",fontWeight:400,letterSpacing:1,margin:0,boxShadow:"none",borderRadius:2,fontSize:15,display:"flex",alignItems:"center",justifyContent:"center",minWidth:"40px",height:"40px",padding:"8px 16px"},children:o.jsx("img",{src:"/src/assets/edit.png",alt:"EDIT",style:{width:"20px",height:"20px",filter:"brightness(0) saturate(100%) invert(85%) sepia(15%) saturate(638%) hue-rotate(86deg) brightness(95%) contrast(87%)"}})})})),Xs="rgb(140,185,162)",co=({children:t,height:e=400,style:r={}})=>{const n=ne(Xs),i=ne("black");return o.jsx("div",{style:{width:"100%",height:e,border:`1px solid ${n}`,background:i,position:"relative",overflow:"hidden",touchAction:"pan-x pan-y",...r},children:o.jsx("div",{style:{width:"100%",height:"100%",position:"relative",overflow:"auto",WebkitOverflowScrolling:"touch"},children:t})})},it="rgb(149,184,163)",kt="rgb(120,150,130)",Zs=({isOpen:t,onClose:e,onConfirm:r,title:n="Select Start Date"})=>{const[i,s]=x.useState(""),a=ne("black"),c=()=>{i&&(r(i),e())},u=()=>{e()},p=new Date().toISOString().split("T")[0];return t?o.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e4},children:o.jsxs("div",{style:{background:a,border:`2px solid ${it}`,padding:"20px",minWidth:"300px",fontFamily:"'Courier New', monospace",color:it},children:[o.jsx("h3",{style:{margin:"0 0 20px 0",textAlign:"center",fontSize:"16px"},children:n}),o.jsx("div",{style:{marginBottom:"20px",textAlign:"center"},children:o.jsx("input",{type:"date",value:i,onChange:d=>s(d.target.value),max:p,style:{background:"transparent",border:`1px solid ${it}`,color:it,padding:"8px 12px",fontSize:"14px",fontFamily:"'Courier New', monospace",outline:"none",width:"200px"}})}),o.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"10px"},children:[o.jsx("button",{onClick:u,style:{background:"transparent",border:`1px solid ${kt}`,color:kt,padding:"8px 16px",fontSize:"12px",fontFamily:"'Courier New', monospace",cursor:"pointer"},onMouseEnter:d=>{d.target.style.background=kt,d.target.style.color="black"},onMouseLeave:d=>{d.target.style.background="transparent",d.target.style.color=kt},children:"Cancel"}),o.jsx("button",{onClick:c,disabled:!i,style:{background:i?it:"transparent",border:`1px solid ${it}`,color:i?"black":kt,padding:"8px 16px",fontSize:"12px",fontFamily:"'Courier New', monospace",cursor:i?"pointer":"not-allowed",opacity:i?1:.5},onMouseEnter:d=>{i&&(d.target.style.background=it,d.target.style.color="black")},onMouseLeave:d=>{i&&(d.target.style.background=it,d.target.style.color="black")},children:"Confirm"})]})]})}):null};function uo(t,e="MAX"){if(!Array.isArray(t)||t.length===0)return{averagePrice:0,totalValue:0,itemCount:0,priceRange:{min:0,max:0},dateRange:{earliest:null,latest:null},totalBuyValue:0,totalGainLoss:0,averageGainLossPercent:0};const r=t.filter(f=>f&&Number(f.buyPrice)>0&&f.buyDate&&Array.isArray(f.historicalData)&&f.historicalData.length>0);if(r.length===0)return{averagePrice:0,totalValue:0,itemCount:0,priceRange:{min:0,max:0},dateRange:{earliest:null,latest:null},totalBuyValue:0,totalGainLoss:0,averageGainLossPercent:0};const n=new Set;r.forEach(f=>{f.historicalData.forEach(m=>{n.add(new Date(m.timestamp).getTime())})});const s=Array.from(n).sort((f,m)=>f-m)[0],a=r.map(f=>{const m=[...f.historicalData].sort((y,v)=>new Date(y.timestamp)-new Date(v.timestamp)),S=ea(m,new Date(s));return S?S.price:0}).filter(f=>f>0);if(a.length===0)return{averagePrice:0,totalValue:0,itemCount:0,priceRange:{min:0,max:0},dateRange:{earliest:null,latest:null},totalBuyValue:0,totalGainLoss:0,averageGainLossPercent:0};const c=a.reduce((f,m)=>f+m,0)/a.length,u=r.map(f=>{let m=f.currentPrice;if(typeof m!="number"||m<=0){const S=[...f.historicalData].sort((y,v)=>new Date(y.timestamp)-new Date(v.timestamp));m=S.length>0?Number(S[S.length-1].price):0}return m}).filter(f=>f>0);if(u.length===0)return{averagePrice:0,totalValue:0,itemCount:0,priceRange:{min:0,max:0},dateRange:{earliest:null,latest:null},totalBuyValue:0,totalGainLoss:0,averageGainLossPercent:0};const p=u.reduce((f,m)=>f+m,0)/u.length,d=c>0?(p-c)/c*100:0,h={min:Math.min(...u),max:Math.max(...u)},C=r.map(f=>new Date(f.buyDate)),k={earliest:new Date(Math.min(...C)),latest:new Date(Math.max(...C))};return{averagePrice:Number(p.toFixed(2)),totalValue:Number((p*r.length).toFixed(2)),itemCount:r.length,priceRange:h,dateRange:k,totalBuyValue:Number((c*r.length).toFixed(2)),totalGainLoss:Number(((p-c)*r.length).toFixed(2)),averageGainLossPercent:Number(d.toFixed(2))}}function ea(t,e){if(t.length===0)return null;const r=e.getTime();let n=t[0],i=Math.abs(new Date(n.timestamp).getTime()-r);for(const s of t){const a=new Date(s.timestamp).getTime(),c=Math.abs(a-r);c<i&&(i=c,n=s)}return n}function po(t){if(!Array.isArray(t)||t.length===0)return{twap:0,weightedPrices:[]};const e=t.filter(c=>c&&Number(c.buyPrice)>0&&c.buyDate);if(e.length===0)return{twap:0,weightedPrices:[]};const r=new Date,n=e.map(c=>{const u=new Date(c.buyDate),p=(r-u)/(1e3*60*60*24),d=Math.max(1,p);return{symbol:c.symbol,buyPrice:Number(c.buyPrice),buyDate:u,weight:d,weightedPrice:Number(c.buyPrice)*d}}),i=n.reduce((c,u)=>c+u.weightedPrice,0),s=n.reduce((c,u)=>c+u.weight,0),a=s>0?i/s:0;return{twap:Number(a.toFixed(2)),weightedPrices:n}}function go(t,e="D"){if(!Array.isArray(t)||t.length===0)return{beta:0,confidence:0,marketCorrelation:0};const r=t.filter(n=>n&&Array.isArray(n.historicalData)&&n.historicalData.length>0);if(r.length===0)return{beta:0,confidence:0,marketCorrelation:0};try{const n=r.map(h=>{const C=[...h.historicalData].sort((S,y)=>new Date(S.timestamp)-new Date(y.timestamp));if(C.length<2)return null;let k=[];const m={D:1,W:7,M:30,Y:365}[e]||1;for(let S=m;S<C.length;S++){const y=Number(C[S].price),v=Number(C[S-m].price);if(v>0){const L=(y-v)/v*100;k.push(L)}}return{symbol:h.symbol,returns:k,avgReturn:k.length>0?k.reduce((S,y)=>S+y,0)/k.length:0,volatility:k.length>0?Math.sqrt(k.reduce((S,y)=>S+Math.pow(y-k.reduce((v,L)=>v+L,0)/k.length,2),0)/k.length):0}}).filter(h=>h!==null);if(n.length===0)return{beta:0,confidence:0,marketCorrelation:0};const i=r.reduce((h,C)=>{var f;const k=Number(((f=C.historicalData[C.historicalData.length-1])==null?void 0:f.price)||0);return h+k},0),s=r.reduce((h,C,k)=>{var y;const f=Number(((y=C.historicalData[C.historicalData.length-1])==null?void 0:y.price)||0),m=i>0?f/i:0,S=n.find(v=>v.symbol===C.symbol);return h+m*((S==null?void 0:S.volatility)||0)},0),a=n.reduce((h,C)=>h+C.volatility,0)/n.length,c=a>0?s/a:1,u=n.reduce((h,C)=>h+C.returns.length,0)/n.length,p=Math.min(100,Math.max(0,u/30*100)),d=Math.min(1,Math.max(-1,c*.8));return{beta:Number(c.toFixed(2)),confidence:Number(p.toFixed(0)),marketCorrelation:Number(d.toFixed(2)),portfolioVolatility:Number(s.toFixed(2)),avgMarketVolatility:Number(a.toFixed(2))}}catch(n){return l.error("Error calculating portfolio beta:",n),{beta:0,confidence:0,marketCorrelation:0}}}function ta(t){var e;if(!Array.isArray(t)||t.length===0)return l.debug("[SIMPLE NAV] No portfolio data, returning empty array"),[];try{if(l.debug(`[SIMPLE NAV] Calculating NAV for ${t.length} tickers`),l.debug("[SIMPLE NAV] First ticker data:",t[0]),t.length===1){l.debug("[SIMPLE NAV] Using single ticker fast path");const u=t[0];if(l.debug("[SIMPLE NAV] Ticker has historicalData:",!!u.historicalData),l.debug("[SIMPLE NAV] HistoricalData is array:",Array.isArray(u.historicalData)),l.debug("[SIMPLE NAV] HistoricalData length:",(e=u.historicalData)==null?void 0:e.length),!u.historicalData||!Array.isArray(u.historicalData)||u.historicalData.length===0)return l.warn("[SIMPLE NAV] Single ticker has no historical data"),[];const p=u.historicalData[u.historicalData.length-1].price,d=u.historicalData[0].price;if(l.debug(`[SIMPLE NAV] Buy price: ${p}, Current price: ${d}`),p<=0||d<=0)return l.warn("[SIMPLE NAV] Invalid prices for single ticker"),[];const h=(d-p)/p*100;l.debug(`[SIMPLE NAV] Single ticker ${u.symbol}: ${d} vs ${p} = ${h.toFixed(2)}%`);const C=[{timestamp:new Date().toISOString().split("T")[0]+" "+new Date().getHours().toString().padStart(2,"0")+":"+new Date().getMinutes().toString().padStart(2,"0")+":"+new Date().getSeconds().toString().padStart(2,"0"),returnPercent:h,etfPrice:d,validTickers:1,totalTickers:1}],k=C[0].returnPercent;return C[0].returnPercent=0,l.debug(`[SIMPLE NAV] Single ticker normalized: baseline ${k.toFixed(2)}%, chart starts at 0%`),l.debug("[SIMPLE NAV] Returning result:",C),C}l.debug("[SIMPLE NAV] Using multi-ticker path");const r=[];let n=0;for(const u of t){if(!u.historicalData||!Array.isArray(u.historicalData)||u.historicalData.length===0)continue;n=Math.max(n,u.historicalData.length);const p=u.historicalData[u.historicalData.length-1].price;if(p<=0)continue;const d=new Map;for(const h of u.historicalData)h.timestamp&&h.price>0&&d.set(h.timestamp,h.price);r.push({symbol:u.symbol,buyPrice:p,priceMap:d})}if(r.length===0)return l.warn("[SIMPLE NAV] No valid tickers found"),[];let i=1;n>100?(i=20,l.debug(`[SIMPLE NAV] Large dataset (${n} timestamps per ticker), sampling every 20th`)):n>20?(i=5,l.debug(`[SIMPLE NAV] Medium dataset (${n} timestamps per ticker), sampling every 5th`)):l.debug(`[SIMPLE NAV] Small dataset (${n} timestamps per ticker), using all timestamps`);const s=new Set;for(const u of r){const p=Array.from(u.priceMap.keys()).sort();l.debug(`[SIMPLE NAV] Ticker ${u.symbol} has ${p.length} timestamps:`,p.slice(-5));for(let d=0;d<p.length;d+=i)s.add(p[d]);p.length>0&&s.add(p[p.length-1])}if(s.size===0)return l.warn("[SIMPLE NAV] No valid timestamps found"),[];const a=Array.from(s).sort();l.debug(`[SIMPLE NAV] Processing ${a.length} sampled timestamps for ${r.length} tickers`),l.debug("[SIMPLE NAV] Last 5 timestamps:",a.slice(-5));const c=[];for(let u=0;u<a.length;u++){const p=a[u];let d=0,h=0,C=0;for(const S of r){const y=S.priceMap.get(p);if(y&&y>0){const v=(y-S.buyPrice)/S.buyPrice*100;Number.isFinite(v)&&(d+=v,C+=y,h++)}}const k=h>0?d/h:0,f=h>0?C/h:0,m=p;c.push({timestamp:m,returnPercent:k,etfPrice:f,validTickers:h,totalTickers:r.length})}if(l.debug(`[SIMPLE NAV] Calculated ${c.length} NAV points with sampling interval ${i}`),c.length>0){const u=c[0].returnPercent;l.debug(`[SIMPLE NAV] First point return: ${u.toFixed(2)}%, normalizing to 0%`),c.forEach(p=>{p.returnPercent=p.returnPercent-u}),l.debug("[SIMPLE NAV] Multi-ticker normalized: chart starts at 0%")}return c}catch(r){return l.error("[SIMPLE NAV] Error calculating simple NAV:",r),[]}}const ra={calculateSimpleNAV:ta},Fe="rgb(149,184,163)",gn="rgb(120,150,130)",na=(t,e)=>{const r=new Date(t),n=new Date(e);if(r>n)return 0;let i=0;const s=new Date(r);s.setHours(0,0,0,0);const a=new Date(n);for(a.setHours(0,0,0,0);s<=a;){const c=s.getDay();c>=1&&c<=5&&i++,s.setDate(s.getDate()+1)}return i},oa=()=>{const t=new Date,e=new Date(t.toLocaleString("en-US",{timeZone:"America/New_York"})),r=e.getDay(),n=e.getHours(),i=e.getMinutes(),s=n*100+i;return!(r===0||r===6||s<930||s>=1600)},ia=({watchlists:t,setWatchlists:e})=>{var w,H,U,E,V;const{slug:r}=Ft(),n=He(),{isInverted:i}=Ue(),s="MAX",[a,c]=x.useState(!1),[u,p]=x.useState(!1),[d,h]=x.useState(""),[C,k]=x.useState([]),[f,m]=x.useState(null),[S,y]=x.useState(!0),[v,L]=x.useState(!1),[N,K]=x.useState([]),{notification:se,notificationType:J,setNotification:z}=rt(),R=x.useMemo(()=>!t||!r?null:Object.values(t).find(I=>I.slug===r)||null,[t,r]);x.useEffect(()=>{if(f){const I=Date.now()-f,te=3e3;if(I<te){y(!1);const oe=te-I;setTimeout(()=>y(!0),oe)}else y(!0)}},[f]);const b=x.useMemo(()=>{if(!(R!=null&&R.items)||R.items.length===0)return{averageReturn:0,etfPriceData:null,twapData:null,betaData:null,realStockCount:0,inactiveTickers:0};try{let I=0;C.length>0&&(I=C[C.length-1].returnPercent||0);const te=uo(R.items,s),oe=po(R.items),F=go(R.items,s),Y=R.items.filter(P=>P.type==="real").length;return{averageReturn:I,etfPriceData:te,twapData:oe,betaData:F,realStockCount:Y,inactiveTickers:0}}catch(I){return l.error("Error calculating portfolio metrics:",I),{averageReturn:0,etfPriceData:null,twapData:null,betaData:null,realStockCount:0,inactiveTickers:0}}},[R==null?void 0:R.items,s,C]);x.useMemo(()=>R!=null&&R.items?R.items.map(I=>({symbol:I.symbol,buyDate:I.buyDate,buyPrice:I.buyPrice,historicalData:I.historicalData,timeframe:s,isInactive:!1})):[],[R==null?void 0:R.items,s]);const q=async(I,te)=>{try{c(!0),z(`Fetching initial daily data for ${I.length} tickers...`,"info");const oe=na(te,new Date);l.info(`📊 Trading days from ${te} to now: ${oe}`);const F=I.join(","),Y=await fetch(`/api/twelvedata-historical?symbols=${F}&interval=1day&outputsize=${oe}&start_date=${te}`);if(!Y.ok)throw new Error(`HTTP ${Y.status}: ${Y.statusText}`);const P=await Y.json();if(P.status==="error")throw new Error(`API Error: ${P.message||"Unknown error"}`);const A=[];let T=P;P.status==="ok"&&P.historicalData&&(T={},I.forEach($=>{T[$]={historicalData:P.historicalData.map(W=>({price:parseFloat(W.close||W.price),close:parseFloat(W.close||W.price),open:parseFloat(W.open),high:parseFloat(W.high),low:parseFloat(W.low),timestamp:W.datetime||W.timestamp,volume:parseInt(W.volume),symbol:$}))}}));for(const $ of I){const W=T[$];if(W&&W.historicalData&&W.historicalData.length>0){const Q=W.historicalData,_=Q[0].price,ie=Q[Q.length-1].price;console.log(`🔍 Historical data for ${$}:`,Q.slice(0,3)),console.log(`🔍 First price (current): ${_}, Last price (buy): ${ie}`);const he={symbol:$,historicalData:Q,buyPrice:ie,buyDate:te,currentPrice:_,lastPriceUpdate:new Date().toISOString(),type:"real"};A.push(he),l.info(`✅ Added ${$} with ${Q.length} daily data points`)}else l.error(`❌ No data received for ${$}`)}return A}catch(oe){throw l.error("Error fetching initial daily data:",oe),oe}finally{c(!1)}},D=async()=>{if(!(!R||!S)){c(!0),m(Date.now());try{console.log("🔄 Manual fetch triggered for",R.items.length,"tickers");const I=[];let te=!1;const oe=oa(),Y=R.items.map(T=>T.symbol).join(","),A=await fetch(`/api/twelvedata-quote?symbols=${Y}&interval=1min`);if(A.ok){const T=await A.json();if(T.status==="error")throw new Error(`API Error: ${T.message||"Unknown error"}`);for(const $ of R.items){const W=T[$.symbol];if(W&&W.price){const Q=new Date,ie={timestamp:Q.toISOString().split("T")[0]+" "+Q.getHours().toString().padStart(2,"0")+":"+Q.getMinutes().toString().padStart(2,"0")+":"+Q.getSeconds().toString().padStart(2,"0"),price:W.price,volume:W.volume||0};$.historicalData.push(ie),$.currentPrice=ie.price,$.lastPriceUpdate=new Date().toISOString(),te=!0,console.log(`✅ Updated ${$.symbol} with new price: $${ie.price} at ${ie.timestamp}`)}I.push($)}}if(te){console.log("🔄 Updating watchlist with new data");const T={...t},$=Object.keys(T).find(W=>T[W].slug===r);$&&(T[$].items=I,e(T),await M(I),console.log("✅ NAV calculation completed with new data"))}else console.log("ℹ️ No new data to update");z("Prices fetched successfully","success")}catch(I){console.error("❌ Error in manual fetch:",I),z("Failed to fetch prices","error")}finally{c(!1)}}},M=x.useCallback(async I=>{if(!(!I||I.length===0))try{l.debug(`[WATCHLIST NAV] Calculating NAV for ${I.length} tickers using simple navCalculator`),c(!0);const te=await new Promise(oe=>{setTimeout(()=>{const F=ra.calculateSimpleNAV(I);oe(F)},0)});if(!te||te.length===0){l.warn("[WATCHLIST NAV] No NAV data returned from simple navCalculator"),k([]);return}l.debug(`[WATCHLIST NAV] Simple navCalculator returned ${te.length} NAV points`),k(te),l.debug(`[WATCHLIST NAV] Set ${te.length} NAV points for chart`)}catch(te){l.error("❌ Error calculating NAV with simple navCalculator:",te),k([])}finally{c(!1)}},[]);x.useEffect(()=>{R!=null&&R.items&&R.items.length>0&&(l.debug(`[WATCHLIST] Auto-calculating NAV for ${R.items.length} tickers`),M(R.items))},[R==null?void 0:R.items,s,M]);const re=async(I=d.split(",").map(oe=>oe.trim()),te=R.startDate)=>{if(!(!R||!I||I.length===0))try{c(!0),z(`Adding ${I.length} tickers with start date ${te}...`,"info");const oe=await q(I,te);if(oe.length>0){const F={...t},Y=Object.keys(F).find(P=>F[P].slug===r);Y&&(F[Y].items.push(...oe),e(F),await M(F[Y].items),z(`${oe.length} tickers added with daily data`,"success"))}}catch(oe){l.error("Error adding tickers:",oe),z(`Failed to add tickers: ${oe.message}`,"error")}finally{c(!1)}},Z=(I,te)=>{if(!R)return;const oe={...t},F=Object.keys(oe).find(Y=>oe[Y].slug===r);F&&(oe[F].items[I].buyPrice=parseFloat(te),e(oe),M(oe[F].items))},O=I=>{if(!R)return;const te={...t},oe=Object.keys(te).find(F=>te[F].slug===r);oe&&(te[oe].items.splice(I,1),e(te),M(te[oe].items),z("Ticker removed","success"))};return x.useEffect(()=>{R!=null&&R.items&&R.items.length>0&&(console.log("🔄 Initializing NAV calculation for",R.items.length,"tickers"),M(R.items))},[R==null?void 0:R.items,M]),x.useEffect(()=>{r&&!R&&(z("Watchlist not found","error"),n("/"))},[r,R,n,z]),R?o.jsxs("div",{style:{background:"black",color:Fe,minHeight:"100vh",fontFamily:"'Courier New', monospace",position:"relative"},children:[se&&o.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,zIndex:10001,display:"flex",justifyContent:"center",pointerEvents:"none"},children:o.jsx("div",{style:{minWidth:320,maxWidth:480,pointerEvents:"auto"},children:o.jsx(Oe,{message:se,type:J,onClose:()=>z("")})})}),o.jsxs("div",{style:{padding:"20px 20px 0 20px",marginBottom:"30px",marginTop:b.etfPriceData&&b.etfPriceData.averagePrice>0?"50px":"0px"},children:[o.jsx("div",{style:{position:"absolute",top:"-25px",right:"20px",fontSize:"23px",fontWeight:"bold",color:Fe,fontFamily:"'Courier New', monospace",zIndex:10},children:R.name}),o.jsx("div",{style:{position:"absolute",top:"-25px",left:"20px",zIndex:10},children:o.jsx("button",{onClick:()=>n("/"),style:{background:"transparent",border:"none",cursor:"pointer",padding:0,display:"flex",alignItems:"center",justifyContent:"center"},children:o.jsx("img",{src:"/src/assets/backbutton.png",alt:"Back",style:{width:"30px",height:"30px",filter:"brightness(0) saturate(100%) invert(85%) sepia(15%) saturate(638%) hue-rotate(86deg) brightness(95%) contrast(87%)"}})})}),o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 20px",backgroundColor:"rgba(0,0,0,0.3)",border:`2px solid ${Fe}`,borderRadius:"6px",marginTop:"16px",fontFamily:"'Courier New', monospace",fontSize:"14px",color:Fe},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[o.jsx("span",{children:"NAV: 100% confidence"}),o.jsxs("span",{children:[((w=R.items)==null?void 0:w.length)||0,"/",((H=R.items)==null?void 0:H.length)||0," active"]})]}),o.jsxs("div",{children:["Last NAV: ",f?new Date(f).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0}):"Never"]})]})]}),o.jsxs("div",{style:{padding:"0 20px 20px 20px",maxWidth:"1400px",margin:"0 auto"},children:[o.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px",flexWrap:"wrap",gap:"12px"}}),o.jsx("div",{style:{marginBottom:"24px"},children:o.jsx(co,{height:505,children:o.jsx(zr,{portfolioReturnData:((U=R.items)==null?void 0:U.map(I=>({symbol:I.symbol,buyDate:I.buyDate,buyPrice:I.buyPrice,historicalData:I.historicalData,timeframe:s})))||[],watchlistSlug:r,timeframe:s,showBacktestLine:!1,height:500,showTooltip:!0,suppressEmptyMessage:!0,navData:C,navMetadata:{confidenceScore:100,validTickers:((E=R.items)==null?void 0:E.length)||0,totalTickers:((V=R.items)==null?void 0:V.length)||0,marketStatus:"manual"}})})}),o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px",padding:"0 4px"},children:[o.jsx("button",{onClick:D,disabled:a||!S,style:{background:"transparent",color:Fe,border:"none",padding:"8px 16px",fontSize:"12px",fontFamily:"'Courier New'",cursor:a||!S?"not-allowed":"pointer",opacity:a||!S?.5:1,display:"flex",alignItems:"center",justifyContent:"center",minWidth:"40px",height:"40px"},onMouseEnter:I=>{!a&&S&&(I.target.style.background=Fe,I.target.style.color="black")},onMouseLeave:I=>{I.target.style.background="transparent",I.target.style.color=Fe},children:a?o.jsx("span",{style:{fontSize:"12px"},children:"..."}):o.jsx("img",{src:"/src/assets/get.png",alt:"GET",style:{width:"20px",height:"20px",filter:"brightness(0) saturate(100%) invert(85%) sepia(15%) saturate(638%) hue-rotate(86deg) brightness(95%) contrast(87%)"}})}),o.jsx(lo,{editMode:u,setEditMode:p})]}),o.jsx("div",{style:{marginBottom:"24px"},children:Array.isArray(R.items)&&R.items.length>0?o.jsx(ao,{items:R.items,selectedTimeframe:s,editMode:u,handleBuyPriceChange:Z,handleBuyDateChange:()=>{},handleRevertBuyDate:()=>{},handleFetchHistoricalData:()=>{},handleDelete:O,handleRefreshPrice:()=>{},showInactiveBadges:!1}):o.jsx("div",{style:{fontFamily:"'Courier New', monospace",color:gn,textAlign:"center",padding:"40px 20px",fontSize:"1.1rem"},children:"⚠️ No tickers in this watchlist yet."})}),o.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:"20px"},children:o.jsxs("div",{style:{display:"flex",alignItems:"center",width:"100%",maxWidth:"400px",height:"32px"},children:[o.jsx("input",{type:"text",value:d,onChange:I=>h(I.target.value),placeholder:"e.g. SPY, QQQ",style:{flex:1,height:"32px",fontFamily:"'Courier New', monospace",backgroundColor:"black",border:`2px solid ${Fe}`,borderRight:"none",color:Fe,outline:"none",padding:"0 8px",fontSize:"14px",margin:"0",boxSizing:"border-box"},onKeyDown:I=>{I.key==="Enter"&&!I.shiftKey&&(I.preventDefault(),re())}}),o.jsx("button",{onClick:re,disabled:a||!d.trim(),style:{width:"60px",height:"32px",fontSize:"14px",fontFamily:"'Courier New', monospace",backgroundColor:"transparent",color:Fe,border:`2px solid ${Fe}`,borderLeft:"none",borderTopLeftRadius:"0",borderBottomLeftRadius:"0",cursor:a||!d.trim()?"not-allowed":"pointer",opacity:1,display:"flex",alignItems:"center",justifyContent:"center",padding:"0",margin:"0",boxSizing:"border-box",fontWeight:"bold"},onMouseEnter:I=>{!a&&d.trim()&&(I.target.style.background=Fe,I.target.style.color="black")},onMouseLeave:I=>{I.target.style.background="transparent",I.target.style.color=Fe},children:a?"...":"+++"})]})})]}),o.jsx(Zs,{isOpen:v,onClose:()=>L(!1),onConfirm:async I=>{const te={...t},oe=Object.keys(te).find(F=>te[F].slug===r);oe&&(te[oe]={...te[oe],startDate:I},e(te),await re(N,I))},title:"Select Start Date for Watchlist"})]}):o.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",fontFamily:"'Courier New', monospace",color:Fe,background:"black"},children:o.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",textAlign:"center",padding:"2rem",background:"black",border:`2px solid ${Fe}`},children:[o.jsx("div",{style:{fontSize:"1.5rem",marginBottom:"1rem"},children:"Loading watchlist..."}),o.jsx("div",{style:{fontSize:"0.9rem",color:gn},children:"Initializing NAV calculations"})]})})};function hr(t){return typeof t!="string"?"":t.trim().toUpperCase().replace(/\s+/g,"")}function Or(t){const e=hr(t);return/^#?\w{1,10}$/.test(e)}async function sa(t,e="real",r=null,n=null){var s,a;if(!t||typeof t!="string")return l.error("❌ createTicker: Invalid symbol provided:",t),null;t=hr(t);const i=new Date().toISOString();try{l.log(`🌐 Fetching real ticker data for ${t}`),l.log(`📊 Fetching 3 years of 5-minute historical data for ${t}`);const c=await hs(t);if(!c||c.length===0)return l.warn(`⚠️ No historical data received for ${t}`),null;l.log(`✅ Received ${c.length} historical data points for ${t}`),Pr(c)||l.warn(`⚠️ Irregular 5-minute spacing detected for ${t}`);const u=c[c.length-1];let p=u.price,d=u.timestamp;try{const{fetchQuote:k}=await jt(()=>Promise.resolve().then(()=>er),void 0),f=await k(t);f&&f.buyPrice?(p=f.buyPrice,d=f.buyDate,l.log(`💰 Updated current price for ${t}: $${p} (from quote endpoint)`)):l.warn(`⚠️ Could not fetch current price for ${t}, using historical data: $${p}`)}catch(k){l.warn(`⚠️ Error fetching current price for ${t}, using historical data: $${p}`,k)}const h={symbol:t,buyPrice:r!==null&&!isNaN(Number(r))?Number(r):p,buyDate:n&&!isNaN(Date.parse(n))?n:d,historicalData:c,currentPrice:p,addedAt:i,type:"real"};if(l.log(`💰 Buy price for ${t}: $${h.buyPrice}`),l.log(`📅 Buy date for ${t}: ${h.buyDate}`),l.log(`📊 Historical data points: ${c.length}`),r!==null&&!isNaN(Number(r))||n&&!isNaN(Date.parse(n))){const k={price:h.buyPrice,timestamp:h.buyDate,symbol:t};c.some(m=>new Date(m.timestamp).getTime()===new Date(h.buyDate).getTime())||(c.push(k),c.sort((m,S)=>new Date(m.timestamp)-new Date(S.timestamp)),l.log(`📊 Added custom buy point to historical data for ${t}`))}const C=Wr(h);return l.log("✅ createTicker returning real ticker with 3-year historical data:",{symbol:C.symbol,buyPrice:C.buyPrice,buyDate:C.buyDate,historicalDataPoints:C.historicalData.length,dataRange:`${new Date((s=C.historicalData[0])==null?void 0:s.timestamp).toISOString()} to ${new Date((a=C.historicalData[C.historicalData.length-1])==null?void 0:a.timestamp).toISOString()}`}),C}catch(c){return l.error(`❌ createTicker failed for ${t}:`,c),null}}const ho="/assets/backbutton-1754416489227.png";function Et(t,e,r){return t<=e?0:t>=r?100:(t-e)/(r-e)*100}function aa(t){return t<=15?100:t<=30?70:t<=50?40:0}function la(t){return t>=1.2&&t<=2.5?100:50}function ca({epsGrowth:t,avgVolume:e,relVolume:r,technicalFlags:n,earningsDaysAway:i,price:s,pe:a,marketCap:c,beta:u,newsFlag:p,sectorAlignment:d,marketSupport:h,volatilityClear:C,breadthHealthy:k}={}){let f=0,m=0;t!=null&&t!==""&&(f+=Et(t,0,50)*.15,m+=.15),e!=null&&e!==""&&(f+=Et(e,5e5,2e6)*.12,m+=.12),r!=null&&r!==""&&(f+=Et(r,1,3)*.1,m+=.1),n!=null&&(f+=(n?100:0)*.1,m+=.1),i!=null&&i!==""&&(f+=(i>5?100:0)*.1,m+=.1),s!=null&&s!==""&&(f+=Et(s,7,50)*.08,m+=.08),a!=null&&a!==""&&(f+=aa(a)*.08,m+=.08),c!=null&&c!==""&&(f+=Et(c,5e8,5e10)*.07,m+=.07),u!=null&&u!==""&&(f+=la(u)*.05,m+=.05),p!=null&&(f+=(p?100:0)*.02,m+=.02);const S=m>0?f*(70/(100*m)):0;let y=0;d&&(y+=10),h&&(y+=10),C&&(y+=5),k&&(y+=5);const v=S+y;let L="Standby";return v>=90?L="Prime Entry":v>=75&&(L="Almost Ready"),{coreSetupScore:Math.round(S*100)/100,contextScore:y,totalBuyScore:Math.round(v*100)/100,tag:L}}var fo={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},hn=Ke.createContext&&Ke.createContext(fo),da=["attr","size","title"];function ua(t,e){if(t==null)return{};var r=pa(t,e),n,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(i=0;i<s.length;i++)n=s[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function pa(t,e){if(t==null)return{};var r={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(e.indexOf(n)>=0)continue;r[n]=t[n]}return r}function ir(){return ir=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},ir.apply(this,arguments)}function fn(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function sr(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?fn(Object(r),!0).forEach(function(n){ga(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):fn(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function ga(t,e,r){return e=ha(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ha(t){var e=fa(t,"string");return typeof e=="symbol"?e:e+""}function fa(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function mo(t){return t&&t.map((e,r)=>Ke.createElement(e.tag,sr({key:r},e.attr),mo(e.child)))}function ma(t){return e=>Ke.createElement(ya,ir({attr:sr({},t.attr)},e),mo(t.child))}function ya(t){var e=r=>{var{attr:n,size:i,title:s}=t,a=ua(t,da),c=i||r.size||"1em",u;return r.className&&(u=r.className),t.className&&(u=(u?u+" ":"")+t.className),Ke.createElement("svg",ir({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},r.attr,n,a,{className:u,style:sr(sr({color:t.color||r.color},r.style),t.style),height:c,width:c,xmlns:"http://www.w3.org/2000/svg"}),s&&Ke.createElement("title",null,s),t.children)};return hn!==void 0?Ke.createElement(hn.Consumer,null,r=>e(r)):e(fo)}function xa(t){return ma({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z"},child:[]}]})(t)}const Nt="/assets/greenflag-1754416489227.png",Jt="/assets/redflag-1754416489227.png",lt="/assets/yellowflag-1754416489227.png",Qt="/assets/box-1754416489227.png",Yt="/assets/checkbox-1754416489227.png",ba="/assets/excecute-1754416489227.png",ee="rgb(140,185,162)",Sa="#888",$e={breakout:{name:"Breakout",checklists:["Horizontal resistance tested at least 2–3 times","Tight consolidation range (3–7 bars) near resistance","No overlapping wicks or indecision candles near breakout zone","Volume increasing into resistance (1-day Relative Volume > 1.5)","RSI between 50–65 and rising","MACD bullish crossover or trending upward","Price within 5% of 52-week high","No major macro event or earnings within next 7 days","Clean air above breakout level (no nearby supply)"],newsValidation:["Catalyst present in last 3 days (e.g. earnings beat, analyst upgrade, sector momentum)","Headline or PR confirms why price is reacting","Price action matches news intensity (no fade after news)"]},pullback:{name:"Pullback",checklists:["Strong uptrend visible on daily chart","Pullback to support (20 EMA, 50 SMA, or breakout retest)","Low volume during the pullback vs prior rally","Candle structure is clean (no breakdown bars or gaps)","Reversal signal forming (hammer, engulfing, inside bar)","RSI between 35–50, curling up","MACD flattening or turning bullish","Relative Volume (3–5 day avg) > 1.2","No earnings within next 5 days","Pullback has not broken prior swing low"],newsValidation:["Recent catalyst (earnings, analyst note, macro driver) caused last rally","Catalyst is still relevant (not priced in / not reversed)","If no news, chart structure alone justifies trade"]},shortSqueeze:{name:"Short Squeeze",checklists:["Wide-range breakout candle on high volume","Gap + hold or strong Day 1/Day 2 continuation behavior","Relative Volume (1-day) > 2.0","Beta > 2.0 or Volatility > 4%","RSI between 55–70 (not overbought)","MACD trending upward or freshly crossed","High short float (20%+) confirmed externally (Finviz, Fintel, etc.)","Small float or prior squeeze chart behavior","Room above — no major resistance overhead"],newsValidation:["Confirmed event or sentiment driver (e.g. earnings beat, activist, insider buys)","Headline present within last 3 days","If no news: verify price is moving *only* due to float pressure (pure squeeze logic)"]},postEarnings:{name:"Post-Earnings Momentum",checklists:["Earnings occurred within last 3 trading days","Large green candle on earnings day with strong close","Price gapped up and held or built above 20 EMA","Day 2 or Day 3 shows continuation or controlled pullback","Relative Volume (1–3 day avg) > 1.5","RSI between 55–70","MACD bullish","No major macro interference (Fed, CPI, etc.) within 3 days","Target zone has room for extension (no hard resistance above)"],newsValidation:["Confirm earnings beat — look for revenue + EPS beat and guidance raise","Check press release or SA earnings summary","Ensure market reaction aligns with numbers (not a fake pump)"]}},wa=(t,e,r,n)=>{const i=r*(n/100),s=3.5,a=1.25*e,c=Math.min(t*(s/100),a),u=t-c,p=t+2*c,d=i/c;return{stopLoss:Number(u.toFixed(5)),takeProfit:Number(p.toFixed(5)),positionSize:Number(d.toFixed(5))}},Ca=()=>{var Te,Ee,ht,at,et,At;const{slug:t}=Ft();He(),Xe();const[e,r]=x.useState(null),[n,i]=x.useState({}),[s,a]=x.useState(""),{notification:c,notificationType:u,setNotification:p,setNotificationType:d}=rt(),[h,C]=x.useState(!1),[k,f]=x.useState(new Set),[m,S]=x.useState({key:"symbol",direction:"asc"}),[y,v]=x.useState(()=>{const g=localStorage.getItem("burnlist_screener_settings");return g?JSON.parse(g):{accountSize:1e4,riskPercent:2}}),{isInverted:L}=Ue(),[N,K]=x.useState(!1),[se,J]=x.useState(null),[z,R]=x.useState(""),[b,q]=x.useState({}),[D,M]=x.useState(""),[re,Z]=x.useState(""),[O,w]=x.useState(""),[H,U]=x.useState(""),[E,V]=x.useState("2"),[I,te]=x.useState(""),[oe,F]=x.useState(!1),[Y,P]=x.useState(null),[A,T]=x.useState(!1);x.useEffect(()=>{try{const g=localStorage.getItem("burnlist_universes");if(g){const B=JSON.parse(g);i(B);const G=Object.values(B).find(X=>X.slug===t);G&&r(G)}}catch(g){l.error("Failed to load universes:",g)}},[t]),x.useEffect(()=>{if(e){const g={...n},B=Object.keys(g).find(G=>g[G].id===e.id);B&&(g[B]=e,localStorage.setItem("burnlist_universes",JSON.stringify(g)))}},[e]),x.useEffect(()=>{localStorage.setItem("burnlist_screener_settings",JSON.stringify(y))},[y]);const $=async()=>{if(!s.trim()){p("Please enter ticker symbols"),d("error");return}C(!0),p("Adding tickers to universe..."),d("loading");try{const g=s.split(/[,	\s]+/).map(ae=>ae.trim().toUpperCase()).filter(Boolean).filter(Or);if(g.length===0){p("No valid ticker symbols found"),d("error");return}const B=new Set(((e==null?void 0:e.items)||[]).map(ae=>ae.symbol)),G=g.filter(ae=>!B.has(ae));if(G.length===0){p("All symbols already exist in universe"),d("info");return}const X=[];for(const ae of G){const xe=hr(ae),Ne={id:Pt(),symbol:xe,lastPrice:0,atr:0,flags:{news:!1},tradeType:"",tradeTypeName:"",quickTradeType:"",quickTradeTypeName:"",journalVerdict:"",journalVerdictType:"",journalVerdictFlag:"",entryPrice:"",notes:"",stopLoss:"",takeProfit:"",positionSize:""};X.push(Ne)}r(ae=>({...ae,items:[...(ae==null?void 0:ae.items)||[],...X]})),a(""),p(`Added ${X.length} tickers to universe. You can now manually enter prices.`),d("success")}catch(g){l.error("Error adding tickers:",g),p("Failed to add tickers"),d("error")}finally{C(!1)}},W=(g,B,G)=>{r(X=>({...X,items:((X==null?void 0:X.items)||[]).map(ae=>{if(ae.id===g){const xe={...ae};if(B==="flags"?xe.flags={...xe.flags,...G}:xe[B]=G,B==="entryPrice"||B==="atr"){const Ne=B==="entryPrice"?parseFloat(G):xe.entryPrice,ve=B==="atr"?parseFloat(G):xe.atr;if(Ne&&ve&&Ne>0&&ve>0){const{stopLoss:Ie,takeProfit:ft,positionSize:Be}=wa(Ne,ve,y.accountSize,y.riskPercent);xe.stopLoss=Ie.toFixed(2),xe.takeProfit=ft.toFixed(2),xe.positionSize=Be.toFixed(2)}}return xe}return ae})}))},Q=g=>{r(B=>({...B,items:((B==null?void 0:B.items)||[]).filter(G=>G.id!==g)})),f(B=>{const G=new Set(B);return G.delete(g),G}),setSelectedRows(B=>{const G=new Set(B);return G.delete(g),G})},_=g=>{f(B=>{const G=new Set(B);return G.has(g)?G.delete(g):G.add(g),G})},ie=()=>{var g;k.size===(((g=e==null?void 0:e.items)==null?void 0:g.length)||0)?f(new Set):f(new Set(((e==null?void 0:e.items)||[]).map(B=>B.id)))},he=async()=>{if(k.size===0){p("Please select at least one ticker"),d("error");return}C(!0),p("Creating watchlist with fresh market data..."),d("info");try{const g=((e==null?void 0:e.items)||[]).filter(Be=>k.has(Be.id)),B=JSON.parse(localStorage.getItem("burnlist_watchlists")||"{}"),G=Pt(),X=`Screener ${bt(new Date)}`,ae=X.toLowerCase().replace(/[^a-z0-9]/g,"-"),xe=[];let Ne=0,ve=0;for(const Be of g)try{const ot=await sa(Be.symbol,"real",parseFloat(Be.entryPrice)||null,null);ot?(xe.push(ot),Ne++):(ve++,l.warn(`Failed to fetch data for ${Be.symbol}`)),g.length>1&&await new Promise(fr=>setTimeout(fr,1e3))}catch(ot){ve++,l.error(`Error fetching data for ${Be.symbol}:`,ot)}if(xe.length===0){p("Failed to fetch market data for any selected tickers"),d("error"),C(!1);return}const Ie={id:G,name:X,slug:ae,items:xe,reason:`Created from screener with ${Ne} tickers (${ve} failed)`,createdAt:new Date().toISOString()},ft={...B,[G]:Ie};localStorage.setItem("burnlist_watchlists",JSON.stringify(ft)),p(`Created watchlist "${X}" with ${Ne} tickers${ve>0?` (${ve} failed)`:""}`),d("success"),f(new Set)}catch(g){l.error("Error creating watchlist:",g),p("Failed to create watchlist"),d("error")}finally{C(!1)}},me=g=>{S(B=>B.key===g?{key:g,direction:B.direction==="asc"?"desc":"asc"}:{key:g,direction:"asc"})},de=[...(e==null?void 0:e.items)||[]].map(g=>{var X;const B={epsGrowth:g.epsGrowth||0,avgVolume:g.avgVolume||0,relVolume:g.relVolume||1,technicalFlags:!!(g.tradeType&&g.journalVerdictType==="qualified"),earningsDaysAway:g.earningsDaysAway||10,price:g.lastPrice||0,pe:g.pe||15,marketCap:g.marketCap||5e8,debtEquity:g.debtEquity||.25,pb:g.pb||1.1,beta:g.beta||1.5,newsFlag:((X=g.flags)==null?void 0:X.news)||!1,sectorAlignment:g.sectorAlignment||!1,marketSupport:g.marketSupport||!1,volatilityClear:g.volatilityClear||!1,breadthHealthy:g.breadthHealthy||!1},G=ca(B);return{...g,_buyScore:G.totalBuyScore,_buyTag:G.tag}}).sort((g,B)=>{const G=(ve,Ie)=>Ie.includes(".")?Ie.split(".").reduce((Be,ot)=>Be==null?void 0:Be[ot],ve):ve[Ie],X=G(g,m.key),ae=G(B,m.key);if(m.key==="symbol"||m.key==="tradeType"||m.key==="quickTradeType"||m.key==="notes"||m.key==="journalVerdict"){const ve=String(X||""),Ie=String(ae||"");return m.direction==="asc"?ve.localeCompare(Ie):Ie.localeCompare(ve)}if(m.key==="flags.news"){const ve=!!X,Ie=!!ae;return ve===Ie?0:m.direction==="asc"?ve?1:-1:Ie?1:-1}const xe=parseFloat(X)||0,Ne=parseFloat(ae)||0;return m.direction==="asc"?xe-Ne:Ne-xe}),ce=g=>m.key!==g?"":m.direction==="asc"?"↑":"↓",ge=()=>{if(!D||!re||!O)return null;const g=parseFloat(D),B=parseFloat(re),G=parseFloat(O);if(g<=0||B<=0||G<=0)return null;const X=Math.abs(g-B),ae=Math.abs(G-g);return X===0?null:(ae/X).toFixed(2)},ye=()=>{if(!H||!E||!D||!re)return null;const g=parseFloat(H),B=parseFloat(E)/100,G=parseFloat(D),X=parseFloat(re);if(g<=0||B<=0||G<=0||X<=0)return null;const ae=g*B,xe=Math.abs(G-X);return xe===0?null:Math.floor(ae/xe)},pe=()=>{if(!z||Object.keys(b).length===0)return null;const g=Object.keys(b).length,B=Object.values(b).filter(Boolean).length,G=g-B;return G===0?{type:"qualified",text:"Qualified",flag:Nt}:G<=2?{type:"discretionary",text:"Discretionary",flag:lt}:{type:"blocked",text:"Blocked",flag:Jt}},fe=g=>{q(B=>({...B,[g]:!B[g]}))},we=g=>{J(g),K(!0),R(g.tradeType||""),M(g.entryPrice||""),Z(g.stopLoss||""),w(g.target||""),U(g.accountSize||""),V(g.riskPerTrade||"2"),te(g.overrideReason||"");const B={};g.tradeType&&$e[g.tradeType]&&[...$e[g.tradeType].checklists,...$e[g.tradeType].newsValidation].forEach(X=>{g.notes&&g.notes.includes(X)&&(B[X]=!0)}),q(B),qe(g.symbol)},qe=async g=>{if(g){T(!0);try{const B=await fetch(`/api/twelvedata-quote?symbols=${g}&interval=1min`);if(B.ok){const G=await B.json();G&&G.length>0?P(G[0].price):(l.warn(`No price data received for ${g}`),P(null))}else l.warn(`API error for ${g}: ${B.status}`),P(null)}catch(B){l.error("Error fetching current market price:",B),P(null)}finally{T(!1)}}},We=()=>{K(!1),J(null)},ke=()=>{if(!se||!z)return;const g=pe();g&&(r(B=>({...B,items:((B==null?void 0:B.items)||[]).map(G=>{if(G.id===se.id){const ae=$e[z].newsValidation.every(xe=>b[xe]);return{...G,tradeType:z,tradeTypeName:$e[z].name,journalVerdict:g.text,journalVerdictType:g.type,journalVerdictFlag:g.flag,entryPrice:D,stopLoss:re,target:O,takeProfit:O,accountSize:H,riskPerTrade:E,riskReward:ge(),positionSize:ye(),checklistItems:{...b},overrideReason:g.type!=="qualified"?I:"",journaledAt:new Date().toISOString(),flags:{...G.flags,news:ae}}}return G})})),K(!1),J(null),R(""),q({}),M(""),Z(""),w(""),U(""),V("2"),te(""))};x.useEffect(()=>{if(!N||!z||!$e[z])return;if(Object.keys(b).length===0){const B={};$e[z].checklists.forEach(G=>{B[G]=!1}),$e[z].newsValidation.forEach(G=>{B[G]=!1}),q(B)}},[z,N]);const Ae=async g=>{if(!g.tradeType||!g.entryPrice||!g.stopLoss||!g.target){p("Complete journal entry first"),d("error");return}try{p("Fetching latest price from Twelve Data API..."),d("loading");let B=null,G=!1;try{const Ut=await fetch(`/api/twelvedata-quote?symbols=${g.symbol}&interval=1min`);if(Ut.ok){const mr=await Ut.json();mr&&mr.length>0&&(B=mr[0].price,l.log(`📊 Latest price for ${g.symbol}: $${B}`),G=window.confirm(`Current market price for ${g.symbol}: $${B.toFixed(2)}

Your entered price: $${parseFloat(g.entryPrice).toFixed(2)}

Would you like to use the current market price instead?`))}}catch(Ut){l.warn("Twelve Data API not available, using manual entry price:",Ut),p("Using manual entry price (API unavailable)"),d("info")}const X=G?B:parseFloat(g.entryPrice),ae=X,xe=parseFloat(g.stopLoss),Ne=parseFloat(g.target),ve=Math.abs(ae-xe),Ie=Math.abs(Ne-ae),ft=ve>0?(Ie/ve).toFixed(2):"0",Be={id:Date.now(),ticker:g.symbol,setup:g.tradeTypeName||g.tradeType,riskReward:ft,verdict:g.journalVerdict||"Not journaled",outcome:"Open",entryPrice:X,stopLoss:parseFloat(g.stopLoss),target:parseFloat(g.target),positionSize:g.positionSize,accountSize:g.accountSize,riskPerTrade:g.riskPerTrade,executedAt:new Date().toISOString(),notes:g.notes||"",currentMarketPrice:B,priceSource:G?"Twelve Data API":B?"Manual Entry (API Available)":"Manual Entry (API Unavailable)"},ot=JSON.parse(localStorage.getItem("trade_journal_trades")||"[]"),fr=[Be,...ot];localStorage.setItem("trade_journal_trades",JSON.stringify(fr));const yo=G?` (updated to current market price: $${B.toFixed(2)})`:B?` (using manual entry: $${parseFloat(g.entryPrice).toFixed(2)})`:` (using manual entry: $${parseFloat(g.entryPrice).toFixed(2)})`;p(`Trade executed: ${g.symbol} logged to journal${yo}`),d("success")}catch(B){l.error("Error executing trade:",B),p(`Failed to execute trade: ${B.message}`),d("error")}},Ge=g=>{R(g),q({}),M(""),Z(""),w(""),U(""),V("2"),te("")},nt=(g,B)=>{l.debug(`Setting trade type for item ${g} to ${B}`),r(G=>{const X=((G==null?void 0:G.items)||[]).map(ae=>{var xe;return ae.id===g?{...ae,quickTradeType:B,quickTradeTypeName:B?((xe=$e[B])==null?void 0:xe.name)||B:""}:ae});return l.debug("Updated items:",X.map(ae=>({id:ae.id,quickTradeType:ae.quickTradeType}))),{...G,items:X}})},gt=g=>{var B;if(k.size===0){p("Please select at least one stock first"),d("error");return}r(G=>({...G,items:((G==null?void 0:G.items)||[]).map(X=>{var ae;return k.has(X.id)?{...X,quickTradeType:g,quickTradeTypeName:g?((ae=$e[g])==null?void 0:ae.name)||g:""}:X})})),p(`Set ${k.size} stocks to ${((B=$e[g])==null?void 0:B.name)||g}`),d("success")},Ze=async g=>{if(g)try{const B=`https://elite.finviz.com/charts?t=${g.toUpperCase()}&p=d&l=1h1v`;window.open(B,"_blank")}catch(B){l.warn(`⚠️ Error opening chart for ${g}:`,B)}};return o.jsxs("div",{style:{backgroundColor:L?"rgb(140,185,162)":"transparent",minHeight:"100vh",color:L?"#000000":"#ffffff",padding:"0"},children:[o.jsx(tt,{}),o.jsxs("div",{style:{padding:"20px"},children:[c&&o.jsx("div",{style:{position:"fixed",top:24,left:0,right:0,zIndex:10001,display:"flex",justifyContent:"center",pointerEvents:"none"},children:o.jsx("div",{style:{minWidth:320,maxWidth:480,pointerEvents:"auto"},children:o.jsx(Oe,{message:c,type:u,onClose:()=>p("")})})}),o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:16},children:[o.jsx(Mt,{to:"/universes",style:{display:"inline-flex",alignItems:"center",border:"none",background:"none",padding:0,margin:0,textDecoration:"none"},"aria-label":"back to universes",children:o.jsx("img",{src:ho,alt:"back",style:{width:24,height:24,filter:L?"invert(1)":"none"}})}),o.jsx("h1",{style:{color:ee,fontFamily:"'Courier New', monospace",margin:0,marginLeft:0,textAlign:"right",flex:1},children:(e==null?void 0:e.name)||"UNIVERSE SCREENER"})]}),o.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"20px"},children:[o.jsx(Ce,{onClick:ie,children:k.size===(((Te=e==null?void 0:e.items)==null?void 0:Te.length)||0)?"DESELECT ALL":"SELECT ALL"}),o.jsx(Ce,{onClick:he,disabled:k.size===0||h,children:h?"CREATING WATCHLIST...":`CREATE WATCHLIST FROM SELECTED (${k.size})`}),oe&&o.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[o.jsx("span",{style:{color:ee,fontSize:"12px",fontFamily:"'Courier New', monospace"},children:"MASS SET:"}),Object.keys($e).map(g=>o.jsx("button",{onClick:()=>gt(g),disabled:selectedRows.size===0,style:{background:"transparent",color:ee,border:`1px solid ${ee}`,padding:"4px 8px",fontFamily:"Courier New",fontSize:10,cursor:selectedRows.size===0?"not-allowed":"pointer",borderRadius:0,opacity:selectedRows.size===0?.5:1,transition:"all 0.2s"},title:`Set ${selectedRows.size} selected stocks to ${$e[g].name}`,children:g.charAt(0).toUpperCase()+g.slice(1).replace(/([A-Z])/g," $1")},g))]})]}),(((Ee=e==null?void 0:e.items)==null?void 0:Ee.length)||0)>0&&o.jsxs("div",{style:{overflowX:"auto"},children:[(((ht=e==null?void 0:e.items)==null?void 0:ht.length)||0)>0&&o.jsx("div",{style:{display:"flex",alignItems:"center",gap:16,marginBottom:16},children:o.jsx("button",{onClick:()=>F(g=>!g),style:{background:"none",border:"none",color:ee,fontFamily:"'Courier New', monospace",fontSize:"12px",padding:"2px 8px",borderRadius:0,fontWeight:400,textTransform:"lowercase",letterSpacing:0,cursor:"pointer",transition:"all 0.2s",minWidth:0,boxShadow:"none"},children:oe?"done":"edit"})}),o.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"14.5px"},children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{style:{padding:"6px",textAlign:"center",borderBottom:`2px solid ${ee}`,background:"black"},children:o.jsx("img",{src:k.size===(((at=e==null?void 0:e.items)==null?void 0:at.length)||0)&&(((et=e==null?void 0:e.items)==null?void 0:et.length)||0)>0?Yt:Qt,alt:"Select All",onClick:g=>{g.stopPropagation(),ie()},style:{width:16,height:16,cursor:"pointer",filter:"drop-shadow(0 0 2px rgba(140,185,162,0.3))"}})}),o.jsxs("th",{onClick:()=>me("symbol"),style:{cursor:"pointer",padding:"12px 8px",textAlign:"left",borderBottom:`2px solid ${ee}`,color:ee,fontWeight:"bold",fontSize:"14.5px",userSelect:"none",transition:"background-color 0.2s"},children:["Symbol ",ce("symbol")]}),o.jsxs("th",{onClick:()=>me("tradeType"),style:{cursor:"pointer",padding:"12px 8px",textAlign:"center",borderBottom:`2px solid ${ee}`,color:ee,fontWeight:"bold",fontSize:"14.5px",userSelect:"none",transition:"background-color 0.2s"},children:["Trade Type ",ce("tradeType")]}),o.jsxs("th",{onClick:()=>me("lastPrice"),style:{cursor:"pointer",padding:"12px 8px",textAlign:"right",borderBottom:`2px solid ${ee}`,color:ee,fontWeight:"bold",fontSize:"14.5px",userSelect:"none",transition:"background-color 0.2s"},children:["Last Price ",ce("lastPrice")]}),o.jsxs("th",{onClick:()=>me("tradeType"),style:{cursor:"pointer",padding:"12px 8px",textAlign:"center",borderBottom:`2px solid ${ee}`,color:ee,fontWeight:"bold",fontSize:"14.5px",userSelect:"none",transition:"background-color 0.2s"},children:["SETUP ",ce("tradeType")]}),o.jsxs("th",{onClick:()=>me("flags.news"),style:{padding:"12px 8px",textAlign:"center",borderBottom:`2px solid ${ee}`,color:ee,fontWeight:"bold",fontSize:"14.5px",userSelect:"none",transition:"background-color 0.2s",cursor:"pointer"},children:["NEWS ",ce("flags.news")]}),o.jsxs("th",{onClick:()=>me("journalVerdict"),style:{padding:"12px 8px",textAlign:"center",borderBottom:`2px solid ${ee}`,color:ee,fontWeight:"bold",fontSize:"14.5px",userSelect:"none",transition:"background-color 0.2s",cursor:"pointer"},children:["VERDICT ",ce("journalVerdict")]}),o.jsxs("th",{onClick:()=>me("entryPrice"),style:{padding:"12px 8px",textAlign:"right",borderBottom:`2px solid ${ee}`,color:ee,fontWeight:"bold",fontSize:"14.5px",userSelect:"none",transition:"background-color 0.2s",cursor:"pointer"},children:["Entry Price ",ce("entryPrice")]}),o.jsxs("th",{onClick:()=>me("stopLoss"),style:{padding:"12px 8px",textAlign:"right",borderBottom:`2px solid ${ee}`,color:ee,fontWeight:"bold",fontSize:"14.5px",userSelect:"none",transition:"background-color 0.2s",cursor:"pointer"},children:["SL ",ce("stopLoss")]}),o.jsxs("th",{onClick:()=>me("takeProfit"),style:{padding:"12px 8px",textAlign:"right",borderBottom:`2px solid ${ee}`,color:ee,fontWeight:"bold",fontSize:"14.5px",userSelect:"none",transition:"background-color 0.2s",cursor:"pointer"},children:["TP ",ce("takeProfit")]}),o.jsxs("th",{onClick:()=>me("positionSize"),style:{padding:"12px 8px",textAlign:"right",borderBottom:`2px solid ${ee}`,color:ee,fontWeight:"bold",fontSize:"14.5px",userSelect:"none",transition:"background-color 0.2s",cursor:"pointer"},children:["Position ",ce("positionSize")]}),o.jsxs("th",{onClick:()=>me("notes"),style:{padding:"12px 8px",textAlign:"left",borderBottom:`2px solid ${ee}`,color:ee,fontWeight:"bold",fontSize:"14.5px",userSelect:"none",transition:"background-color 0.2s",cursor:"pointer"},children:["Notes ",ce("notes")]}),o.jsx("th",{style:{padding:"12px 8px",textAlign:"center",borderBottom:`2px solid ${ee}`,color:ee,fontWeight:"bold",fontSize:"14.5px"},children:"Execute"})]})}),o.jsx("tbody",{children:de.map((g,B)=>{var G;return o.jsxs("tr",{style:{borderBottom:`1px solid ${Sa}`,":hover":{backgroundColor:"rgba(140,185,162,0.05)"}},onClick:X=>{X.target.closest("button")||X.target.tagName==="BUTTON"||X.target.closest("input")||X.target.tagName==="IMG"||X.target.closest("select")||we(g)},children:[o.jsx("td",{style:{padding:"6px",textAlign:"center"},children:o.jsx("img",{src:k.has(g.id)?Yt:Qt,alt:"Select Item",onClick:X=>{X.stopPropagation(),_(g.id)},style:{width:16,height:16,cursor:"pointer",filter:"drop-shadow(0 0 2px rgba(140,185,162,0.3))"}})}),o.jsx("td",{style:{padding:"6px",textAlign:"left"},children:o.jsxs("span",{onClick:X=>{X.stopPropagation(),Ze(g.symbol)},style:{color:ee,cursor:"pointer",fontFamily:"'Courier New', monospace",fontSize:14,display:"flex",alignItems:"center",gap:"4px",fontWeight:"bold"},title:`Click to open ${g.symbol} chart in new tab`,children:[g.symbol,o.jsx("img",{src:Nt,alt:"Open Chart",style:{width:12,height:12,verticalAlign:"middle"}})]})}),o.jsx("td",{style:{padding:"6px",textAlign:"center"},children:oe?o.jsxs("select",{value:g.quickTradeType||g.tradeType||"",onChange:X=>{X.stopPropagation();const ae=X.target.value;nt(g.id,ae)},"data-item-id":g.id,"data-field":"tradeType",style:{background:"black",color:ee,border:`1px solid ${ee}`,padding:"2px 4px",fontFamily:"Courier New",fontSize:12,width:"100%"},children:[o.jsx("option",{value:"",children:"Select"}),o.jsx("option",{value:"breakout",children:"Breakout"}),o.jsx("option",{value:"pullback",children:"Pullback"}),o.jsx("option",{value:"shortSqueeze",children:"Short Squeeze"}),o.jsx("option",{value:"postEarnings",children:"Post-Earnings"})]}):o.jsxs("select",{value:g.quickTradeType||g.tradeType||"",onChange:X=>{X.stopPropagation();const ae=X.target.value;nt(g.id,ae)},style:{background:"transparent",color:ee,border:"none",borderBottom:`1px solid ${ee}`,padding:"1px 2px",fontFamily:"Courier New",fontSize:12,cursor:"pointer",borderRadius:0,width:"100%",textAlign:"center",height:"18px",outline:"none"},onClick:X=>X.stopPropagation(),children:[o.jsx("option",{value:"",children:"-"}),o.jsx("option",{value:"breakout",children:"Breakout"}),o.jsx("option",{value:"pullback",children:"Pullback"}),o.jsx("option",{value:"shortSqueeze",children:"Short Squeeze"}),o.jsx("option",{value:"postEarnings",children:"Post-Earnings"})]})}),o.jsx("td",{style:{padding:"6px",textAlign:"right",cursor:oe?"text":"default"},onClick:oe?()=>{const X=document.querySelector(`input[data-item-id="${g.id}"][data-field="lastPrice"]`);X&&X.focus()}:void 0,children:oe?o.jsx("input",{type:"number",step:"0.01",value:g.lastPrice||"",onChange:X=>W(g.id,"lastPrice",parseFloat(X.target.value)||0),placeholder:"0.00","data-item-id":g.id,"data-field":"lastPrice",style:{backgroundColor:"black",color:ee,border:`1px solid ${ee}`,padding:"4px 6px",fontFamily:"'Courier New', monospace",fontSize:14,width:"60px",textAlign:"right",borderRadius:0}}):o.jsxs("span",{children:["$",g.lastPrice?g.lastPrice.toFixed(2):"0.00"]})}),o.jsx("td",{style:{width:"7.14%",padding:"2px 4px",textAlign:"center"},children:o.jsx("img",{src:g.tradeType?Nt:Jt,alt:"SETUP",title:g.tradeTypeName||"No setup selected",style:{width:13,height:13,verticalAlign:"middle",filter:"drop-shadow(0 0 1px #222)"}})}),o.jsx("td",{style:{width:"7.14%",padding:"2px 4px",textAlign:"center"},children:o.jsx("img",{src:(G=g.flags)!=null&&G.news||g.newsFlag?Nt:Jt,alt:"NEWS",title:"NEWS",style:{width:13,height:13,verticalAlign:"middle",filter:"drop-shadow(0 0 1px #222)"}})}),o.jsx("td",{style:{width:"7.14%",padding:"2px 4px",textAlign:"center"},children:o.jsx("img",{src:g.journalVerdictFlag||Jt,alt:"VERDICT",title:g.journalVerdict||"Not journaled",style:{width:13,height:13,verticalAlign:"middle",filter:"drop-shadow(0 0 1px #222)"}})}),o.jsx("td",{style:{padding:"6px",textAlign:"right"},children:g.entryPrice!==void 0&&g.entryPrice!==null?g.entryPrice:"-"}),o.jsx("td",{style:{padding:"6px",textAlign:"right"},children:g.stopLoss?`$${g.stopLoss}`:"-"}),o.jsx("td",{style:{padding:"6px",textAlign:"right"},children:g.target?`$${g.target}`:g.takeProfit?`$${g.takeProfit}`:"-"}),o.jsx("td",{style:{padding:"6px",textAlign:"right"},children:g.positionSize?g.positionSize:"-"}),o.jsx("td",{style:{padding:"6px",textAlign:"left",cursor:oe?"text":"default"},onClick:oe?()=>{const X=document.querySelector(`input[data-item-id="${g.id}"][data-field="notes"]`);X&&X.focus()}:void 0,children:oe?o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[o.jsx("input",{type:"text",value:g.notes,onChange:X=>W(g.id,"notes",X.target.value),placeholder:"Notes...","data-item-id":g.id,"data-field":"notes",style:{backgroundColor:"black",color:ee,borderRadius:0,border:`1px solid ${ee}`,fontSize:14,boxShadow:g.notes.trim()?`0 0 4px 0 ${ee}22`:"none",fontFamily:"'Courier New', monospace",width:"80px",padding:"4px 6px"}}),o.jsx("button",{onClick:()=>Q(g.id),style:{background:"none",border:"none",color:ee,padding:0,margin:0,cursor:"pointer",fontSize:14,display:"inline-flex",alignItems:"center",transition:"all 0.2s"},title:"Delete Ticker",children:o.jsx(xa,{})})]}):o.jsx("span",{style:{color:ee,fontFamily:"'Courier New', monospace",fontSize:14},children:g.notes||"-"})}),o.jsx("td",{style:{padding:"6px",textAlign:"center"},children:o.jsx("img",{src:ba,alt:"Execute Trade",onClick:()=>Ae(g),style:{width:24,height:24,cursor:!g.tradeType||!g.entryPrice||!g.stopLoss||!g.target?"not-allowed":"pointer",opacity:!g.tradeType||!g.entryPrice||!g.stopLoss||!g.target?.3:1,filter:"drop-shadow(0 0 2px rgba(140,185,162,0.3))",transition:"all 0.2s"},title:!g.tradeType||!g.entryPrice||!g.stopLoss||!g.target?"Complete journal entry first":"Execute trade"})})]},g.id)})})]})]}),!e&&o.jsx("div",{style:{textAlign:"center",color:"#999",fontFamily:"'Courier New', monospace",marginTop:"50px"},children:"⚠️ Universe not found."}),e&&(((At=e==null?void 0:e.items)==null?void 0:At.length)||0)===0&&o.jsx("div",{style:{textAlign:"center",color:"#999",fontFamily:"'Courier New', monospace",marginTop:"50px"},children:"⚠️ No tickers in universe yet. Add some tickers above to get started."}),N&&se&&o.jsxs(o.Fragment,{children:[o.jsx("div",{onClick:We,style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0,0,0,0.3)",zIndex:10009,pointerEvents:"auto"}}),o.jsxs("div",{style:{position:"fixed",top:0,right:0,width:800,height:"100vh",background:"#0a0a0a",color:ee,zIndex:10010,boxShadow:`-4px 0 24px 0 ${ee}33`,borderLeft:`2px solid ${ee}`,display:"flex",flexDirection:"column",transition:"transform 0.3s",fontFamily:"Courier New",padding:0,pointerEvents:"auto"},onClick:g=>g.stopPropagation(),onMouseDown:g=>g.stopPropagation(),children:[o.jsxs("div",{style:{padding:28,flex:1,overflowY:"auto"},children:[o.jsxs("h2",{style:{color:ee,marginBottom:18,fontWeight:700,fontSize:24},children:["Journal: ",se.symbol]}),o.jsxs("div",{style:{marginBottom:"30px"},children:[o.jsx("h3",{style:{marginBottom:"15px",fontSize:"18px"},children:"1. SELECT SETUP TYPE"}),o.jsx("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:Object.entries($e).map(([g,B])=>o.jsx("button",{onClick:()=>Ge(g),style:{background:z===g?ee:"transparent",color:z===g?"#000":ee,border:`2px solid ${ee}`,fontWeight:z===g?"bold":"normal",padding:"8px 16px",fontFamily:"Courier New",cursor:"pointer"},children:B.name},g))})]}),z&&o.jsxs("div",{style:{marginBottom:"30px"},children:[o.jsxs("h3",{style:{marginBottom:"15px",fontSize:"18px"},children:["2. VERIFY SETUP CRITERIA (",$e[z].name,")"]}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"10px",border:`2px solid ${ee}`,padding:"16px",borderRadius:"4px",background:"rgba(140,185,162,0.04)",marginBottom:"20px"},children:$e[z].checklists.map((g,B)=>o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",padding:"8px",cursor:"pointer"},children:[o.jsx("span",{onClick:()=>fe(g),style:{display:"inline-flex",alignItems:"center",cursor:"pointer"},tabIndex:0,onKeyDown:G=>{(G.key===" "||G.key==="Enter")&&fe(g)},role:"checkbox","aria-checked":b[g]||!1,children:o.jsx("img",{src:b[g]?Yt:Qt,alt:b[g]?"Checked":"Unchecked",style:{width:22,height:22}})}),o.jsx("span",{style:{fontSize:"14px"},children:g})]},`checklist-${g}`))}),o.jsxs("div",{style:{marginTop:24},children:[o.jsx("h4",{style:{marginBottom:"10px",fontSize:"16px",color:ee},children:"News Validation"}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"10px",border:`2px solid ${ee}`,padding:"16px",borderRadius:"4px",background:"rgba(140,185,162,0.04)"},children:$e[z].newsValidation.map((g,B)=>o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",padding:"8px",cursor:"pointer"},children:[o.jsx("span",{onClick:()=>fe(g),style:{display:"inline-flex",alignItems:"center",cursor:"pointer"},tabIndex:0,onKeyDown:G=>{(G.key===" "||G.key==="Enter")&&fe(g)},role:"checkbox","aria-checked":b[g]||!1,children:o.jsx("img",{src:b[g]?Yt:Qt,alt:b[g]?"Checked":"Unchecked",style:{width:22,height:22}})}),o.jsx("span",{style:{fontSize:"14px"},children:g})]},`news-${g}`))})]})]}),z&&o.jsxs("div",{style:{marginBottom:"30px"},children:[o.jsx("h3",{style:{marginBottom:"15px",fontSize:"18px"},children:"3. ENTRY DETAILS"}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"15px"},children:[o.jsxs("div",{children:[o.jsx("label",{style:{display:"block",marginBottom:"5px"},children:"Entry Price:"}),o.jsx("input",{type:"number",step:"0.01",value:D,onChange:g=>M(g.target.value),style:{width:"100%",padding:"8px",background:"transparent",border:`1px solid ${ee}`,color:ee,fontFamily:"Courier New"}}),A?o.jsx("div",{style:{fontSize:"12px",color:ee,marginTop:"4px",fontStyle:"italic"},children:"🔄 Fetching current market price..."}):Y?o.jsxs("div",{style:{fontSize:"12px",color:ee,marginTop:"4px",padding:"4px 8px",border:`1px solid ${ee}`,borderRadius:"2px",background:"rgba(140,185,162,0.1)"},children:["📊 Current Market: $",Y.toFixed(2),o.jsx("button",{onClick:()=>{M(Y.toFixed(2)),p(`Entry price updated to current market price: $${Y.toFixed(2)}`),d("success")},style:{marginLeft:"8px",background:"transparent",border:`1px solid ${ee}`,color:ee,padding:"2px 6px",fontSize:"10px",cursor:"pointer",fontFamily:"Courier New"},children:"USE"})]}):o.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px",fontStyle:"italic"},children:"Unable to fetch current market price"})]}),o.jsxs("div",{children:[o.jsx("label",{style:{display:"block",marginBottom:"5px"},children:"Stop Loss:"}),o.jsx("input",{type:"number",step:"0.01",value:re,onChange:g=>Z(g.target.value),style:{width:"100%",padding:"8px",background:"transparent",border:`1px solid ${ee}`,color:ee,fontFamily:"Courier New"}})]}),o.jsxs("div",{children:[o.jsx("label",{style:{display:"block",marginBottom:"5px"},children:"Target:"}),o.jsx("input",{type:"number",step:"0.01",value:O,onChange:g=>w(g.target.value),style:{width:"100%",padding:"8px",background:"transparent",border:`1px solid ${ee}`,color:ee,fontFamily:"Courier New"}})]})]})]}),z&&o.jsxs("div",{style:{marginBottom:"30px"},children:[o.jsx("h3",{style:{marginBottom:"15px",fontSize:"18px"},children:"4. RISK MANAGEMENT"}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"15px"},children:[o.jsxs("div",{children:[o.jsx("label",{style:{display:"block",marginBottom:"5px"},children:"Account Size ($):"}),o.jsx("input",{type:"number",value:H,onChange:g=>U(g.target.value),style:{width:"100%",padding:"8px",background:"transparent",border:`1px solid ${ee}`,color:ee,fontFamily:"Courier New"}})]}),o.jsxs("div",{children:[o.jsx("label",{style:{display:"block",marginBottom:"5px"},children:"Risk Per Trade (%):"}),o.jsx("input",{type:"number",step:"0.1",value:E,onChange:g=>V(g.target.value),style:{width:"100%",padding:"8px",background:"transparent",border:`1px solid ${ee}`,color:ee,fontFamily:"Courier New"}})]})]}),o.jsx("div",{style:{marginTop:"15px",padding:"15px",border:`1px solid ${ee}`,background:"rgba(140,185,162,0.1)"},children:o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:"10px"},children:[o.jsxs("div",{children:[o.jsx("strong",{children:"Risk:Reward:"})," ",ge()?`${ge()}:1`:"N/A"]}),o.jsxs("div",{children:[o.jsx("strong",{children:"Position Size:"})," ",ye()?`${ye()} shares`:"N/A"]}),o.jsxs("div",{children:[o.jsx("strong",{children:"Risk Amount:"})," ",H&&E?`$${(parseFloat(H)*parseFloat(E)/100).toFixed(2)}`:"N/A"]})]})})]}),pe()&&o.jsxs("div",{style:{marginBottom:"30px"},children:[o.jsx("h3",{style:{marginBottom:"15px",fontSize:"18px"},children:"5. SETUP VERDICT"}),o.jsxs("div",{style:{padding:"15px",border:`2px solid ${ee}`,textAlign:"center",fontSize:"18px",fontWeight:"bold",background:pe().type==="qualified"?"rgba(0,255,0,0.1)":pe().type==="discretionary"?"rgba(255,165,0,0.1)":"rgba(255,0,0,0.1)",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px"},children:[o.jsx("img",{src:pe().flag,alt:pe().text,style:{width:"24px",height:"24px"}}),pe().text]}),pe().type!=="qualified"&&o.jsxs("div",{style:{marginTop:"15px"},children:[o.jsx("label",{style:{display:"block",marginBottom:"5px"},children:"Override Reason (Required for Discretionary/Blocked):"}),o.jsx("textarea",{value:I,onChange:g=>te(g.target.value),style:{width:"100%",padding:"8px",background:"transparent",border:`1px solid ${ee}`,color:ee,fontFamily:"Courier New",minHeight:"60px"},placeholder:"Explain why you're proceeding despite failed criteria..."})]})]})]}),o.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:16,padding:20,borderTop:`1.5px solid ${ee}`,background:"#111"},children:[o.jsx("button",{onClick:We,style:{fontFamily:"Courier New",fontWeight:700,fontSize:17,borderRadius:4,padding:"8px 28px",cursor:"pointer",transition:"all 0.2s",background:"black",color:ee,border:`2px solid ${ee}`},children:"Cancel"}),o.jsx("button",{onClick:ke,style:{fontFamily:"Courier New",fontWeight:700,fontSize:17,borderRadius:4,padding:"8px 28px",cursor:"pointer",transition:"all 0.2s",background:ee,color:"black",border:`2px solid ${ee}`},children:"Save Journal"})]})]})]}),o.jsx("div",{style:{marginTop:32,display:"flex",justifyContent:"center"},children:o.jsxs("div",{style:{display:"flex",alignItems:"center",width:420,gap:10,height:"32px"},children:[o.jsx("input",{type:"text",value:s,onChange:g=>a(g.target.value),placeholder:"e.g. AAPL, MSFT, GOOGL, TSLA",style:{flex:1,fontFamily:"'Courier New', Courier, monospace",fontSize:"14px",backgroundColor:"black",border:`1px solid ${ee}`,color:ee,padding:"6px 12px",boxSizing:"border-box",minWidth:0,borderRadius:0,height:"32px",maxHeight:"32px",minHeight:"32px",margin:0,outline:"none",lineHeight:"20px"},onKeyDown:g=>{g.key==="Enter"&&(g.preventDefault(),$())}}),o.jsx(Ce,{onClick:$,disabled:h||!s.trim(),mobile:!1,title:"Add ticker(s)",style:{backgroundColor:h?"#666666":ee,color:"black",opacity:h?.6:1,minWidth:0,height:"32px",minHeight:"32px",fontSize:"0.9rem",display:"flex",alignItems:"center",justifyContent:"center",padding:"6px 12px",borderRadius:0},children:h?"...":"+++"})]})})]})]})},va="rgb(140,185,162)",Aa=()=>{He(),Xe();const[t,e]=x.useState({}),{notification:r,notificationType:n,setNotification:i,setNotificationType:s}=rt(),[a,c]=x.useState(!1),[u,p]=x.useState(!1),[d,h]=x.useState(!1),[C,k]=x.useState(null),{isInverted:f,toggleTheme:m}=Ue(),S=ne(va),y=ne("black"),v=ne("#e31507"),L=ne("#888");x.useEffect(()=>{try{const D=localStorage.getItem("burnlist_universes");if(D){const M=JSON.parse(D);e(M)}}catch(D){console.error("Failed to load universes:",D)}},[]),x.useEffect(()=>{localStorage.setItem("burnlist_universes",JSON.stringify(t))},[t]);const N=()=>{p(!0),setTimeout(()=>p(!1),150);const M=`Universe ${bt(new Date)}`,re=Pt(),Z=M.toLowerCase().replace(/[^a-z0-9]/g,"-");if(Object.values(t).some(U=>U.name&&U.name.toLowerCase()===M.toLowerCase())){i("⚠️ Universe name already exists"),s("error");return}const w={id:re,name:M,slug:Z,items:[],reason:"",createdAt:new Date().toISOString()},H={...t,[re]:w};e(H),localStorage.setItem("burnlist_universes",JSON.stringify(H)),i("")},K=D=>{const M=Object.keys(t).find(O=>t[O].id===D);if(!M){l.log("🗑️ Could not find universe with id:",D);return}const{[M]:re,...Z}=t;e(Z),localStorage.setItem("burnlist_universes",JSON.stringify(Z)),re?l.log("🗑️ Deleted universe:",re.name):l.log("🗑️ Deleted universe with id:",D)};x.useCallback((D,M)=>{if(Object.values(t).some(Z=>Z.id!==D&&Z.name&&Z.name.toLowerCase()===M.toLowerCase())){i("⚠️ Name already exists"),s("error");return}e(Z=>{const O={...Z};return O[D]&&(O[D]={...O[D],name:M,slug:M.toLowerCase().replace(/[^a-z0-9]/g,"-")}),localStorage.setItem("burnlist_universes",JSON.stringify(O)),O})},[e,t]);const se=x.useCallback((D,M)=>{const re={...t,[D]:{...t[D],reason:M}};e(re),localStorage.setItem("burnlist_universes",JSON.stringify(re))},[e,t]),[J,z]=x.useState({});x.useEffect(()=>{if(a){const D={};Object.values(t).forEach(M=>{D[M.id]={value:M.name,prev:M.name}}),z(D)}else z({})},[a,t]);const R=(D,M)=>{z(re=>({...re,[D]:{...re[D],value:M}}))},b=D=>{var Z;const M=((Z=J[D])==null?void 0:Z.value)||"";if(Object.values(t).some(O=>O.id!==D&&O.name&&O.name.toLowerCase()===M.toLowerCase())){i("⚠️ Name already exists"),s("error"),z(O=>({...O,[D]:{...O[D],value:O[D].prev}}));return}e(O=>{const w={...O};return w[D]&&(w[D]={...w[D],name:M,slug:M.toLowerCase().replace(/[^a-z0-9]/g,"-")}),localStorage.setItem("burnlist_universes",JSON.stringify(w)),w}),z(O=>({...O,[D]:{...O[D],prev:M}}))},q=x.useMemo(()=>Object.values(t),[t]);return o.jsxs("div",{style:{fontFamily:"Courier New",color:S,backgroundColor:y,minHeight:"100vh",padding:"0"},children:[o.jsxs("div",{style:{padding:"32px"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:24,flexWrap:"wrap",gap:"12px"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:12},children:[o.jsx("button",{onClick:m,style:{border:"none",background:"none",padding:0,cursor:"pointer",display:"flex",alignItems:"center",minHeight:"44px"},"aria-label":"Toggle theme",children:o.jsx("img",{src:f?vt:Ct,alt:"Burnlist Logo",style:{width:44,height:44,marginRight:10,transition:"filter 0.3s"}})}),o.jsx("strong",{style:{fontSize:"170%",lineHeight:"44px",display:"inline-block",color:S,height:"44px"},children:"BURNLIST v1.1"})]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[o.jsx("span",{style:{color:v,fontWeight:"bold",fontSize:12},children:"0"}),o.jsx("span",{style:{color:S,fontWeight:"bold",fontSize:12},children:"0"}),o.jsx("span",{style:{color:S},children:"ACCOUNT: local"})]})]}),o.jsx(tt,{}),r&&o.jsx("div",{style:{position:"fixed",top:24,left:0,right:0,zIndex:10001,display:"flex",justifyContent:"center",pointerEvents:"none"},children:o.jsx("div",{style:{minWidth:320,maxWidth:480,pointerEvents:"auto"},children:o.jsx(Oe,{message:r,type:n,onClose:()=>i("")})})}),d&&o.jsx(Oe,{message:"Loading universes...",type:"loading"}),C&&o.jsx(Oe,{message:C,type:"error",onClose:()=>k(null)}),Object.keys(t).length===0&&o.jsx("p",{style:{textAlign:"center",color:L,marginTop:"50px"},children:"No universes found. Create your first universe to get started."}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(252px, 252px))",rowGap:"20px",columnGap:"20px",margin:"70px 0 1px 0",justifyContent:"center",alignItems:"start"},children:q.map((D,M)=>{var O;const re=D.items||[],Z=o.jsxs("div",{style:{width:252,height:a?250:120,fontFamily:"Courier New",background:"transparent",padding:"10px 8px",margin:0,border:`1px solid ${S}`,borderRadius:0,boxShadow:"none",display:"flex",flexDirection:"column",alignItems:"stretch",justifyContent:"flex-start",position:"relative",boxSizing:"border-box",overflow:"hidden"},children:[a?o.jsx("input",{value:((O=J[D.id])==null?void 0:O.value)??D.name,onChange:w=>R(D.id,w.target.value),onBlur:()=>b(D.id),onKeyDown:w=>{w.key==="Enter"&&(w.preventDefault(),b(D.id))},style:{fontFamily:"Courier New",fontSize:16,color:S,background:"transparent",border:`1px solid ${S}`,marginBottom:2,padding:"2px 4px",width:"100%",fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",minHeight:"24px"}}):o.jsx("div",{style:{fontSize:18,color:S,fontWeight:"bold",marginBottom:4,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:D.name||`UNIVERSE ${M+1}`}),a&&o.jsx(Ce,{onClick:()=>K(D.id),style:{backgroundColor:"transparent",color:v,border:`1px solid ${v}`,padding:"1px 4px",marginBottom:2,fontSize:9,width:"100%",fontWeight:"bold",fontFamily:"Courier New",cursor:"pointer",minHeight:"16px"},children:"DELETE"}),a?o.jsx("input",{value:D.reason||"",onChange:w=>se(D.id,w.target.value),style:{fontFamily:"Courier New",fontSize:12,color:S,background:"transparent",border:`1px solid ${S}`,marginBottom:2,padding:"2px 4px",width:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",minHeight:"16px"},placeholder:"Reason..."}):o.jsx("div",{style:{fontSize:14,color:S,marginBottom:4,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:D.reason||"N/A"}),o.jsxs("div",{style:{fontSize:13,color:S,marginBottom:2},children:[re.length," tickers"]}),o.jsx("div",{style:{fontSize:11,color:L,marginBottom:2},children:bt(D.createdAt)}),o.jsx("div",{style:{fontSize:19,color:S,fontWeight:"bold",marginBottom:2},children:re.length>0?"ACTIVE":"EMPTY"})]});return o.jsx("div",{style:{margin:0},children:a?Z:o.jsx(Mt,{to:`/universe/${D.slug}`,style:{textDecoration:"none",color:"inherit"},children:Z})},D.id)})})]}),o.jsxs("div",{className:"action-buttons-container",children:[o.jsx("style",{children:`
          .action-buttons-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
          }
          
          @media (max-width: 768px) {
            .action-buttons-container {
              position: fixed;
              top: 50%;
              right: 10px;
              transform: translateY(-50%);
              flex-direction: column;
              gap: 8px;
            }
          }
          
          @media (max-width: 480px) {
            .action-buttons-container {
              position: fixed;
              top: 50%;
              right: 8px;
              transform: translateY(-50%);
              flex-direction: column;
              gap: 6px;
            }
          }
          
          .action-button {
            background: ${y};
            color: ${S};
            border: 1px solid ${S};
            font-size: 12px;
            padding: 6px 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            min-height: 32px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
          }
          
          @media (max-width: 768px) {
            .action-button {
              font-size: 10px;
              padding: 6px 8px;
              min-height: 32px;
              width: 60px;
            }
          }
          
          @media (max-width: 480px) {
            .action-button {
              font-size: 9px;
              padding: 4px 6px;
              min-height: 28px;
              width: 50px;
            }
          }
        `}),o.jsx("button",{onClick:N,className:"action-button",style:{backgroundColor:S,color:y,fontWeight:"bold",fontSize:"14px",transition:"all 0.2s ease-in-out",padding:"8px 16px"},children:"+++"}),o.jsx("button",{onClick:()=>c(!a),className:"action-button",style:{textTransform:"lowercase",fontWeight:400,letterSpacing:1},children:a?"done":"edit"}),o.jsx("button",{onClick:()=>{i("Import functionality coming soon"),s("info")},className:"action-button",style:{textTransform:"lowercase",fontWeight:400,letterSpacing:1},children:"import"}),o.jsx("button",{onClick:()=>{i("Export functionality coming soon"),s("info")},className:"action-button",style:{textTransform:"lowercase",fontWeight:400,letterSpacing:1},children:"export"})]})]})},mn="rgb(140,185,162)",Ta=({value:t,onSelect:e})=>{const[r,n]=x.useState([]);return x.useEffect(()=>{try{const i=localStorage.getItem("burnlist_watchlists");if(i){const s=JSON.parse(i),a=Object.values(s).map(c=>({name:c.name,slug:c.slug}));n(a)}}catch{n([])}},[]),o.jsxs("select",{value:t||"",onChange:i=>e&&e(i.target.value),style:{background:"black",color:mn,border:`1px solid ${mn}`,fontFamily:"Courier New, monospace",fontSize:16,padding:"6px 12px",borderRadius:4,outline:"none",minWidth:180,margin:0},children:[o.jsx("option",{value:"",disabled:!0,children:"Select Watchlist"}),r.map(i=>o.jsx("option",{value:i.slug,children:i.name},i.slug))]})},be="rgb(140,185,162)",Da="#e31507",$t={border:`1.5px solid ${be}`,borderRadius:4,background:"black",color:be,fontFamily:"Courier New",padding:16,marginBottom:24,boxShadow:"0 2px 8px 0 rgba(140,185,162,0.08)"};function ka(t){var i,s;if(!t||!Array.isArray(t.historicalData)||t.historicalData.length<2)return{latest:null,change:null};const e=(i=t.historicalData[t.historicalData.length-1])==null?void 0:i.price,r=(s=t.historicalData[t.historicalData.length-2])==null?void 0:s.price;if(typeof e!="number"||typeof r!="number"||r===0)return{latest:null,change:null};const n=(e-r)/r*100;return{latest:e,change:n}}function Ea(){const t=x.useRef(null);return x.useEffect(()=>{t.current&&(t.current.innerHTML="");const e=document.createElement("script");return e.type="text/javascript",e.async=!0,e.src="https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js",e.innerHTML=JSON.stringify({allow_symbol_change:!0,calendar:!1,details:!1,hide_side_toolbar:!0,hide_top_toolbar:!0,hide_legend:!0,hide_volume:!0,hotlist:!1,interval:"D",locale:"en",save_image:!1,style:"1",symbol:"NASDAQ:AAPL",theme:"dark",timezone:"Etc/UTC",backgroundColor:"rgba(0, 0, 0, 1)",gridColor:"rgba(102, 187, 106, 0.06)",watchlist:[],withdateranges:!1,compareSymbols:[],studies:["STD;DEMA"],autosize:!0,overrides:{"mainSeriesProperties.candleStyle.upColor":"#00aaff","mainSeriesProperties.candleStyle.downColor":"#ffe600","mainSeriesProperties.candleStyle.borderUpColor":"#00aaff","mainSeriesProperties.candleStyle.borderDownColor":"#ffe600","mainSeriesProperties.candleStyle.wickUpColor":"#00aaff","mainSeriesProperties.candleStyle.wickDownColor":"#ffe600"}}),t.current&&t.current.appendChild(e),()=>{t.current&&(t.current.innerHTML="")}},[]),o.jsxs("div",{className:"tradingview-widget-container",style:{height:"150px",width:"100%"},children:[o.jsx("div",{ref:t,className:"tradingview-widget-container__widget",style:{height:"167px",width:"100%"}}),o.jsx("div",{className:"tradingview-widget-copyright",children:o.jsx("a",{href:"https://www.tradingview.com/",rel:"noopener nofollow",target:"_blank",children:o.jsx("span",{className:"blue-text",children:"Track all markets on TradingView"})})})]})}const $a=()=>{He(),Xe();const[t,e]=x.useState(""),[r,n]=x.useState(null);return x.useEffect(()=>{if(!t){n(null);return}try{const i=localStorage.getItem("burnlist_watchlists");if(i){const s=JSON.parse(i),a=Object.values(s).find(c=>c.slug===t);n(a||null)}else n(null)}catch{n(null)}},[t]),o.jsxs("div",{style:{fontFamily:"Courier New",color:be,background:"black",minHeight:"100vh",padding:"0"},children:[o.jsx(tt,{}),o.jsxs("div",{style:{margin:"70px 0 1px 0"},children:[o.jsxs("div",{style:{...$t,display:"flex",justifyContent:"space-between",alignItems:"center",fontWeight:700,fontSize:18},children:[o.jsx("div",{children:"Total Equity: $100,000"}),o.jsx("div",{children:"Cash: $20,000"}),o.jsxs("div",{children:["Open P/L: ",o.jsx("span",{style:{color:be},children:"+$1,200"})]}),o.jsxs("div",{children:["% Allocated: ",o.jsx("span",{style:{border:`1px solid ${be}`,padding:"2px 12px",borderRadius:2},children:"80%"})]}),o.jsx("div",{children:"Exposure: Long 70% / Short 10%"})]}),o.jsxs("div",{style:{display:"flex",gap:32},children:[o.jsx("div",{style:{flex:2},children:o.jsxs("div",{style:{...$t,minHeight:320},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[o.jsx("div",{style:{fontWeight:700,fontSize:17},children:"Positions"}),o.jsx("button",{style:{background:"none",color:be,border:`1px solid ${be}`,fontFamily:"Courier New",fontSize:15,padding:"4px 18px",borderRadius:2,cursor:"pointer"},children:"Add Position"}),o.jsx("button",{style:{background:"none",color:be,border:`1px solid ${be}`,fontFamily:"Courier New",fontSize:15,padding:"4px 18px",borderRadius:2,cursor:"pointer"},children:"Export .json"})]}),o.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:15},children:[o.jsx("thead",{children:o.jsxs("tr",{style:{borderBottom:`1.5px solid ${be}`},children:[o.jsx("th",{style:{textAlign:"left",padding:6},children:"Ticker"}),o.jsx("th",{style:{textAlign:"right",padding:6},children:"Buy"}),o.jsx("th",{style:{textAlign:"right",padding:6},children:"Current"}),o.jsx("th",{style:{textAlign:"right",padding:6},children:"% Return"}),o.jsx("th",{style:{textAlign:"right",padding:6},children:"$ Return"}),o.jsx("th",{style:{textAlign:"right",padding:6},children:"Size"}),o.jsx("th",{style:{textAlign:"right",padding:6},children:"Held"}),o.jsx("th",{style:{textAlign:"center",padding:6},children:"Status"}),o.jsx("th",{style:{textAlign:"center",padding:6},children:"Notes"}),o.jsx("th",{style:{textAlign:"center",padding:6},children:"Trade"})]})}),o.jsx("tbody",{children:[1,2,3].map(i=>o.jsxs("tr",{style:{borderBottom:"1px solid #222"},children:[o.jsx("td",{style:{padding:6},children:"AAPL"}),o.jsx("td",{style:{padding:6,textAlign:"right"},children:"$180.00"}),o.jsx("td",{style:{padding:6,textAlign:"right"},children:"$185.00"}),o.jsx("td",{style:{padding:6,textAlign:"right",color:be},children:"+2.8%"}),o.jsx("td",{style:{padding:6,textAlign:"right",color:be},children:"+$50"}),o.jsx("td",{style:{padding:6,textAlign:"right"},children:"$1,000"}),o.jsx("td",{style:{padding:6,textAlign:"right"},children:"3d"}),o.jsx("td",{style:{padding:6,textAlign:"center"},children:"Open"}),o.jsx("td",{style:{padding:6,textAlign:"center"},children:"📝"}),o.jsx("td",{style:{padding:6,textAlign:"center"},children:o.jsx("button",{style:{background:"none",color:be,border:`1px solid ${be}`,fontFamily:"Courier New",fontSize:14,padding:"2px 10px",borderRadius:2,cursor:"pointer"},children:"Trade"})})]},i))})]})]})}),o.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:24},children:[o.jsxs("div",{style:{...$t,minHeight:60,display:"flex",flexDirection:"column",alignItems:"stretch",justifyContent:"flex-start",padding:0},children:[o.jsx("div",{style:{padding:16,borderBottom:r&&Array.isArray(r.items)&&r.items.length>0?"1px solid #222":"none"},children:o.jsx(Ta,{value:t,onSelect:e})}),r&&Array.isArray(r.items)&&r.items.length>0&&o.jsx("div",{style:{maxHeight:220,overflowY:"auto",padding:0},children:o.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:15},children:[o.jsx("thead",{children:o.jsxs("tr",{style:{borderBottom:`1.5px solid ${be}`},children:[o.jsx("th",{style:{textAlign:"left",padding:6,position:"sticky",top:0,background:"black",zIndex:1},children:"Symbol"}),o.jsx("th",{style:{textAlign:"right",padding:6,position:"sticky",top:0,background:"black",zIndex:1},children:"Latest"}),o.jsx("th",{style:{textAlign:"right",padding:6,position:"sticky",top:0,background:"black",zIndex:1},children:"% Change"})]})}),o.jsx("tbody",{children:r.items.map((i,s)=>{const{latest:a,change:c}=ka(i);return o.jsxs("tr",{style:{borderBottom:"1px solid #222"},children:[o.jsx("td",{style:{padding:6},children:i.symbol}),o.jsx("td",{style:{padding:6,textAlign:"right"},children:typeof a=="number"?`$${a.toFixed(2)}`:"--"}),o.jsx("td",{style:{padding:6,textAlign:"right",color:typeof c=="number"?c>=0?be:Da:"#888"},children:typeof c=="number"?`${c>=0?"+":""}${c.toFixed(2)}%`:"--"})]},i.symbol||s)})})]})})]}),o.jsx("div",{style:{...$t,minHeight:180},children:o.jsx(Ea,{})})]})]}),o.jsxs("div",{style:{...$t,maxWidth:420,margin:"40px auto 0 auto",background:"#181818"},children:[o.jsx("div",{style:{fontWeight:700,fontSize:16,marginBottom:8},children:"Quick Trade Panel"}),o.jsxs("div",{style:{display:"flex",gap:10,marginBottom:8},children:[o.jsx("input",{placeholder:"Symbol",style:{flex:1,background:"black",color:be,border:`1px solid ${be}`,borderRadius:2,padding:"4px 8px",fontFamily:"Courier New"}}),o.jsxs("select",{style:{background:"black",color:be,border:`1px solid ${be}`,borderRadius:2,padding:"4px 8px",fontFamily:"Courier New"},children:[o.jsx("option",{children:"Long"}),o.jsx("option",{children:"Short"})]}),o.jsx("input",{placeholder:"Amount",style:{width:80,background:"black",color:be,border:`1px solid ${be}`,borderRadius:2,padding:"4px 8px",fontFamily:"Courier New"}})]}),o.jsxs("div",{style:{display:"flex",gap:10,marginBottom:8},children:[o.jsx("input",{placeholder:"Stop-loss ($ or %)",style:{flex:1,background:"black",color:be,border:`1px solid ${be}`,borderRadius:2,padding:"4px 8px",fontFamily:"Courier New"}}),o.jsx("input",{placeholder:"Take-profit ($ or %)",style:{flex:1,background:"black",color:be,border:`1px solid ${be}`,borderRadius:2,padding:"4px 8px",fontFamily:"Courier New"}})]}),o.jsx("textarea",{placeholder:"Reason (optional)",style:{width:"100%",background:"black",color:be,border:`1px solid ${be}`,borderRadius:2,padding:"4px 8px",fontFamily:"Courier New",minHeight:40,marginBottom:8}}),o.jsx("button",{style:{width:"100%",background:be,color:"black",border:"none",borderRadius:2,fontFamily:"Courier New",fontWeight:700,fontSize:15,padding:"8px 0",cursor:"pointer"},children:"Submit Trade"})]})]})]})},le="rgb(140,185,162)",ja=()=>{const{isInverted:t,toggleTheme:e}=Ue();He(),Xe();const[r,n]=x.useState([]),{notification:i,notificationType:s,setNotification:a,setNotificationType:c}=rt(),[u,p]=x.useState(!1),[d,h]=x.useState(new Set),C=ne(le),k=ne("black"),f=ne("#e31507");x.useEffect(()=>{const b=localStorage.getItem("trade_journal_trades");if(b)try{n(JSON.parse(b))}catch(q){l.error("Error loading trades:",q)}},[]),x.useEffect(()=>{localStorage.setItem("trade_journal_trades",JSON.stringify(r))},[r]);const m=(b,q)=>{n(D=>D.map(M=>M.id===b?{...M,...q}:M))},S=b=>{n(q=>q.filter(D=>D.id!==b)),a("Trade deleted","success")},y=b=>new Date(b).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"2-digit"}),v=async b=>{if(b)try{const q=await Hr(b),M=`https://www.tradingview.com/chart/i0seCgVv/?symbol=${encodeURIComponent(`${q}:${b.toUpperCase()}`)}`;window.open(M,"_blank")}catch(q){l.warn(`⚠️ Error opening chart for ${b}:`,q);const M=`https://www.tradingview.com/chart/i0seCgVv/?symbol=${encodeURIComponent(`NASDAQ:${b.toUpperCase()}`)}`;window.open(M,"_blank")}},N=(()=>{if(!r||r.length===0)return{totalTrades:0,winTrades:0,lossTrades:0,openTrades:0,winRate:0,averageReturn:0};const b=r.filter(w=>w.outcome&&w.outcome!=="Open"),q=b.filter(w=>w.outcome==="Win").length,D=b.filter(w=>w.outcome==="Loss").length,M=r.filter(w=>!w.outcome||w.outcome==="Open").length,re=b.length>0?q/b.length*100:0,Z=b.reduce((w,H)=>{if(!H.entryPrice||!H.target)return w;const U=parseFloat(H.entryPrice),E=parseFloat(H.target);if(isNaN(U)||isNaN(E)||U<=0)return w;const V=(E-U)/U*100;return w+V},0),O=b.length>0?Z/b.length:0;return{totalTrades:r.length,winTrades:q,lossTrades:D,openTrades:M,winRate:re,averageReturn:O}})(),K=()=>{p(!u),h(new Set)},se=b=>{h(q=>{const D=new Set(q);return D.has(b)?D.delete(b):D.add(b),D})},J=()=>{d.size===r.length?h(new Set):h(new Set(r.map(b=>b.id)))},z=()=>{if(d.size===0){a("Please select at least one trade to delete","error");return}n(b=>b.filter(q=>!d.has(q.id))),h(new Set),a(`Deleted ${d.size} trades`,"success")},R=()=>{if(d.size===0){a("Please select at least one trade to create burnlist","error");return}const b=r.filter(w=>d.has(w.id)),q=JSON.parse(localStorage.getItem("burnlist_watchlists")||"{}"),D=`Journal_${new Date().toISOString().split("T")[0]}`,M=`journal_${Date.now()}`,re=D.toLowerCase().replace(/[^a-z0-9]/g,"-"),Z={id:M,name:D,slug:re,items:b.map(w=>({symbol:w.ticker,buyPrice:parseFloat(w.entryPrice)||0,buyDate:w.executedAt||w.date||new Date().toISOString(),historicalData:[]})),reason:`Created from journal with ${b.length} trades`,createdAt:new Date().toISOString()},O={...q,[M]:Z};localStorage.setItem("burnlist_watchlists",JSON.stringify(O)),a(`Created burnlist "${D}" with ${b.length} stocks`,"success"),h(new Set)};return o.jsxs("div",{style:{backgroundColor:t?"rgb(140,185,162)":"#000000",color:t?"#000000":"#ffffff",minHeight:"100vh",padding:"0",fontFamily:"'Courier New', monospace"},children:[o.jsxs("div",{style:{padding:"32px"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:24,flexWrap:"wrap",gap:"12px"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:12},children:[o.jsx("button",{onClick:e,style:{border:"none",background:"none",padding:0,cursor:"pointer",display:"flex",alignItems:"center",minHeight:"44px"},"aria-label":"Toggle theme",children:o.jsx("img",{src:t?vt:Ct,alt:"Burnlist Logo",style:{width:44,height:44,marginRight:10,transition:"filter 0.3s"}})}),o.jsx("strong",{style:{fontSize:"170%",lineHeight:"44px",display:"inline-block",color:C,height:"44px"},children:"BURNLIST v1.1"})]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[o.jsx("span",{style:{color:f,fontWeight:"bold",fontSize:12},children:"0"}),o.jsx("span",{style:{color:C,fontWeight:"bold",fontSize:12},children:"0"}),o.jsx("span",{style:{color:C},children:"ACCOUNT: local"})]})]}),o.jsx(tt,{}),N.totalTrades>0&&o.jsxs("div",{style:{display:"flex",justifyContent:"space-around",alignItems:"center",padding:"12px 20px",background:"rgba(0,0,0,0.2)"},children:[o.jsxs("div",{style:{textAlign:"center"},children:[o.jsx("div",{style:{color:le,fontSize:"14px",fontWeight:"bold"},children:"TOTAL TRADES"}),o.jsx("div",{style:{color:le,fontSize:"18px",fontWeight:"bold"},children:N.totalTrades})]}),o.jsxs("div",{style:{textAlign:"center"},children:[o.jsx("div",{style:{color:le,fontSize:"14px",fontWeight:"bold"},children:"WINS"}),o.jsx("div",{style:{color:le,fontSize:"18px",fontWeight:"bold"},children:N.winTrades})]}),o.jsxs("div",{style:{textAlign:"center"},children:[o.jsx("div",{style:{color:le,fontSize:"14px",fontWeight:"bold"},children:"LOSSES"}),o.jsx("div",{style:{color:le,fontSize:"18px",fontWeight:"bold"},children:N.lossTrades})]}),o.jsxs("div",{style:{textAlign:"center"},children:[o.jsx("div",{style:{color:le,fontSize:"14px",fontWeight:"bold"},children:"OPEN"}),o.jsx("div",{style:{color:le,fontSize:"18px",fontWeight:"bold"},children:N.openTrades})]}),o.jsxs("div",{style:{textAlign:"center"},children:[o.jsx("div",{style:{color:le,fontSize:"14px",fontWeight:"bold"},children:"WIN RATE"}),o.jsxs("div",{style:{color:le,fontSize:"18px",fontWeight:"bold"},children:[N.winRate.toFixed(1),"%"]})]}),o.jsxs("div",{style:{textAlign:"center"},children:[o.jsx("div",{style:{color:le,fontSize:"14px",fontWeight:"bold"},children:"AVG RETURN"}),o.jsxs("div",{style:{color:le,fontSize:"18px",fontWeight:"bold"},children:[N.averageReturn.toFixed(1),"%"]})]})]}),i&&o.jsx(Oe,{message:i,type:s,onClose:()=>a("")}),r.length===0?o.jsxs("div",{style:{textAlign:"center",margin:"70px 0 1px 0",color:le,fontSize:"18px"},children:[o.jsx("div",{style:{marginBottom:"20px"},children:"No executed trades yet"}),o.jsx("div",{style:{fontSize:"14px",opacity:.7},children:"Execute trades from the Universe page to see them here"})]}):o.jsx("div",{style:{overflowX:"auto"},children:o.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",border:`1px solid ${le}`,fontSize:"14px",tableLayout:"fixed",lineHeight:"24px"},children:[o.jsx("thead",{children:o.jsxs("tr",{style:{background:"rgba(140,185,162,0.1)",borderBottom:`2px solid ${le}`,height:"40px"},children:[u&&o.jsx("th",{style:{padding:"0px",textAlign:"center",borderRight:`1px solid ${le}`,height:"40px",minHeight:"40px",maxHeight:"40px",lineHeight:"24px",boxSizing:"border-box",verticalAlign:"middle",overflow:"hidden",width:"40px"},children:o.jsx("input",{type:"checkbox",checked:d.size===r.length&&r.length>0,onChange:J,style:{accentColor:le}})}),o.jsx("th",{style:{padding:"0px",textAlign:"center",borderRight:`1px solid ${le}`,height:"40px",minHeight:"40px",maxHeight:"40px",lineHeight:"24px",boxSizing:"border-box",verticalAlign:"middle",overflow:"hidden"},children:"Ticker"}),o.jsx("th",{style:{padding:"0px",textAlign:"center",borderRight:`1px solid ${le}`,height:"40px",minHeight:"40px",maxHeight:"40px",lineHeight:"24px",boxSizing:"border-box",verticalAlign:"middle",overflow:"hidden"},children:"Setup"}),o.jsx("th",{style:{padding:"0px",textAlign:"center",borderRight:`1px solid ${le}`,height:"40px",minHeight:"40px",maxHeight:"40px",lineHeight:"24px",boxSizing:"border-box",verticalAlign:"middle",overflow:"hidden"},children:"R:R"}),o.jsx("th",{style:{padding:"0px",textAlign:"center",borderRight:`1px solid ${le}`,height:"40px",minHeight:"40px",maxHeight:"40px",lineHeight:"24px",boxSizing:"border-box",verticalAlign:"middle",overflow:"hidden"},children:"Verdict"}),o.jsx("th",{style:{padding:"0px",textAlign:"center",borderRight:`1px solid ${le}`,height:"40px",minHeight:"40px",maxHeight:"40px",lineHeight:"24px",boxSizing:"border-box",verticalAlign:"middle",overflow:"hidden"},children:"Outcome"}),o.jsx("th",{style:{padding:"0px",textAlign:"center",borderRight:`1px solid ${le}`,height:"40px",minHeight:"40px",maxHeight:"40px",lineHeight:"24px",boxSizing:"border-box",verticalAlign:"middle",overflow:"hidden"},children:"Entry"}),o.jsx("th",{style:{padding:"0px",textAlign:"center",borderRight:`1px solid ${le}`,height:"40px",minHeight:"40px",maxHeight:"40px",lineHeight:"24px",boxSizing:"border-box",verticalAlign:"middle",overflow:"hidden"},children:"Stop"}),o.jsx("th",{style:{padding:"0px",textAlign:"center",borderRight:`1px solid ${le}`,height:"40px",minHeight:"40px",maxHeight:"40px",lineHeight:"24px",boxSizing:"border-box",verticalAlign:"middle",overflow:"hidden"},children:"Target"}),o.jsx("th",{style:{padding:"0px",textAlign:"center",borderRight:`1px solid ${le}`,height:"40px",minHeight:"40px",maxHeight:"40px",lineHeight:"24px",boxSizing:"border-box",verticalAlign:"middle",overflow:"hidden"},children:"Position"}),o.jsx("th",{style:{padding:"0px",textAlign:"center",borderRight:`1px solid ${le}`,height:"40px",minHeight:"40px",maxHeight:"40px",lineHeight:"24px",boxSizing:"border-box",verticalAlign:"middle",overflow:"hidden"},children:"Date"}),o.jsx("th",{style:{padding:"0px",textAlign:"center",borderRight:`1px solid ${le}`,height:"40px",minHeight:"40px",maxHeight:"40px",lineHeight:"24px",boxSizing:"border-box",verticalAlign:"middle",overflow:"hidden"},children:"Price Source"}),u&&o.jsx("th",{style:{padding:"0px",textAlign:"center",height:"40px",minHeight:"40px",maxHeight:"40px",lineHeight:"24px",boxSizing:"border-box",verticalAlign:"middle",overflow:"hidden"},children:"Actions"})]})}),o.jsx("tbody",{children:r.map((b,q)=>o.jsxs("tr",{style:{borderBottom:`1px solid ${le}`,background:q%2===0?"rgba(0,0,0,0.3)":"rgba(0,0,0,0.1)",height:"40px"},children:[u&&o.jsx("td",{style:{padding:"0px",textAlign:"center",borderRight:`1px solid ${le}`,height:"40px",minHeight:"40px",maxHeight:"40px",lineHeight:"24px",boxSizing:"border-box",verticalAlign:"middle",overflow:"hidden",width:"40px"},children:o.jsx("input",{type:"checkbox",checked:d.has(b.id),onChange:()=>se(b.id),style:{accentColor:le}})}),o.jsx("td",{style:{padding:"0px",textAlign:"center",borderRight:`1px solid ${le}`,fontWeight:"bold",height:"40px",minHeight:"40px",maxHeight:"40px",lineHeight:"24px",boxSizing:"border-box",verticalAlign:"middle",overflow:"hidden"},children:o.jsx("span",{onClick:()=>v(b.ticker),style:{cursor:"pointer",textDecoration:"underline",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"},title:`Click to open ${b.ticker} chart in new tab`,children:b.ticker})}),o.jsx("td",{style:{padding:"0px",textAlign:"center",borderRight:`1px solid ${le}`,height:"40px",minHeight:"40px",maxHeight:"40px",lineHeight:"24px",boxSizing:"border-box",verticalAlign:"middle",overflow:"hidden"},children:b.setup||b.setupType||"Manual"}),o.jsx("td",{style:{padding:"0px",textAlign:"center",borderRight:`1px solid ${le}`,height:"40px",minHeight:"40px",maxHeight:"40px",lineHeight:"24px",boxSizing:"border-box",verticalAlign:"middle",overflow:"hidden"},children:b.riskReward?`${b.riskReward}:1`:"N/A"}),o.jsx("td",{style:{padding:"0px",textAlign:"center",borderRight:`1px solid ${le}`,height:"40px",minHeight:"40px",maxHeight:"40px",lineHeight:"24px",boxSizing:"border-box",verticalAlign:"middle",overflow:"hidden"},children:o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",height:"24px",maxHeight:"24px"},children:[o.jsx("img",{src:b.verdictFlag||Nt,alt:b.verdict,style:{width:"14px",height:"14px"}}),o.jsx("span",{style:{fontSize:"12px",lineHeight:"14px"},children:b.verdict||"Qualified"})]})}),o.jsx("td",{style:{padding:"0px",textAlign:"center",borderRight:`1px solid ${le}`,height:"40px",minHeight:"40px",maxHeight:"40px",lineHeight:"24px",boxSizing:"border-box",verticalAlign:"middle",overflow:"hidden"},children:o.jsxs("select",{value:b.outcome||"Open",onChange:D=>m(b.id,{outcome:D.target.value}),style:{background:"transparent",color:le,border:"none",padding:"2px 4px",fontFamily:"'Courier New', monospace",fontSize:"11px",cursor:"pointer",height:"35px",maxHeight:"35px",lineHeight:"31px"},children:[o.jsx("option",{value:"Open",children:"Open"}),o.jsx("option",{value:"Win",children:"Win"}),o.jsx("option",{value:"Loss",children:"Loss"}),o.jsx("option",{value:"Break Even",children:"Break Even"})]})}),o.jsxs("td",{style:{padding:"0px",textAlign:"center",borderRight:`1px solid ${le}`,height:"40px",minHeight:"40px",maxHeight:"40px",lineHeight:"24px",boxSizing:"border-box",verticalAlign:"middle",overflow:"hidden"},children:["$",b.entryPrice?b.entryPrice.toFixed(2):"N/A",b.currentMarketPrice&&o.jsxs("div",{style:{fontSize:"10px",color:"#666",marginTop:"2px",fontStyle:"italic"},children:["Market: $",b.currentMarketPrice.toFixed(2)]})]}),o.jsxs("td",{style:{padding:"0px",textAlign:"center",borderRight:`1px solid ${le}`,height:"40px",minHeight:"40px",maxHeight:"40px",lineHeight:"24px",boxSizing:"border-box",verticalAlign:"middle",overflow:"hidden"},children:["$",b.stopLoss?b.stopLoss.toFixed(2):"N/A"]}),o.jsxs("td",{style:{padding:"0px",textAlign:"center",borderRight:`1px solid ${le}`,height:"40px",minHeight:"40px",maxHeight:"40px",lineHeight:"24px",boxSizing:"border-box",verticalAlign:"middle",overflow:"hidden"},children:["$",b.target?b.target.toFixed(2):"N/A"]}),o.jsx("td",{style:{padding:"0px",textAlign:"center",borderRight:`1px solid ${le}`,height:"40px",minHeight:"40px",maxHeight:"40px",lineHeight:"24px",boxSizing:"border-box",verticalAlign:"middle",overflow:"hidden"},children:b.positionSize?`${b.positionSize} shares`:"N/A"}),o.jsx("td",{style:{padding:"0px",textAlign:"center",borderRight:`1px solid ${le}`,height:"40px",minHeight:"40px",maxHeight:"40px",lineHeight:"24px",boxSizing:"border-box",verticalAlign:"middle",overflow:"hidden"},children:b.executedAt?y(b.executedAt):y(b.date)}),o.jsx("td",{style:{padding:"0px",textAlign:"center",borderRight:`1px solid ${le}`,height:"40px",minHeight:"40px",maxHeight:"40px",lineHeight:"24px",boxSizing:"border-box",verticalAlign:"middle",overflow:"hidden"},children:b.priceSource||"Manual"}),u&&o.jsx("td",{style:{padding:"8px",textAlign:"center",height:"40px",minHeight:"40px",maxHeight:"40px",lineHeight:"24px",boxSizing:"border-box",verticalAlign:"middle",overflow:"hidden"},children:o.jsx(Ce,{onClick:()=>S(b.id),style:{background:"none",border:"none",color:"#ff4444",padding:"2px 4px",fontSize:"10px",cursor:"pointer",height:"20px",maxHeight:"20px",lineHeight:"16px"},children:"DELETE"})})]},b.id))})]})})]}),u&&o.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",padding:"10px 20px",borderBottom:`1px solid ${le}`,background:"rgba(0,0,0,0.2)",gap:"10px",marginBottom:"20px"},children:[o.jsx(Ce,{onClick:J,style:{background:d.size===r.length?le:"transparent",color:d.size===r.length?"#000000":le,border:`1px solid ${le}`,padding:"6px 12px",fontFamily:"'Courier New', monospace",fontSize:"10px",fontWeight:"bold",cursor:"pointer",transition:"all 0.2s ease"},children:d.size===r.length?"DESELECT ALL":"SELECT ALL"}),o.jsxs(Ce,{onClick:z,disabled:d.size===0,style:{background:d.size===0?"rgba(0,0,0,0.3)":"transparent",color:d.size===0?"#666":"#e31507",border:`1px solid ${d.size===0?"#666":"#e31507"}`,padding:"6px 12px",fontFamily:"'Courier New', monospace",fontSize:"10px",fontWeight:"bold",cursor:d.size===0?"not-allowed":"pointer",transition:"all 0.2s ease"},children:["DELETE (",d.size,")"]}),o.jsxs(Ce,{onClick:R,disabled:d.size===0,style:{background:d.size===0?"rgba(0,0,0,0.3)":"transparent",color:d.size===0?"#666":le,border:`1px solid ${d.size===0?"#666":le}`,padding:"6px 12px",fontFamily:"'Courier New', monospace",fontSize:"10px",fontWeight:"bold",cursor:d.size===0?"not-allowed":"pointer",transition:"all 0.2s ease"},children:["CREATE BURNLIST (",d.size,")"]})]}),o.jsxs("div",{className:"action-buttons-container",children:[o.jsx("style",{children:`
            .action-buttons-container {
              position: fixed;
              bottom: 20px;
              right: 20px;
              display: flex;
              gap: 8px;
              z-index: 1000;
            }
            
            @media (max-width: 768px) {
              .action-buttons-container {
                position: fixed;
                top: 50%;
                right: 10px;
                transform: translateY(-50%);
                flex-direction: column;
                gap: 8px;
              }
            }
            
            @media (max-width: 480px) {
              .action-buttons-container {
                position: fixed;
                top: 50%;
                right: 8px;
                transform: translateY(-50%);
                flex-direction: column;
                gap: 6px;
              }
            }
            
            .action-button {
              background: ${k};
              color: ${C};
              border: 1px solid ${C};
              font-size: 12px;
              padding: 6px 12px;
              box-shadow: 0 2px 4px rgba(0,0,0,0.3);
              min-height: 32px;
              font-family: 'Courier New', monospace;
              cursor: pointer;
              text-decoration: none;
              display: flex;
              align-items: center;
              justify-content: center;
            }
            
            @media (max-width: 768px) {
              .action-button {
                font-size: 10px;
                padding: 6px 8px;
                min-height: 32px;
                width: 60px;
              }
            }
            
            @media (max-width: 480px) {
              .action-button {
                font-size: 9px;
                padding: 4px 6px;
                min-height: 28px;
                width: 50px;
              }
            }
          `}),o.jsx("button",{onClick:()=>{a("Create functionality coming soon"),c("info")},className:"action-button",style:{backgroundColor:C,color:k,fontWeight:"bold",fontSize:"14px",transition:"all 0.2s ease-in-out",padding:"8px 16px"},children:"+++"}),o.jsx("button",{onClick:K,className:"action-button",style:{textTransform:"lowercase",fontWeight:400,letterSpacing:1},children:u?"done":"edit"}),o.jsx("button",{onClick:()=>{a("Import functionality coming soon"),c("info")},className:"action-button",style:{textTransform:"lowercase",fontWeight:400,letterSpacing:1},children:"import"}),o.jsx("button",{onClick:()=>{a("Export functionality coming soon"),c("info")},className:"action-button",style:{textTransform:"lowercase",fontWeight:400,letterSpacing:1},children:"export"})]})]})},Na=t=>{try{const e=t.trim().split(`
`),r=e[0].split(",").map(i=>i.trim()),n=e.slice(1).map((i,s)=>{const a=i.split(",").map(u=>u.trim()),c={};return r.forEach((u,p)=>{const d=a[p];["Week","Month","Quarter","HalfYear","Year","YearToDate","AnalystRecom","AvgVolume","RelativeVolume","Change"].includes(u)?c[u.toLowerCase().replace(/([A-Z])/g,"_$1").toLowerCase()]=parseFloat(d)||0:u==="Volume"?c.volume=parseFloat(d)||0:c[u.toLowerCase()]=d}),c});return l.info(`📊 Parsed ${n.length} sectors from CSV`),n}catch(e){return l.error("Error parsing sector CSV:",e),[]}},Ra=async t=>{try{const e=await fetch(t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const r=await e.text();return Na(r)}catch(e){return l.error("Error loading sector data from file:",e),[]}},yn=(t,e="year_to_date",r=5)=>[...t].sort((i,s)=>s[e]-i[e]).slice(0,r),xn=(t,e="year_to_date",r=5)=>[...t].sort((i,s)=>i[e]-s[e]).slice(0,r),Pa=t=>{if(!t||t.length===0)return{};const e=["week","month","quarter","half_year","year","year_to_date"],r={};return e.forEach(n=>{const i=t.map(s=>s[n]).filter(s=>!isNaN(s));i.length>0&&(r[n]={average:i.reduce((s,a)=>s+a,0)/i.length,median:i.sort((s,a)=>s-a)[Math.floor(i.length/2)],min:Math.min(...i),max:Math.max(...i),positive:i.filter(s=>s>0).length,negative:i.filter(s=>s<0).length})}),r},Ia="rgb(140,185,162)",Ma=({selectedTimeframe:t})=>{const e=ne(Ia);ne("black");const r=ne("#e31507"),n=ne("#888"),[i,s]=x.useState([]),[a,c]=x.useState(!1),[u,p]=x.useState(null);x.useEffect(()=>{d()},[]);const d=async()=>{c(!0),p(null);try{const v=await fetch("/api/finviz-sector");if(!v.ok)throw new Error(`HTTP error! status: ${v.status}`);const L=await v.text();console.log("Raw CSV data (first 500 chars):",L.substring(0,500));const N=h(L);console.log("Parsed sector data:",N),s(N),l.info(`📊 Loaded ${N.length} sectors from Finviz Elite`)}catch(v){l.error("Error fetching sector data:",v),p("Failed to load sector data")}finally{c(!1)}},h=v=>{try{const L=v.trim().split(`
`),N=L[0],K=[];let se="",J=!1;for(let R=0;R<N.length;R++){const b=N[R];b==='"'?J=!J:b===","&&!J?(K.push(se.trim()),se=""):se+=b}return K.push(se.trim()),L.slice(1).map((R,b)=>{const q={},D=[];let M="",re=!1;for(let Z=0;Z<R.length;Z++){const O=R[Z];O==='"'?re=!re:O===","&&!re?(D.push(M.trim()),M=""):M+=O}return D.push(M.trim()),K.forEach((Z,O)=>{const w=D[O];if(console.log(`Processing header: "${Z}" with value: "${w}"`),["Name","Performance (Week)","Performance (Month)","Performance (Quarter)","Performance (Year To Date)"].includes(Z))if(Z==="Name")q.name=w.replace(/"/g,""),console.log(`Set sector name to: ${q.name}`);else{const H=w.replace(/[%"]/g,""),U=Z.toLowerCase().replace(/\s+/g,"_").replace(/[()]/g,"");q[U]=parseFloat(H)||0,console.log(`Set ${U} to: ${q[U]}`)}}),q})}catch(L){return l.error("Error parsing sector CSV:",L),[]}},C=v=>Math.abs(v)<.05?"#000000":v>0?"#96B8A3":"#B02A1B",k=(v,L)=>{const N=v.map(R=>R[L]).filter(R=>R!==void 0);if(N.length===0)return[-10,10];const K=Math.min(...N),se=Math.max(...N);if(se-K<8){const R=(K+se)/2;return[R-4,R+4]}const z=R=>{const b=Math.abs(R);return b<=5?Math.sign(R)*5:b<=10?Math.sign(R)*10:b<=25?Math.sign(R)*25:b<=50?Math.sign(R)*50:Math.sign(R)*Math.ceil(b/100)*100};return[z(K),z(se)]},f=(v,L,N)=>{if(!v||v.length===0)return o.jsxs("div",{style:{marginBottom:32},children:[o.jsx("h4",{style:{color:e,marginBottom:16,fontFamily:"Courier New, monospace"},children:N}),o.jsx("div",{style:{background:"#000000",padding:16,border:`2px solid ${e}`,fontFamily:"Courier New, monospace",textAlign:"center",color:n},children:"No data available"})]});const K=[...v].sort((J,z)=>(z[L]||0)-(J[L]||0)),se=k(v,L);return o.jsxs("div",{style:{marginBottom:32},children:[o.jsx("h4",{style:{color:e,marginBottom:16,fontFamily:"Courier New, monospace"},children:N}),o.jsx("div",{style:{background:"#000000",padding:16,border:`2px solid ${e}`,fontFamily:"Courier New, monospace"},children:K.map((J,z)=>{const R=J[L]||0,b=(R-se[0])/(se[1]-se[0])*100,q=Math.max(0,Math.min(100,b));return o.jsx("div",{style:{marginBottom:8},children:o.jsxs("div",{style:{display:"flex",alignItems:"center",fontSize:12,color:"#ffffff"},children:[o.jsx("div",{style:{width:"180px",textAlign:"left",marginRight:12,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:13,color:"#96B8A3"},children:J.name||"Unknown Sector"}),o.jsx("div",{style:{flex:1,height:"20px",position:"relative",marginRight:12},children:o.jsx("div",{style:{width:`${q}%`,height:"100%",background:C(R),transition:"width 0.3s ease"}})}),o.jsxs("div",{style:{width:"70px",textAlign:"right",color:C(R),fontWeight:"bold",fontSize:11},children:[R>0?"+":"",(R||0).toFixed(2)]})]})},z)})})]})},m=()=>o.jsxs("div",{style:{marginBottom:32},children:[o.jsx("h4",{style:{color:e,marginBottom:16,fontFamily:"Courier New, monospace"},children:"SECTOR PERFORMANCE TABLE"}),o.jsx("div",{style:{background:"#000000",padding:16,border:`2px solid ${e}`,fontFamily:"Courier New, monospace"},children:o.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:15.84,color:"#ffffff"},children:[o.jsx("thead",{children:o.jsxs("tr",{style:{borderBottom:`1px solid ${n}`},children:[o.jsx("th",{style:{textAlign:"left",padding:"8px",color:e},children:"Sector"}),o.jsx("th",{style:{textAlign:"right",padding:"8px",color:e},children:"Week"}),o.jsx("th",{style:{textAlign:"right",padding:"8px",color:e},children:"Month"}),o.jsx("th",{style:{textAlign:"right",padding:"8px",color:e},children:"Quarter"}),o.jsx("th",{style:{textAlign:"right",padding:"8px",color:e},children:"YTD"})]})}),o.jsx("tbody",{children:i.map((v,L)=>o.jsxs("tr",{style:{borderBottom:`1px solid ${n}20`},children:[o.jsx("td",{style:{padding:"8px",fontWeight:"bold",color:"#96B8A3"},children:v.name||"Unknown Sector"}),o.jsxs("td",{style:{textAlign:"right",padding:"8px",color:C(v.performance_week||0)},children:[(v.performance_week||0)>0?"+":"",(v.performance_week||0).toFixed(2),"%"]}),o.jsxs("td",{style:{textAlign:"right",padding:"8px",color:C(v.performance_month||0)},children:[(v.performance_month||0)>0?"+":"",(v.performance_month||0).toFixed(2),"%"]}),o.jsxs("td",{style:{textAlign:"right",padding:"8px",color:C(v.performance_quarter||0)},children:[(v.performance_quarter||0)>0?"+":"",(v.performance_quarter||0).toFixed(2),"%"]}),o.jsxs("td",{style:{textAlign:"right",padding:"8px",color:C(v.performance_year_to_date||0)},children:[(v.performance_year_to_date||0)>0?"+":"",(v.performance_year_to_date||0).toFixed(2),"%"]})]},L))})]})})]});if(a)return o.jsx("div",{style:{textAlign:"center",padding:32,color:n,fontFamily:"Courier New, monospace"},children:"Loading sector data..."});if(u)return o.jsx("div",{style:{textAlign:"center",padding:32,color:r,fontFamily:"Courier New, monospace"},children:u});if(t==="D"||t==="day"||t==="Day")return m();const y=(()=>{const v={day:{dataKey:null,title:null},week:{dataKey:"performance_week",title:"SECTOR PERFORMANCE - WEEKLY"},month:{dataKey:"performance_month",title:"SECTOR PERFORMANCE - MONTHLY"},quarter:{dataKey:"performance_quarter",title:"SECTOR PERFORMANCE - QUARTERLY"},yeartodate:{dataKey:"performance_year_to_date",title:"SECTOR PERFORMANCE - YEAR-TO-DATE"}},L=t.toLowerCase().replace(/([A-Z])/g,"_$1").toLowerCase();return v[L]||v.yeartodate})();return y.dataKey?f(i,y.dataKey,y.title):m()};bn.register(Sn,wn,Cn,vn,Co,An,Tn,Dn,vo,Ao);const Fa="rgb(140,185,162)",Oa=()=>{const{isInverted:t,toggleTheme:e}=Ue();He(),Xe();const{notification:r,notificationType:n,setNotification:i,setNotificationType:s}=rt(),a=ne(Fa);ne("black");const c=ne("#e31507"),u=ne("#888"),[p,d]=x.useState({sp500:{name:"SP500",price:0,change:0,changePercent:0},nasdaq:{name:"NASDAQ",price:0,change:0,changePercent:0},dow:{name:"DOW",price:0,change:0,changePercent:0},vix:{name:"VIX",price:0,change:0,changePercent:0}}),[h,C]=x.useState(!1),[k,f]=x.useState(null),[m,S]=x.useState([]),[y,v]=x.useState("YearToDate"),[L,N]=x.useState({}),[K,se]=x.useState([]),[J,z]=x.useState([]);x.useEffect(()=>{R()},[y]),x.useEffect(()=>{if(m.length>0){const w=y.toLowerCase().replace(/([A-Z])/g,"_$1").toLowerCase(),H=yn(m,w,3),U=xn(m,w,3);se(H),z(U)}},[y,m]);const R=async()=>{C(!0);try{const w={day:"1day",week:"1week",month:"1month",quarter:"3month",yeartodate:"yearToDate"},H=y==="YearToDate"?"yeartodate":y.toLowerCase(),U=w[H]||"1day",E=await oo(U);l.log("📊 Market Overview Data:",E);const V={sp500:E.sp500||{name:"SP500",price:0,change:0,changePercent:0},nasdaq:E.nasdaq||{name:"NASDAQ",price:0,change:0,changePercent:0},dow:E.dow||{name:"DOW",price:0,change:0,changePercent:0},vix:E.vix||{name:"VIX",price:0,change:0,changePercent:0}};Object.keys(V).forEach(Y=>{V[Y].name||(V[Y].name=Y.toUpperCase()),typeof V[Y].price!="number"&&(V[Y].price=0),typeof V[Y].change!="number"&&(V[Y].change=0),typeof V[Y].changePercent!="number"&&(V[Y].changePercent=0)}),l.log("📊 Transformed Data:",V),d(V),i("Market data loaded successfully","success");let I=await Ra("/sector-data.csv");(!I||I.length===0)&&(l.warn("Failed to load CSV data, using mock data"),I=[{symbol:"AAPL",name:"Apple Inc.",price:178.9,week:-4.63,month:-3.34,quarter:5.66,half_year:2.72,year:.7,year_to_date:9.9,analyst_recom:2.04,avg_volume:709328.16,relative_volume:1.08,change:-.48,volume:766214341},{symbol:"MSFT",name:"Microsoft Corp.",price:345.67,week:-.52,month:1.43,quarter:15.71,half_year:3.2,year:29.72,year_to_date:11.56,analyst_recom:1.6,avg_volume:638713.19,relative_volume:1.11,change:-1.59,volume:711595174},{symbol:"GOOGL",name:"Alphabet Inc.",price:134.56,week:-4.67,month:-1.62,quarter:8.57,half_year:-7.38,year:15.19,year_to_date:-2.57,analyst_recom:1.82,avg_volume:144832831e-2,relative_volume:1.1,change:-3.08,volume:1593523147},{symbol:"AMZN",name:"Amazon.com Inc.",price:145.23,week:-1.6,month:-2.46,quarter:-1.23,half_year:1.28,year:7.31,year_to_date:4.41,analyst_recom:2,avg_volume:503732.57,relative_volume:1.01,change:.48,volume:508926113},{symbol:"TSLA",name:"Tesla Inc.",price:245.67,week:-1.28,month:-1.36,quarter:7.26,half_year:-3.27,year:-4.25,year_to_date:1.8,analyst_recom:1.94,avg_volume:765347.41,relative_volume:.91,change:-1.39,volume:695800246},{symbol:"NVDA",name:"NVIDIA Corp.",price:890.12,week:-3.69,month:-1.55,quarter:8.1,half_year:3.08,year:20.15,year_to_date:10.3,analyst_recom:2.06,avg_volume:143529189e-2,relative_volume:1.16,change:-1.63,volume:1667379359},{symbol:"META",name:"Meta Platforms Inc.",price:456.78,week:-4.5,month:-3.82,quarter:-5.35,half_year:-13.07,year:-14.67,year_to_date:-7.35,analyst_recom:1.86,avg_volume:136487092e-2,relative_volume:1.32,change:.47,volume:1795722275},{symbol:"AMD",name:"Advanced Micro Devices",price:156.78,week:-3.23,month:1.16,quarter:14.3,half_year:6.26,year:15.41,year_to_date:12,analyst_recom:2.04,avg_volume:970235.49,relative_volume:1.1,change:-1.44,volume:1066111094},{symbol:"NFLX",name:"Netflix Inc.",price:567.89,week:-3.13,month:-1.07,quarter:.25,half_year:-2.14,year:-2.25,year_to_date:-.41,analyst_recom:1.93,avg_volume:510249.51,relative_volume:1.19,change:-.26,volume:606765936},{symbol:"CRM",name:"Salesforce Inc.",price:234.56,week:-2.14,month:1.27,quarter:20.66,half_year:10.28,year:25.44,year_to_date:10.15,analyst_recom:1.67,avg_volume:258302634e-2,relative_volume:.97,change:-2.22,volume:2496969869},{symbol:"ORCL",name:"Oracle Corp.",price:123.45,week:1.07,month:4.86,quarter:7.86,half_year:10.18,year:19.05,year_to_date:13.99,analyst_recom:2.12,avg_volume:230278.34,relative_volume:1,change:.06,volume:230236110}]);const te=Pa(I),oe=yn(I,"year_to_date",3),F=xn(I,"year_to_date",3);S(I),N(te),se(oe),z(F),f(new Date),i("Market data loaded successfully","success")}catch(w){l.error("Error loading market data:",w),i("Failed to load market data","error")}finally{C(!1)}},b=w=>new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(w),q=w=>`${w>=0?"+":""}${w.toFixed(2)}`,D=w=>`${w>=0?"+":""}${w.toFixed(2)}%`,M=w=>w>=0?a:c,re=()=>{R()},Z=async w=>{if(w)try{const H=await Hr(w),E=`https://www.tradingview.com/chart/i0seCgVv/?symbol=${encodeURIComponent(`${H}:${w.toUpperCase()}`)}`;window.open(E,"_blank")}catch(H){l.warn(`⚠️ Error opening chart for ${w}:`,H);const E=`https://www.tradingview.com/chart/i0seCgVv/?symbol=${encodeURIComponent(`NASDAQ:${w.toUpperCase()}`)}`;window.open(E,"_blank")}};x.useMemo(()=>{const w=m.map(E=>E.name),H=y.toLowerCase().replace(/([A-Z])/g,"_$1").toLowerCase(),U=m.map(E=>E[H]||0);return{labels:w,datasets:[{label:`${y.replace(/([A-Z])/g," $1").trim()} Performance (%)`,data:U,backgroundColor:U.map(E=>E>=0?a:c),borderColor:U.map(E=>E>=0?a:c),borderWidth:2,borderRadius:4}]}},[m,y,a,c]),x.useMemo(()=>{const w=m.map(U=>U.name),H=m.map(U=>U.volume/1e6);return{labels:w,datasets:[{label:"Trading Volume (Millions)",data:H,backgroundColor:a+"40",borderColor:a,borderWidth:2,borderRadius:4}]}},[m,a]),x.useMemo(()=>{const w=m.map(U=>U.name),H=m.map(U=>U.analyst_recom||0);return{labels:w,datasets:[{label:"Analyst Recommendation Score",data:H,backgroundColor:m.map(U=>{const E=U.analyst_recom||0;return E<=1.5?a:E<=2?lt:c}),borderColor:m.map(U=>{const E=U.analyst_recom||0;return E<=1.5?a:E<=2?lt:c}),borderWidth:2,borderRadius:4}]}},[m,a,c]),x.useMemo(()=>{const w=m.map(U=>U.name),H=m.map(U=>U.relative_volume||0);return{labels:w,datasets:[{label:"Relative Volume",data:H,backgroundColor:H.map(U=>U>1.2?a:U>.8?lt:c),borderColor:H.map(U=>U>1.2?a:U>.8?lt:c),borderWidth:2,borderRadius:4}]}},[m,a,c]);const O=[{key:"day",label:"D"},{key:"week",label:"W"},{key:"month",label:"M"},{key:"quarter",label:"3M"},{key:"yearToDate",label:"YTD"}];return o.jsxs("div",{style:{minHeight:"100vh",background:t?"#ffffff":"#000000",color:t?"#000000":"#ffffff",fontFamily:"'Courier New', monospace"},children:[o.jsxs("div",{style:{padding:"32px"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:24,flexWrap:"wrap",gap:"12px"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:12},children:[o.jsx("button",{onClick:e,style:{border:"none",background:"none",padding:0,cursor:"pointer",display:"flex",alignItems:"center",minHeight:"44px"},"aria-label":"Toggle theme",children:o.jsx("img",{src:t?vt:Ct,alt:"Burnlist Logo",style:{width:44,height:44,marginRight:10,transition:"filter 0.3s"}})}),o.jsx("strong",{style:{fontSize:"170%",lineHeight:"44px",display:"inline-block",color:a,height:"44px"},children:"BURNLIST v1.1"})]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[o.jsx("span",{style:{color:c,fontWeight:"bold",fontSize:12},children:"0"}),o.jsx("span",{style:{color:a,fontWeight:"bold",fontSize:12},children:"0"}),o.jsx("span",{style:{color:a},children:"ACCOUNT: local"})]})]}),o.jsx(tt,{}),o.jsxs("div",{style:{marginBottom:24,paddingTop:24,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:O.map(({key:w,label:H})=>o.jsx("button",{onClick:()=>v(w==="yearToDate"?"YearToDate":w.charAt(0).toUpperCase()+w.slice(1)),style:{padding:"8px 16px",border:`2px solid ${y.toLowerCase()===w?a:u}`,background:y.toLowerCase()===w?a:"#000000",color:y.toLowerCase()===w?"#000000":"#ffffff",borderRadius:0,cursor:"pointer",fontFamily:"'Courier New', monospace",fontSize:12},children:H},w))}),o.jsx(Ce,{onClick:re,disabled:h,style:{backgroundColor:a,color:"#000000",padding:"8px 16px",border:"none",borderRadius:0,cursor:h?"not-allowed":"pointer",fontFamily:"'Courier New', monospace",fontSize:12,fontWeight:"bold"},children:h?"Loading...":"Refresh"})]}),o.jsxs("div",{style:{marginBottom:32},children:[o.jsx("h2",{style:{color:a,marginBottom:16},children:"MARKET OVERVIEW"}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:16},children:Object.entries(p).map(([w,H])=>(l.log(`📊 Market Card ${w}:`,H),o.jsxs("div",{style:{background:"#000000",padding:16,borderRadius:0,border:`2px solid ${u}`},children:[o.jsx("div",{style:{fontSize:12,color:u,marginBottom:4},children:H.name}),o.jsx("div",{style:{fontSize:18,fontWeight:"bold",marginBottom:4,color:"#ffffff"},children:h?"Loading...":`$${b(H.price)}`}),o.jsx("div",{style:{fontSize:14,color:M(H.changePercent)},children:h?"---":`${q(H.change)} (${D(H.changePercent)})`})]},w)))})]}),o.jsxs("div",{style:{marginBottom:32},children:[o.jsx("h3",{style:{color:a,marginBottom:16},children:"MARKET LEADERS"}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:16},children:[o.jsxs("div",{style:{background:"#000000",padding:16,borderRadius:0,border:`2px solid ${a}`},children:[o.jsxs("h4",{style:{color:a,marginBottom:12},children:["TOP PERFORMERS (",y.replace(/([A-Z])/g," $1").trim(),")"]}),K.map((w,H)=>{var V;const U=y.toLowerCase().replace(/([A-Z])/g,"_$1").toLowerCase(),E=w[U]||0;return o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 0",borderBottom:H<K.length-1?`1px solid ${u}20`:"none",cursor:"pointer"},onClick:()=>Z(w.symbol),title:`Click to open ${w.symbol} chart`,children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx("span",{style:{fontWeight:"bold",color:a},children:w.symbol}),o.jsx("span",{style:{fontSize:11,color:u},children:w.name})]}),o.jsxs("div",{style:{textAlign:"right"},children:[o.jsxs("div",{style:{color:M(E),fontWeight:"bold",fontSize:14},children:[E.toFixed(2),"%"]}),o.jsxs("div",{style:{fontSize:11,color:u},children:["$",((V=w.price)==null?void 0:V.toFixed(2))||"0.00"]})]})]},H)})]}),o.jsxs("div",{style:{background:"#000000",padding:16,borderRadius:0,border:`2px solid ${a}`},children:[o.jsxs("h4",{style:{color:a,marginBottom:12},children:["WORST PERFORMERS (",y.replace(/([A-Z])/g," $1").trim(),")"]}),J.map((w,H)=>{var V;const U=y.toLowerCase().replace(/([A-Z])/g,"_$1").toLowerCase(),E=w[U]||0;return o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 0",borderBottom:H<J.length-1?`1px solid ${u}20`:"none",cursor:"pointer"},onClick:()=>Z(w.symbol),title:`Click to open ${w.symbol} chart`,children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx("span",{style:{fontWeight:"bold",color:a},children:w.symbol}),o.jsx("span",{style:{fontSize:11,color:u},children:w.name})]}),o.jsxs("div",{style:{textAlign:"right"},children:[o.jsxs("div",{style:{color:M(E),fontWeight:"bold",fontSize:14},children:[E.toFixed(2),"%"]}),o.jsxs("div",{style:{fontSize:11,color:u},children:["$",((V=w.price)==null?void 0:V.toFixed(2))||"0.00"]})]})]},H)})]})]})]}),o.jsxs("div",{style:{marginBottom:32},children:[o.jsx("h3",{style:{color:a,marginBottom:16},children:"ANALYST RECOMMENDATIONS"}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:16},children:[o.jsxs("div",{style:{background:"#000000",padding:16,borderRadius:0,border:`2px solid ${a}`},children:[o.jsx("h4",{style:{color:a,marginBottom:12},children:"BUY RECOMMENDATIONS"}),m.filter(w=>w.analyst_recom<=2).slice(0,5).map((w,H)=>{var U,E;return o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 0",borderBottom:H<4?`1px solid ${u}20`:"none",cursor:"pointer"},onClick:()=>Z(w.symbol),title:`Click to open ${w.symbol} chart`,children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx("span",{style:{fontWeight:"bold",color:a},children:w.symbol}),o.jsx("span",{style:{fontSize:11,color:u},children:w.name})]}),o.jsxs("div",{style:{textAlign:"right"},children:[o.jsx("div",{style:{color:w.analyst_recom<=1.5?a:lt,fontWeight:"bold",fontSize:14},children:((U=w.analyst_recom)==null?void 0:U.toFixed(2))||"0.00"}),o.jsxs("div",{style:{fontSize:11,color:u},children:["$",((E=w.price)==null?void 0:E.toFixed(2))||"0.00"]})]})]},H)})]}),o.jsxs("div",{style:{background:"#000000",padding:16,borderRadius:0,border:`2px solid ${a}`},children:[o.jsx("h4",{style:{color:a,marginBottom:12},children:"SELL RECOMMENDATIONS"}),m.filter(w=>w.analyst_recom>2).slice(0,5).map((w,H)=>{var U,E;return o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 0",borderBottom:H<4?`1px solid ${u}20`:"none",cursor:"pointer"},onClick:()=>Z(w.symbol),title:`Click to open ${w.symbol} chart`,children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx("span",{style:{fontWeight:"bold",color:a},children:w.symbol}),o.jsx("span",{style:{fontSize:11,color:u},children:w.name})]}),o.jsxs("div",{style:{textAlign:"right"},children:[o.jsx("div",{style:{color:c,fontWeight:"bold",fontSize:14},children:((U=w.analyst_recom)==null?void 0:U.toFixed(2))||"0.00"}),o.jsxs("div",{style:{fontSize:11,color:u},children:["$",((E=w.price)==null?void 0:E.toFixed(2))||"0.00"]})]})]},H)})]})]})]}),o.jsxs("div",{style:{marginBottom:32},children:[o.jsx("h3",{style:{color:a,marginBottom:16},children:"RELATIVE VOLUME"}),o.jsx("div",{style:{background:"#000000",padding:16,borderRadius:0,border:`2px solid ${a}`},children:m.slice(0,10).map((w,H)=>{var U,E;return o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 0",borderBottom:H<9?`1px solid ${u}20`:"none",cursor:"pointer"},onClick:()=>Z(w.symbol),title:`Click to open ${w.symbol} chart`,children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx("span",{style:{fontWeight:"bold",color:a},children:w.symbol}),o.jsx("span",{style:{fontSize:11,color:u},children:w.name})]}),o.jsxs("div",{style:{textAlign:"right"},children:[o.jsx("div",{style:{color:w.relative_volume>1.2?a:w.relative_volume>.8?lt:c,fontWeight:"bold",fontSize:14},children:((U=w.relative_volume)==null?void 0:U.toFixed(2))||"0.00"}),o.jsxs("div",{style:{fontSize:11,color:u},children:["$",((E=w.price)==null?void 0:E.toFixed(2))||"0.00"]})]})]},H)})})]}),o.jsx("div",{style:{marginBottom:32},children:o.jsx(Ma,{selectedTimeframe:y})}),k&&o.jsxs("div",{style:{textAlign:"center",marginTop:16,fontSize:12,color:u},children:["Last updated: ",k.toLocaleString()]})]}),o.jsx(Oe,{notification:r,notificationType:n,setNotification:i,setNotificationType:s})]})},Ba="rgb(140,185,162)",La=({screener:t,onDelete:e,onEdit:r,isEditMode:n=!1})=>{const{isInverted:i}=Ue(),s=ne(Ba);ne("black");const a=ne("#e31507"),c=ne("#888"),u=d=>{d.preventDefault(),d.stopPropagation(),e&&e(t.id)},p=d=>{d.preventDefault(),d.stopPropagation(),r&&r(t)};return o.jsx(Mt,{to:`/screeners/screener/${t.slug}`,style:{textDecoration:"none",color:"inherit",display:"block"},children:o.jsxs("div",{style:{width:252,height:n?250:120,fontFamily:"Courier New",background:"transparent",padding:"10px 8px",margin:0,border:`1px solid ${s}`,borderRadius:0,boxShadow:"none",display:"flex",flexDirection:"column",alignItems:"stretch",justifyContent:"flex-start",position:"relative",boxSizing:"border-box",overflow:"hidden",cursor:"pointer"},children:[o.jsx("div",{style:{fontSize:18,color:s,fontWeight:"bold",marginBottom:4,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name}),n&&o.jsxs("div",{style:{display:"flex",gap:"4px",marginBottom:4},children:[o.jsx("button",{onClick:p,style:{backgroundColor:"transparent",color:s,border:`1px solid ${s}`,padding:"1px 4px",fontSize:9,width:"50%",fontWeight:"bold",fontFamily:"Courier New",cursor:"pointer",minHeight:"16px"},children:"EDIT"}),o.jsx("button",{onClick:u,style:{backgroundColor:"transparent",color:a,border:`1px solid ${a}`,padding:"1px 4px",fontSize:9,width:"50%",fontWeight:"bold",fontFamily:"Courier New",cursor:"pointer",minHeight:"16px"},children:"DEL"})]}),o.jsx("div",{style:{fontSize:14,color:s,marginBottom:4,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.notes||"N/A"}),o.jsx("div",{style:{fontSize:13,color:s,marginBottom:2,cursor:"help"},title:`Screener Type: Market | Created: ${new Date(t.createdAt).toLocaleDateString()}`,children:"Market Screener"}),o.jsx("div",{style:{fontSize:11,color:c,marginBottom:2,cursor:"help"},title:`Created: ${new Date(t.createdAt).toLocaleDateString()}`,children:new Date(t.createdAt).toLocaleDateString()})]})})},_a="rgb(140,185,162)",za=({isOpen:t,onClose:e,onSave:r,screener:n=null})=>{const{isInverted:i}=Ue(),s=ne(_a),a=ne("black"),c=ne("#e31507"),u=ne("#888"),[p,d]=x.useState({name:"",apiLink:"",apiKey:"",notes:""}),[h,C]=x.useState({});x.useEffect(()=>{d(n?{name:n.name||"",apiLink:n.apiLink||"",apiKey:n.apiKey||"",notes:n.notes||""}:{name:"",apiLink:"",apiKey:"",notes:""}),C({})},[n,t]);const k=()=>{const S={};return p.name.trim()||(S.name="Name is required"),p.apiLink.trim()?p.apiLink.includes("finviz.com")||(S.apiLink="API link must be a valid Finviz URL"):S.apiLink="API link is required",p.apiKey.trim()||(S.apiKey="API key is required"),C(S),Object.keys(S).length===0},f=S=>{if(S.preventDefault(),!k())return;const y={...p,id:(n==null?void 0:n.id)||`screener_${Date.now()}`,slug:p.name.toLowerCase().replace(/[^a-z0-9]/g,"-"),createdAt:(n==null?void 0:n.createdAt)||new Date().toISOString(),updatedAt:new Date().toISOString()};r(y),e()},m=(S,y)=>{d(v=>({...v,[S]:y})),h[S]&&C(v=>({...v,[S]:""}))};return t?o.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e4,padding:"20px"},children:o.jsxs("div",{style:{backgroundColor:a,border:`2px solid ${s}`,borderRadius:"8px",padding:"24px",maxWidth:"500px",width:"100%",maxHeight:"90vh",overflow:"auto"},children:[o.jsx("h2",{style:{margin:"0 0 20px 0",color:s,fontSize:"20px",fontWeight:"bold"},children:n?"Edit Screener":"Create New Screener"}),o.jsxs("form",{onSubmit:f,children:[o.jsxs("div",{style:{marginBottom:"16px"},children:[o.jsx("label",{style:{display:"block",marginBottom:"8px",color:s,fontSize:"14px",fontWeight:"bold"},children:"Screener Name *"}),o.jsx("input",{type:"text",value:p.name,onChange:S=>m("name",S.target.value),style:{width:"100%",padding:"10px",border:`1px solid ${h.name?c:s}`,borderRadius:"4px",backgroundColor:a,color:s,fontFamily:"Courier New",fontSize:"14px",boxSizing:"border-box"},placeholder:"Enter screener name"}),h.name&&o.jsx("div",{style:{color:c,fontSize:"12px",marginTop:"4px"},children:h.name})]}),o.jsxs("div",{style:{marginBottom:"16px"},children:[o.jsx("label",{style:{display:"block",marginBottom:"8px",color:s,fontSize:"14px",fontWeight:"bold"},children:"Finviz API Link *"}),o.jsx("input",{type:"url",value:p.apiLink,onChange:S=>m("apiLink",S.target.value),style:{width:"100%",padding:"10px",border:`1px solid ${h.apiLink?c:s}`,borderRadius:"4px",backgroundColor:a,color:s,fontFamily:"Courier New",fontSize:"14px",boxSizing:"border-box"},placeholder:"https://elite.finviz.com/export.ashx?v=111&f=..."}),o.jsx("div",{style:{fontSize:"11px",color:u,marginTop:"4px",fontStyle:"italic"},children:"Note: This URL serves as both the API endpoint and CSV data source for Finviz Elite screeners."}),h.apiLink&&o.jsx("div",{style:{color:c,fontSize:"12px",marginTop:"4px"},children:h.apiLink})]}),o.jsxs("div",{style:{marginBottom:"16px"},children:[o.jsx("label",{style:{display:"block",marginBottom:"8px",color:s,fontSize:"14px",fontWeight:"bold"},children:"API Key *"}),o.jsx("input",{type:"text",value:p.apiKey,onChange:S=>m("apiKey",S.target.value),autoComplete:"off","data-form-type":"other",name:"api-key",style:{width:"100%",padding:"10px",border:`1px solid ${h.apiKey?c:s}`,borderRadius:"4px",backgroundColor:a,color:s,fontFamily:"Courier New",fontSize:"14px",boxSizing:"border-box"},placeholder:"Enter your API key"}),h.apiKey&&o.jsx("div",{style:{color:c,fontSize:"12px",marginTop:"4px"},children:h.apiKey})]}),o.jsxs("div",{style:{marginBottom:"24px"},children:[o.jsx("label",{style:{display:"block",marginBottom:"8px",color:s,fontSize:"14px",fontWeight:"bold"},children:"Notes"}),o.jsx("textarea",{value:p.notes,onChange:S=>m("notes",S.target.value),style:{width:"100%",padding:"10px",border:`1px solid ${s}`,borderRadius:"4px",backgroundColor:a,color:s,fontFamily:"Courier New",fontSize:"14px",boxSizing:"border-box",minHeight:"80px",resize:"vertical"},placeholder:"Optional notes about this screener"})]}),o.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[o.jsx(Ce,{type:"button",onClick:e,style:{background:"transparent",color:s,border:`1px solid ${s}`,padding:"10px 20px",fontSize:"14px",minWidth:"80px"},children:"Cancel"}),o.jsx(Ce,{type:"submit",style:{background:s,color:a,border:`1px solid ${s}`,padding:"10px 20px",fontSize:"14px",minWidth:"80px",fontWeight:"bold"},children:n?"Update":"Create"})]})]})]})}):null},Ua="rgb(140,185,162)",Wa=()=>{He(),Xe();const{isInverted:t,toggleTheme:e}=Ue(),r=ne(Ua),n=ne("black"),i=ne("#e31507"),s=ne("#888"),{notification:a,notificationType:c,setNotification:u,setNotificationType:p}=rt(),[d,h]=x.useState({}),[C,k]=x.useState(!1),[f,m]=x.useState(null),[S,y]=x.useState(!1);x.useEffect(()=>{try{const J=localStorage.getItem("burnlist_screeners");if(J){const z=JSON.parse(J);h(z)}}catch(J){l.error("Failed to load screeners:",J)}},[]),x.useEffect(()=>{localStorage.setItem("burnlist_screeners",JSON.stringify(d))},[d]);const v=()=>{m(null),k(!0)},L=J=>{m(J),k(!0)},N=J=>{const z=Object.keys(d).find(q=>d[q].id===J);if(!z){l.log("🗑️ Could not find screener with id:",J);return}const{[z]:R,...b}=d;h(b),u("🗑️ Screener deleted"),p("success")},K=J=>{if(f){const z={...d},R=Object.keys(d).find(b=>d[b].id===f.id);R&&(z[R]={...J,id:f.id,createdAt:f.createdAt},h(z),u("✅ Screener updated successfully"),p("success"))}else{const z={...J,id:`screener_${Date.now()}`,createdAt:new Date().toISOString()},R={...d,[z.id]:z};h(R),u("✅ Screener created successfully"),p("success")}},se=()=>{k(!1),m(null)};return o.jsxs("div",{style:{fontFamily:"Courier New",color:r,backgroundColor:n,minHeight:"100vh",padding:"0"},children:[o.jsxs("div",{style:{padding:"32px 32px 0 32px"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px",flexWrap:"wrap",gap:"12px"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[o.jsx("button",{onClick:e,style:{border:"none",background:"none",padding:0,cursor:"pointer",display:"flex",alignItems:"center"},"aria-label":"Toggle theme",children:o.jsx("img",{src:t?vt:Ct,alt:"Burnlist Logo",style:{width:44,height:44,marginRight:10,transition:"filter 0.3s"}})}),o.jsx("strong",{style:{fontSize:"170%",lineHeight:"44px",display:"inline-block",color:r,height:"44px"},children:"BURNLIST v1.1"})]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[o.jsx("span",{style:{color:i,fontWeight:"bold",fontSize:12},children:"0"}),o.jsx("span",{style:{color:r,fontWeight:"bold",fontSize:12},children:"0"}),o.jsx("span",{style:{color:r},children:"ACCOUNT: local"})]})]}),o.jsx(tt,{}),o.jsx("div",{style:{marginTop:"30px",color:r},children:o.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(252px, 252px))",rowGap:"20px",columnGap:"20px",margin:"70px 0 1px 0",justifyContent:"center",alignItems:"start"},children:Object.values(d).length===0?o.jsxs("div",{style:{gridColumn:"1 / -1",textAlign:"center",padding:"40px",border:`2px dashed ${r}`,borderRadius:"8px",color:s},children:[o.jsx("div",{style:{fontSize:"16px",marginBottom:"8px"},children:"No screeners yet"}),o.jsx("div",{style:{fontSize:"12px"},children:'Click "ADD SCREENER" to create your first screener'})]}):Object.values(d).map(J=>o.jsx(La,{screener:J,onDelete:N,onEdit:L,isEditMode:S},J.id))})}),a&&o.jsx("div",{className:"fixed top-6 left-0 right-0 z-[10001] flex justify-center pointer-events-none md:top-4",children:o.jsx("div",{className:"min-w-80 max-w-[480px] pointer-events-auto md:min-w-70 md:max-w-[calc(100vw-32px)]",children:o.jsx(Oe,{message:a,type:c,onClose:()=>u("")})})}),o.jsx(za,{isOpen:C,onClose:se,onSave:K,screener:f})]}),o.jsxs("div",{className:"action-buttons-container",children:[o.jsx("style",{children:`
            .action-buttons-container {
              position: fixed;
              bottom: 20px;
              right: 20px;
              display: flex;
              gap: 8px;
              z-index: 1000;
            }
            
            @media (max-width: 768px) {
              .action-buttons-container {
                position: fixed;
                top: 50%;
                right: 10px;
                transform: translateY(-50%);
                flex-direction: column;
                gap: 8px;
              }
            }
            
            @media (max-width: 480px) {
              .action-buttons-container {
                position: fixed;
                top: 50%;
                right: 8px;
                transform: translateY(-50%);
                flex-direction: column;
                gap: 6px;
              }
            }
            
            .action-button {
              background: ${n};
              color: ${r};
              border: 1px solid ${r};
              font-size: 12px;
              padding: 6px 12px;
              box-shadow: 0 2px 4px rgba(0,0,0,0.3);
              min-height: 32px;
              font-family: 'Courier New', monospace;
              cursor: pointer;
              text-decoration: none;
              display: flex;
              align-items: center;
              justify-content: center;
            }
            
            @media (max-width: 768px) {
              .action-button {
                font-size: 10px;
                padding: 6px 8px;
                min-height: 32px;
                width: 60px;
              }
            }
            
            @media (max-width: 480px) {
              .action-button {
                font-size: 9px;
                padding: 4px 6px;
                min-height: 28px;
                width: 50px;
              }
            }
          `}),o.jsx("button",{onClick:v,className:"action-button",style:{backgroundColor:r,color:n,fontWeight:"bold",fontSize:"14px",transition:"all 0.2s ease-in-out",padding:"8px 16px"},children:"+++"}),o.jsx("button",{onClick:()=>y(!S),className:"action-button",style:{textTransform:"lowercase",fontWeight:400,letterSpacing:1},children:S?"done":"edit"}),o.jsx("button",{onClick:()=>{u("Import functionality coming soon"),p("info")},className:"action-button",style:{textTransform:"lowercase",fontWeight:400,letterSpacing:1},children:"import"}),o.jsx("button",{onClick:()=>{u("Export functionality coming soon"),p("info")},className:"action-button",style:{textTransform:"lowercase",fontWeight:400,letterSpacing:1},children:"export"})]})]})},Ha=()=>{const t=[{Ticker:"AAPL",Company:"Apple Inc.",Sector:"Technology",Industry:"Consumer Electronics",Country:"USA","Market Cap":"$2,500.00B","P/E":"25.5",Price:"$150.25",Change:"+2.5%",Volume:"50,000,000"},{Ticker:"MSFT",Company:"Microsoft Corporation",Sector:"Technology",Industry:"Software",Country:"USA","Market Cap":"$2,200.00B","P/E":"30.2",Price:"$320.10",Change:"+1.8%",Volume:"35,000,000"},{Ticker:"GOOGL",Company:"Alphabet Inc.",Sector:"Technology",Industry:"Internet Content & Information",Country:"USA","Market Cap":"$1,800.00B","P/E":"28.7",Price:"$2,850.75",Change:"-0.5%",Volume:"15,000,000"},{Ticker:"AMZN",Company:"Amazon.com Inc.",Sector:"Consumer Cyclical",Industry:"Internet Retail",Country:"USA","Market Cap":"$1,600.00B","P/E":"45.2",Price:"$3,200.50",Change:"+3.2%",Volume:"25,000,000"},{Ticker:"TSLA",Company:"Tesla Inc.",Sector:"Consumer Cyclical",Industry:"Auto Manufacturers",Country:"USA","Market Cap":"$800.00B","P/E":"75.8",Price:"$250.00",Change:"-1.2%",Volume:"40,000,000"},{Ticker:"NVDA",Company:"NVIDIA Corporation",Sector:"Technology",Industry:"Semiconductors",Country:"USA","Market Cap":"$1,200.00B","P/E":"85.3",Price:"$480.75",Change:"+5.8%",Volume:"30,000,000"},{Ticker:"META",Company:"Meta Platforms Inc.",Sector:"Technology",Industry:"Internet Content & Information",Country:"USA","Market Cap":"$900.00B","P/E":"22.1",Price:"$350.25",Change:"+2.1%",Volume:"20,000,000"},{Ticker:"BRK.A",Company:"Berkshire Hathaway Inc.",Sector:"Financial Services",Industry:"Insurance",Country:"USA","Market Cap":"$700.00B","P/E":"18.5",Price:"$520,000.00",Change:"+0.8%",Volume:"1,500"}],r=[["No.","Ticker","Company","Sector","Industry","Country","Market Cap","P/E","Price","Change","Volume"].join(",")];return t.forEach((n,i)=>{const s=[i+1,n.Ticker,n.Company,n.Sector,n.Industry,n.Country,n["Market Cap"],n["P/E"],n.Price,n.Change,n.Volume];r.push(s.join(","))}),r.join(`
`)},Va=()=>{const e=Ha().trim().split(`
`),r=e[0].split(",").map(n=>n.trim().replace(/"/g,""));return e.slice(1).map(n=>{const i=n.split(",").map(a=>a.trim().replace(/"/g,"")),s={};return r.forEach((a,c)=>{s[a]=i[c]||""}),s})},qa="rgb(140,185,162)",Ga=()=>{const{screenerSlug:t}=Ft(),e=He(),{isInverted:r,toggleTheme:n}=Ue(),i=ne(qa),s=ne("black"),a=ne("#e31507"),c=ne("#888"),{notification:u,notificationType:p,setNotification:d,setNotificationType:h}=rt(),[C,k]=x.useState(null),[f,m]=x.useState([]),[S,y]=x.useState(!1),[v,L]=x.useState({key:"Ticker",direction:"asc"});x.useEffect(()=>{try{const D=JSON.parse(localStorage.getItem("burnlist_screeners")||"{}"),M=Object.values(D).find(re=>re.slug===t);M?(k(M),N(M.apiLink)):(d("⚠️ Screener not found"),h("error"),e("/screeners"))}catch(D){l.error("Failed to load screener:",D),d("⚠️ Failed to load screener"),h("error"),e("/screeners")}},[t,e]);const N=async D=>{y(!0),d(""),l.debug("Fetching screener data from:",D);try{let M=!1,re="";if(!D.includes("elite.finviz.com"))try{const Z=await fetch(D);Z.ok&&(re=await Z.text(),M=!0)}catch{l.debug("Direct fetch failed, trying proxy...")}if(!M&&D.includes("elite.finviz.com"))try{let Z=D;l.debug("Original URL:",D);const O=(C==null?void 0:C.apiKey)||"f6202a40-4a7c-4d91-9ef8-068795ffbac0";if(D.includes("ft="))Z=D.replace(/[?&]ft=[^&]*/,U=>(U.startsWith("?")?"?":"&")+`auth=${O}`),l.debug("Transformed URL (ft->auth):",Z);else if(D.includes("elite.finviz.com")&&!D.includes("auth=")){const U=D.includes("?")?"&":"?";Z=D+U+`auth=${O}`,l.debug("Transformed URL (added auth):",Z)}const w=`/api/finviz-proxy?url=${encodeURIComponent(Z)}`;l.debug("Using proxy URL:",w);const H=await fetch(w);if(H.ok)re=await H.text(),M=!0,l.debug("Successfully fetched data via proxy");else{const U=await H.json().catch(()=>({}));throw l.error("Proxy server error:",U),new Error(`Proxy error: ${U.error||H.statusText}`)}}catch(Z){l.debug("Proxy failed:",Z.message)}if(!M&&D.includes("finviz.com")&&!D.includes("elite.finviz.com"))try{const Z=`https://cors-anywhere.herokuapp.com/${D}`,O=await fetch(Z,{headers:{Origin:window.location.origin,"X-Requested-With":"XMLHttpRequest"}});O.ok&&(re=await O.text(),M=!0)}catch{l.debug("Proxy fetch failed, using test data...")}if(M&&re){const Z=K(re);l.debug("Parsed CSV data:",Z.slice(0,3)),m(Z),d("✅ Screener data loaded successfully"),h("success")}else throw new Error("All fetch strategies failed")}catch(M){l.error("Failed to fetch screener data:",M),D.includes("elite.finviz.com")?(d("⚠️ Elite authentication failed. Using test data for demonstration."),h("warning")):(d("⚠️ API access blocked: Using test data for demonstration"),h("warning")),m(Va())}finally{y(!1)}},K=D=>{const M=D.trim().split(`
`),re=O=>{const w=[];let H="",U=!1;for(let E=0;E<O.length;E++){const V=O[E];V==='"'?U=!U:V===","&&!U?(w.push(H.trim()),H=""):H+=V}return w.push(H.trim()),w},Z=re(M[0]).map(O=>O.replace(/"/g,""));return M.slice(1).map(O=>{const w=re(O).map(U=>U.replace(/"/g,"")),H={};return Z.forEach((U,E)=>{H[U]=w[E]||""}),H})},se=D=>{L(M=>({key:D,direction:M.key===D&&M.direction==="asc"?"desc":"asc"}))},J=x.useMemo(()=>f.length?[...f].sort((D,M)=>{const re=D[v.key]||"",Z=M[v.key]||"";let O=0;if(["Price","Change","Volume","P/E","Market Cap"].includes(v.key)){const w=parseFloat(re.replace(/[^\d.-]/g,"")),H=parseFloat(Z.replace(/[^\d.-]/g,""));O=isNaN(w)?-1:isNaN(H)?1:w-H}else O=re.localeCompare(Z);return v.direction==="asc"?O:-O}):[],[f,v]),z=()=>{C&&N(C.apiLink)},R=()=>{if(!C||!f.length){d("⚠️ No data to send to universe"),h("error");return}try{const M=new Date().toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),re=`${C.name} ${M}`,Z=Pt(),O=re.toLowerCase().replace(/[^a-z0-9]/g,"-"),w=f.map(V=>({symbol:V.Ticker,buyPrice:parseFloat(V.Price)||0,buyDate:new Date().toISOString(),addedAt:new Date().toISOString(),type:"real"})),H={id:Z,name:re,slug:O,items:w,reason:`Created from screener: ${C.name}`,createdAt:new Date().toISOString()},E={...JSON.parse(localStorage.getItem("burnlist_universes")||"{}"),[Z]:H};localStorage.setItem("burnlist_universes",JSON.stringify(E)),d(`✅ Created universe "${re}" with ${w.length} tickers`),h("success"),e(`/universe/${O}`)}catch(D){l.error("Failed to create universe:",D),d("❌ Failed to create universe"),h("error")}},b=(D,M)=>{if(!D)return"-";switch(M){case"Price":return`$${parseFloat(D).toFixed(2)}`;case"Change":const re=parseFloat(D),Z=re>=0?i:a;return o.jsxs("span",{style:{color:Z},children:[re>=0?"+":"",re.toFixed(2),"%"]});case"Volume":const O=parseInt(D.replace(/,/g,""));return O>=1e6?`${(O/1e6).toFixed(1)}M`:O>=1e3?`${(O/1e3).toFixed(1)}K`:O.toLocaleString();case"Market Cap":const w=D.replace(/[^\d]/g,"");return`$${(parseInt(w)/1e5).toFixed(2)}B`;default:return D}},q=({column:D,label:M})=>o.jsxs("th",{onClick:()=>se(D),style:{cursor:"pointer",padding:"12px 8px",textAlign:"center",borderBottom:`2px solid ${i}`,color:i,fontWeight:"bold",fontSize:"14.5px",userSelect:"none",transition:"background-color 0.2s",":hover":{backgroundColor:"rgba(140,185,162,0.1)"}},children:[M,v.key===D&&o.jsx("span",{style:{marginLeft:"4px"},children:v.direction==="asc"?"↑":"↓"})]});return C?o.jsx("div",{style:{fontFamily:"Courier New",color:i,backgroundColor:s,minHeight:"100vh",padding:"0"},children:o.jsxs("div",{style:{padding:"32px"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:24,flexWrap:"wrap",gap:"12px"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:12},children:[o.jsx("button",{onClick:n,style:{border:"none",background:"none",padding:0,cursor:"pointer",display:"flex",alignItems:"center",minHeight:"44px"},"aria-label":"Toggle theme",children:o.jsx("img",{src:r?vt:Ct,alt:"Burnlist Logo",style:{width:44,height:44,marginRight:10,transition:"filter 0.3s"}})}),o.jsx("strong",{style:{fontSize:"170%",lineHeight:"44px",display:"inline-block",color:i,height:"44px"},children:"BURNLIST v1.1"})]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[o.jsx("span",{style:{color:a,fontWeight:"bold",fontSize:12},children:"19"}),o.jsx("span",{style:{color:i,fontWeight:"bold",fontSize:12},children:"6"}),o.jsx("span",{style:{color:i},children:"ACCOUNT: local"})]})]}),o.jsx(tt,{}),o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px",flexWrap:"wrap",gap:"12px"},children:[o.jsx(Ce,{onClick:()=>e("/screeners"),style:{background:"transparent",color:i,border:`1px solid ${i}`,padding:"8px 16px",fontSize:"12px",minWidth:"auto"},children:"← BACK TO SCREENERS"}),o.jsx("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:o.jsx(Ce,{onClick:z,disabled:S,style:{background:"transparent",color:i,border:"none",padding:"0",fontSize:"24px",minWidth:"auto",opacity:S?.6:1,cursor:S?"not-allowed":"pointer",textDecoration:"none",fontWeight:"bold"},children:C.name})})]}),C.notes&&o.jsx("div",{style:{marginBottom:"20px",padding:"12px",border:`1px solid ${i}`,borderRadius:"4px",backgroundColor:"rgba(140,185,162,0.05)"},children:o.jsx("div",{style:{fontSize:"12px",color:c},children:C.notes})}),o.jsx("div",{style:{overflowX:"auto",border:`1px solid ${i}`,borderRadius:"4px"},children:o.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"14.5px"},children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx(q,{column:"Ticker",label:"Ticker"}),o.jsx(q,{column:"Company",label:"Company"}),o.jsx(q,{column:"Price",label:"Price"}),o.jsx(q,{column:"Change",label:"Change"}),o.jsx(q,{column:"Volume",label:"Volume"}),o.jsx(q,{column:"P/E",label:"P/E"}),o.jsx(q,{column:"Market Cap",label:"Market Cap"}),o.jsx(q,{column:"Sector",label:"Sector"}),o.jsx(q,{column:"Country",label:"Country"})]})}),o.jsx("tbody",{children:J.map((D,M)=>o.jsxs("tr",{style:{borderBottom:`1px solid ${c}`,":hover":{backgroundColor:"rgba(140,185,162,0.05)"}},children:[o.jsx("td",{style:{padding:"8px",textAlign:"center",fontWeight:"bold"},children:o.jsx("a",{href:`https://elite.finviz.com/charts?t=${D.Ticker}&p=d&l=1h1v`,target:"_blank",rel:"noopener noreferrer",style:{color:i,textDecoration:"none",cursor:"pointer",":hover":{textDecoration:"underline"}},children:D.Ticker})}),o.jsx("td",{style:{padding:"8px",textAlign:"left"},children:D.Company}),o.jsx("td",{style:{padding:"8px",textAlign:"center"},children:b(D.Price,"Price")}),o.jsx("td",{style:{padding:"8px",textAlign:"center"},children:b(D.Change,"Change")}),o.jsx("td",{style:{padding:"8px",textAlign:"center"},children:b(D.Volume,"Volume")}),o.jsx("td",{style:{padding:"8px",textAlign:"center"},children:b(D["P/E"],"P/E")}),o.jsx("td",{style:{padding:"8px",textAlign:"center"},children:b(D["Market Cap"],"Market Cap")}),o.jsx("td",{style:{padding:"8px",textAlign:"left"},children:D.Sector}),o.jsx("td",{style:{padding:"8px",textAlign:"center"},children:D.Country})]},M))})]})}),o.jsxs("div",{style:{marginTop:"16px",fontSize:"14.5px",color:c,textAlign:"center"},children:["Showing ",J.length," results"]}),o.jsx("div",{style:{marginTop:"20px",textAlign:"center"},children:o.jsx(Ce,{onClick:R,disabled:!f.length,style:{backgroundColor:f.length?"rgb(150,184,163)":c,color:s,border:"1px solid rgb(150,184,163)",padding:"12px 24px",fontSize:"14px",minWidth:"200px",opacity:f.length?1:.6,cursor:f.length?"pointer":"not-allowed"},children:"SEND TO UNIVERSE"})}),u&&o.jsx("div",{style:{position:"fixed",top:24,left:0,right:0,zIndex:10001,display:"flex",justifyContent:"center",pointerEvents:"none"},children:o.jsx("div",{style:{minWidth:320,maxWidth:480,pointerEvents:"auto"},children:o.jsx(Oe,{message:u,type:p,onClose:()=>d("")})})})]})}):o.jsx("div",{style:{fontFamily:"Courier New",color:i,backgroundColor:s,minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center"},children:"Loading..."})},Ja="rgb(140,185,162)",Qa="rgb(120,150,130)",Ya="rgb(180,220,180)",Ka="#e31507",Xa="#FFA500",Za="#888",el=({name:t,averageReturn:e,selected:r,setWatchlists:n,notification:i,onNotificationClose:s,onRefresh:a,realStockCount:c,etfPriceData:u,twapData:p,inactiveTickers:d=0,navMetadata:h={},lastNavUpdate:C=null})=>{var Z;const{isInverted:k}=Ue(),f=ne(Ja);ne("black");const m=ne(Ka),S=ne(Xa),y=ne(Za),v=ne(Qa);l.debug("📊 WatchlistHeader received averageReturn:",e);const L=Number.isFinite(e)?e:null;L===null&&l.debug("⚠️ averageReturn is invalid:",e);const N=c||0,{slug:K}=Ft(),[se,J]=x.useState(!1),[z,R]=x.useState(null),[b,q]=x.useState(""),[D,M]=x.useState(null);x.useEffect(()=>{const O=()=>{const H=Le.getWatchlistRequestStatus(K);M(H)};O();const w=setInterval(O,1e3);return()=>clearInterval(w)},[K]),x.useEffect(()=>{const O=()=>{var U,E;const H=Le.getFetchStatus(K);if(H&&H.status==="active"){const V=(E=(U=Le.activeFetches)==null?void 0:U.get)==null?void 0:E.call(U,K);let I=null,te=null;V&&V.lastProgress&&(I=V.lastProgress.tickersFetched,te=V.lastProgress.totalTickers),R({tickersFetched:I,totalTickers:te}),J(!0)}else R(null),J(!1)};O();const w=setInterval(O,1e3);return()=>clearInterval(w)},[K]),x.useEffect(()=>{const O=Le.startFetch;return Le.startFetch=async function(w,H,U,E){return O.call(this,w,H,(V,I)=>{this.activeFetches&&this.activeFetches.get(w)&&(this.activeFetches.get(w).lastProgress=I),typeof U=="function"&&U(V,I)},E)},()=>{Le.startFetch=O}},[]);const re=async()=>{const O=Le.getFetchStatus(K);if(O&&O.status==="active"){Le.cancelFetch(K),q("Fetch cancelled"),setTimeout(()=>q(""),3e3);return}a&&typeof a=="function"?(console.log("🔄 Refresh requested from header - calling parent"),a()):console.log("🔄 Refresh requested from header - no parent handler")};return x.useEffect(()=>{if(t&&Array.isArray(t.items)){const O=t.items.filter(w=>w.type==="real");setRealStockCount(O.length),console.log("📊 Real stocks count:",O.length)}},[t]),o.jsxs("div",{style:{display:"flex",flexDirection:"column",width:"100%",position:"fixed",top:0,left:0,zIndex:1e4},children:[i&&o.jsx(Oe,{notification:i,handleNotificationClose:s}),b&&o.jsx(Oe,{notification:b,handleNotificationClose:()=>q("")}),o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1.5rem 2rem",background:"black",color:f,fontFamily:"'Courier New', Courier, monospace",width:"100%",borderBottom:`2px solid ${f}`},children:[o.jsx("div",{style:{display:"flex",alignItems:"center"},children:o.jsx("a",{href:"/",style:{display:"flex",alignItems:"center",textDecoration:"none",border:"none",background:"none",padding:"8px",gap:0,minHeight:"44px",borderRadius:"6px",transition:"all 0.2s ease",border:"1px solid transparent"},"aria-label":"back to home",onMouseEnter:O=>{O.target.style.border=`1px solid ${f}`,O.target.style.background="rgba(149,184,163,0.1)"},onMouseLeave:O=>{O.target.style.border="1px solid transparent",O.target.style.background="none"},children:o.jsx("img",{src:ho,alt:"back",style:{width:22,height:22,filter:k?"invert(1)":"none"}})})}),o.jsx("div",{style:{textAlign:"center",flex:1,maxWidth:"60%"},children:o.jsx("h1",{style:{margin:0,marginTop:"8px",fontSize:"2.2rem",whiteSpace:"nowrap",color:f,cursor:"pointer",textDecoration:"underline",textUnderlineOffset:"4px",transition:"all 0.2s ease",minHeight:"44px",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold"},onClick:re,title:se?"Cancel refresh":`Refresh watchlist | ${new Date().toLocaleString()} | Return: ${L!==null?(L>=0?"+":"")+L.toFixed(2)+"%":"N/A"}`,tabIndex:0,onKeyDown:O=>{(O.key==="Enter"||O.key===" ")&&re()},role:"button","aria-pressed":se,onMouseEnter:O=>{O.target.style.color=Ya},onMouseLeave:O=>{O.target.style.color=f},children:t||"Untitled Watchlist"})}),o.jsxs("div",{style:{textAlign:"right",paddingRight:"1rem",maxWidth:"30%"},children:[h&&Object.keys(h).length>0&&o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px",alignItems:"flex-end"},children:[o.jsxs("div",{style:{color:h.confidenceScore>=70?f:h.confidenceScore>=50?S:m,fontWeight:"bold",fontSize:"1rem",textShadow:"0 0 5px rgba(149,184,163,0.3)"},children:["NAV: ",((Z=h.confidenceScore)==null?void 0:Z.toFixed(0))||0,"% confidence"]}),o.jsxs("div",{style:{color:y,fontSize:"0.8rem",display:"flex",gap:"8px",alignItems:"center"},children:[o.jsxs("span",{children:[h.validTickers||0,"/",h.totalTickers||0," active"]}),d>0&&o.jsxs("span",{style:{color:m},children:["| ",d," inactive"]}),h.driftWarning&&o.jsx("span",{style:{color:S},children:"| ⚠ drift"}),h.isAnomaly&&o.jsx("span",{style:{color:m},children:"| ⚠ anomaly"})]}),C&&o.jsxs("div",{style:{color:v,fontSize:"0.7rem",fontStyle:"italic"},children:["Last NAV: ",new Date(C).toLocaleTimeString()]})]}),z&&D&&o.jsxs("div",{style:{marginTop:"0.5rem",fontSize:"0.8rem",color:D.current>0?S:y,cursor:D.current>0?"help":"default"},title:D.current>0?"API requests in progress - waiting 1 minute between batches":"",children:[D.current,"/",N," (",Math.round(D.current/N*100),"%)"]}),o.jsx("div",{style:{marginTop:"0.5rem",fontSize:"0.8rem"},children:z&&typeof z.tickersFetched=="number"&&typeof z.totalTickers=="number"&&o.jsxs("span",{style:{color:m,fontWeight:"bold"},children:[z.tickersFetched,"/",z.totalTickers]})})]})]})]})},tl="rgb(140,185,162)",rl=({selected:t,onChange:e})=>{const r=ne(tl),n=ne("black");return o.jsx("div",{style:{marginTop:10,marginBottom:10,display:"flex",gap:12,alignItems:"center",padding:"6px"},children:["D","W","M","YTD","MAX"].map(i=>o.jsx("button",{onClick:()=>{console.log("🎯 [TIMEFRAME SELECTOR] User clicked timeframe:",i),console.log("🎯 [TIMEFRAME SELECTOR] Previous timeframe was:",t),e(i),console.log("🎯 [TIMEFRAME SELECTOR] onChange called with:",i)},style:{backgroundColor:t===i?r:"transparent",color:t===i?n:r,border:`1px solid ${r}`,height:"32px",minHeight:"32px",maxHeight:"32px",width:"40px",fontFamily:"'Courier New', Courier, monospace",fontSize:"0.9rem",cursor:"pointer",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",boxSizing:"border-box",margin:0,padding:0},children:i},i))})},mt="rgb(149,184,163)",nl="rgb(239,68,68)",ol=({bulkSymbols:t,setBulkSymbols:e,handleBulkAdd:r,setNotification:n,setNotificationType:i})=>{const[s,a]=x.useState(!1),[c,u]=x.useState(""),[p,d]=x.useState(""),[h,C]=x.useState(!1),k=x.useRef(),f=ne("black"),m=()=>{if(!t.trim())return d(""),!1;const y=t.split(/[,	\s]+/).map(L=>L.trim().toUpperCase()).filter(Boolean);if(y.length===0)return d("Please enter valid ticker symbols."),!1;const v=y.filter(L=>!Or(L));return v.length>0?(d(`Invalid symbols: ${v.join(", ")}`),!1):(d(""),!0)};x.useEffect(()=>{p&&n&&i&&(n(p),i("error"))},[p,n,i]),x.useEffect(()=>(k.current&&clearTimeout(k.current),k.current=setTimeout(()=>{m()},300),()=>{k.current&&clearTimeout(k.current)}),[t,h]);const S=async()=>{if(C(!0),!!m()){a(!0),u("");try{const v=t.split(/[,\s]+/).map(N=>N.trim().toUpperCase()).filter(Boolean).filter(Or);if(console.log("📦 Adding Tickers:",t),console.log(`🔍 Processing ${v.length} valid symbols:`,v),v.length===0){n&&i&&(n("No valid tickers were entered"),i("error"));return}const L=v.map(N=>hr(N));if(console.log("📝 Normalized symbols:",L),r&&typeof r=="function")console.log("🧪 Calling handleBulkAdd with symbols:",L),await r(L);else{console.warn("⚠️ handleBulkAdd is not a function"),n&&i&&(n("Error: handleBulkAdd function not available"),i("error"));return}e("")}catch(y){console.error("❌ Error in handleAddTickers:",y),n&&i&&(n("Failed to add tickers. Please try again."),i("error"))}finally{a(!1)}}};return o.jsxs("div",{className:"mt-5 md:mt-4 sm:mt-3",children:[o.jsxs("div",{className:"flex items-center w-full gap-0",style:{height:"32px"},children:[o.jsx("textarea",{value:t,onChange:y=>e(y.target.value),placeholder:"e.g. SPY, QQQ",rows:1,className:"flex-1 font-mono text-sm bg-black border border-green-500 text-green-500 resize-none box-border cursor-pointer min-w-0",style:{fontFamily:"'Courier New', Courier, monospace",backgroundColor:f,border:`1px solid ${mt}`,color:mt,outline:"none",borderRight:"none",borderTopRightRadius:"0",borderBottomRightRadius:"0",height:"32px",padding:"0",fontSize:"14px",lineHeight:"32px",margin:"0",boxSizing:"border-box"},onKeyDown:y=>{y.key==="Enter"&&!y.shiftKey&&(y.preventDefault(),S())}}),o.jsx(Ce,{onClick:S,disabled:s||!t.trim(),loading:s,style:{minWidth:"60px",height:"32px",fontSize:"14px",fontFamily:"'Courier New', monospace",backgroundColor:"transparent",color:mt,border:`1px solid ${mt}`,borderLeft:"none",borderTopLeftRadius:"0",borderBottomLeftRadius:"0",cursor:s||!t.trim()?"not-allowed":"pointer",opacity:s||!t.trim()?.5:1,display:"flex",alignItems:"center",justifyContent:"center",padding:"0",margin:"0",boxSizing:"border-box"},onMouseEnter:y=>{!s&&t.trim()&&(y.target.style.background=mt,y.target.style.color="black")},onMouseLeave:y=>{y.target.style.background="transparent",y.target.style.color=mt},children:s?"...":"+++"})]}),c&&o.jsx("div",{style:{color:nl,fontSize:"12px",marginTop:"8px",fontFamily:"'Courier New', monospace"},children:c})]})},il="rgb(149,184,163)",sl="#e31507",al="#FFD700",ll="#FFA500",cl=({watchlistSlug:t,timeframe:e="MAX"})=>{const r=ne(il),n=ne(sl),i=ne(al),s=ne(ll),a=ne("#888"),[c,u]=x.useState(null),[p,d]=x.useState(!1),[h,C]=x.useState(null),[k,f]=x.useState(null),[m,S]=x.useState(0),[y,v]=x.useState(!1);x.useEffect(()=>{if(!t)return;l.debug(`[REAL-TIME NAV STATUS] Subscribing to updates for ${t}`);const J=pt.subscribe(t,(b,q)=>{l.debug(`[REAL-TIME NAV STATUS] Received update for ${t}`,q),u(new Date(q.timestamp)),C(q.source),d(!1)}),z=setInterval(()=>{const b=xt.getStatus();f(b.nextBoundaryTime),S(b.timeUntilNextBoundary),v(b.isNearBoundary)},1e3),R=setInterval(()=>{const b=pt.isDataStale(t);d(b)},1e4);return()=>{J(),clearInterval(z),clearInterval(R)}},[t]);const L=()=>{if(m<=0)return"Now";const J=Math.floor(m/6e4),z=Math.floor(m%6e4/1e3);return J>0?`${J}m ${z}s`:`${z}s`},N=()=>{if(!c)return"No data";const z=new Date().getTime()-c.getTime(),R=Math.floor(z/(1e3*60));return R<1?`${Math.floor(z/1e3)}s ago`:R<60?`${R}m ago`:`${Math.floor(R/60)}h ago`},K=()=>c?p?n:h==="realtime"?r:h==="aligned"?s:a:a,se=()=>y?i:a;return o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px",fontSize:"10px",fontFamily:"Courier New",color:a,padding:"4px 8px",backgroundColor:"rgba(0,0,0,0.1)",borderRadius:"4px",border:`1px solid ${a}20`},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsx("span",{children:"Last Update:"}),o.jsxs("span",{style:{color:K(),opacity:p?.6:1,transition:"opacity 0.3s ease"},children:[N(),h&&` (${h})`]})]}),o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsx("span",{children:"Next 5-min:"}),o.jsx("span",{style:{color:se(),fontWeight:y?"bold":"normal"},children:L()})]}),o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsx("span",{children:"Status:"}),o.jsx("span",{style:{color:K(),fontSize:"9px",textTransform:"uppercase"},children:c?p?"Stale":h==="realtime"?"Live":h==="aligned"?"Aligned":"Updated":"No Data"})]})]})},yt="rgb(149,184,163)",dl=()=>{const{slug:t}=Ft();He(),Xe();const[e,r]=x.useState("W");x.useEffect(()=>{l.log("🎯 [BURN PAGE] selectedTimeframe changed to:",e)},[e]);const[n,i]=x.useState(null),[s,a]=x.useState({}),[c,u]=x.useState(""),[p,d]=x.useState(null),[h,C]=x.useState(null),[k,f]=x.useState(!1),{notification:m,notificationType:S,setNotification:y,setNotificationType:v}=rt(),[L,N]=x.useState(!1),{isInverted:K}=Ue(),[se,J]=x.useState(null);x.useEffect(()=>{var P,A;if(l.log(`🔍 [TIMEFRAME CHANGE DEBUG] selectedTimeframe changed to: ${e}`),l.log(`🔍 [TIMEFRAME CHANGE DEBUG] watchlist items count: ${((P=n==null?void 0:n.items)==null?void 0:P.length)||0}`),n!=null&&n.items&&n.items.length>0){l.log(`🔍 [TIMEFRAME CHANGE DEBUG] First item: ${n.items[0].symbol}`),l.log(`🔍 [TIMEFRAME CHANGE DEBUG] Historical data points: ${((A=n.items[0].historicalData)==null?void 0:A.length)||0}`);try{const T=n.items[0];l.log(`🔍 [TIMEFRAME CHANGE DEBUG] First item: ${T.symbol}`)}catch(T){l.error("🔍 [TIMEFRAME CHANGE DEBUG] Error testing first item:",T)}e==="D"&&(l.log("🔍 [D TIMEFRAME DEBUG] Testing D timeframe data availability..."),l.log(`🔍 [D TIMEFRAME DEBUG] Watchlist items: ${n.items.length}`),n.items.forEach((T,$)=>{var W;if(l.log(`🔍 [D TIMEFRAME DEBUG] Item ${$}: ${T.symbol}`),l.log(`🔍 [D TIMEFRAME DEBUG]   - Historical data points: ${((W=T.historicalData)==null?void 0:W.length)||0}`),T.historicalData&&T.historicalData.length>0){const Q=T.historicalData[0],_=T.historicalData[T.historicalData.length-1];l.log(`🔍 [D TIMEFRAME DEBUG]   - First point: ${Q.timestamp} @ $${Q.price}`),l.log(`🔍 [D TIMEFRAME DEBUG]   - Last point: ${_.timestamp} @ $${_.price}`);const he=new Date().getTime()-24*60*60*1e3,me=T.historicalData.filter(de=>new Date(de.timestamp).getTime()>=he);l.log(`🔍 [D TIMEFRAME DEBUG]   - Points from last 24h: ${me.length}`)}}))}},[e,n]);const z=x.useMemo(()=>{if(!(n!=null&&n.items)||n.items.length===0)return 0;try{let P=0,A=0;n.items.forEach($=>{try{const W=$.historicalData&&$.historicalData.length>0?$.historicalData[$.historicalData.length-1].price:0,Q=$.currentPrice||($.historicalData&&$.historicalData.length>0?$.historicalData[0].price:0);if(W>0&&Q>0){const _=(Q-W)/W*100;P+=_,A++}}catch(W){l.error(`Error calculating return for ${$.symbol}:`,W)}});const T=A>0?P/A:0;return l.log(`🔍 [BURN PAGE NAV DEBUG] Average return: ${T.toFixed(2)}%`),T}catch(P){return l.error("Error calculating average return:",P),0}},[n==null?void 0:n.items,e]),R=uo((n==null?void 0:n.items)||[],e),b=po((n==null?void 0:n.items)||[]);go((n==null?void 0:n.items)||[],e);const q=x.useMemo(()=>{var A,T,$;const P=((A=n==null?void 0:n.items)==null?void 0:A.map(W=>({symbol:W.symbol,buyDate:W.buyDate,buyPrice:W.buyPrice,historicalData:W.historicalData,timeframe:e})))||[];if(l.debug(`[PORTFOLIO DATA DEBUG] Timeframe: ${e}`),l.debug(`  - Watchlist items: ${((T=n==null?void 0:n.items)==null?void 0:T.length)||0}`),l.debug(`  - Portfolio data entries: ${P.length}`),P.length>0){const W=P[0];l.debug(`  - First item: ${W.symbol}`),l.debug(`  - Historical data points: ${(($=W.historicalData)==null?void 0:$.length)||0}`),l.debug(`  - Buy price: $${W.buyPrice}`),l.debug(`  - Buy date: ${W.buyDate}`)}return P},[n==null?void 0:n.items,e]),D=Array.isArray(n==null?void 0:n.items)?n.items.filter(P=>P.type==="real").length:0;x.useEffect(()=>{const P=()=>{const T=Date.now(),$=3*60*1e3,Q=T%$,_=$-Q,ie=Math.floor(_/(1e3*60)),he=Math.floor(_%(1e3*60)/1e3);J(`${ie}:${he.toString().padStart(2,"0")}`)};P();const A=setInterval(P,1e3);return()=>clearInterval(A)},[]),x.useEffect(()=>{(async()=>{var A;if(l.debug("Starting initializeFetching..."),l.debug("watchlist:",n),l.debug("slug:",t),await Le.initialize(),l.debug("fetchManager initialized"),n&&Array.isArray(n.items)&&n.items.length>0&&t){const T=n.items.map(_=>_.symbol);l.debug("About to register tickers:",T);const{default:$}=await jt(()=>Promise.resolve().then(()=>Es),void 0);$.registerActiveBurnlist(t,T),l.debug(`Successfully registered ${t} as active burnlist with ${T.length} tickers: ${T.join(", ")}`);const W=$.getActiveBurnlists(),Q=$.getAllUniqueTickers();console.log("🔧 DEBUG: Active burnlists:",W),console.log("🔧 DEBUG: All unique tickers:",Q)}else console.log("🔧 DEBUG: Not registering - conditions not met"),console.log("🔧 DEBUG: watchlist exists:",!!n),console.log("🔧 DEBUG: items is array:",Array.isArray(n==null?void 0:n.items)),console.log("🔧 DEBUG: items length:",(A=n==null?void 0:n.items)==null?void 0:A.length),console.log("🔧 DEBUG: slug exists:",!!t)})()},[n,t]);const M=x.useRef(null),re=async(P=!1,A=!1)=>{if(!n||!Array.isArray(n.items))return;P&&l.fetch(`Watchlist data fetch for ${t}`,`${n.items.length} items, manual: ${P}, bypass: ${A}`);const T=await Le.startFetch(t,n.items,($,W)=>{const Q={...n,items:$},_=Object.keys(s).find(ie=>s[ie].slug===t);if(_){const ie={...s,[_]:Q};H(ie)}},P,A,e);T.success?localStorage.setItem(`burnlist_last_refresh_${t}`,new Date().toISOString()):T.message&&(y(T.message),v("info"))},Z=Le.getFetchStatus(t);Z&&Z.status,x.useEffect(()=>{if(!t)return;l.debug(`[BURN PAGE] Subscribing to real-time NAV updates for ${t}`);const P=pt.subscribe(t,(A,T)=>{l.debug(`[BURN PAGE] Received NAV update for ${t}`,T),i($=>$&&{...$,lastUpdate:T.timestamp})});return()=>{P()}},[t]);const O=async()=>{if(!(!n||!n.items||n.items.length===0))try{l.debug(`[BURN PAGE] Triggering immediate NAV calculation for ${t}`),await xt.triggerImmediateCalculation(t,n.items,e)}catch(P){l.error("[BURN PAGE] Error triggering immediate NAV calculation:",P)}},w=async()=>{if(!k)try{f(!0),y("Refreshing data...","loading");const P=await re(!0,!0);P.success?(y("Manual refresh allowed outside market hours","info"),l.fetch(`Manual refresh for ${t}`,"bypassing market hours check"),await O()):y(P.message||"Refresh failed","error")}catch(P){console.error("Manual refresh error:",P),y("Refresh failed","error")}finally{f(!1)}};x.useEffect(()=>{const P=()=>{var T,$;try{const W=localStorage.getItem("burnlist_watchlists");if(W)try{const Q=JSON.parse(W);a(Q);const _=Object.values(Q).find(ie=>ie.slug===t);_&&(_.items=(T=_.items)==null?void 0:T.map(Wr),_.items=($=_.items)==null?void 0:$.filter(ie=>{const he=ie&&Number(ie.buyPrice)>0&&Array.isArray(ie.historicalData);return he||l.warn("🧨 Invalid item detected during hydration:",ie),he})),i(_||null),console.log("📊 DEBUG: Loaded/reloaded watchlist data")}catch{localStorage.removeItem("burnlist_watchlists"),i(null)}}catch{i(null)}};P();const A=T=>{console.log("🔧 DEBUG: Storage event received:",T.key),T.key==="burnlist_watchlists"&&(console.log("🔄 DEBUG: Storage event received, reloading watchlist data"),P())};return window.addEventListener("storage",A),()=>{window.removeEventListener("storage",A)}},[t]),x.useEffect(()=>{if(!(!n||!Array.isArray(n.items)))return()=>{M.current&&clearInterval(M.current)}},[n,t]),x.useEffect(()=>()=>{Le.pauseFetch(t)},[t]),x.useEffect(()=>{f(!0);const P=setTimeout(()=>f(!1),350);return()=>clearTimeout(P)},[e,n]);const H=P=>{if(!(!P||typeof P!="object"||Array.isArray(P)))try{const A=Object.values(P).find($=>$.slug===t);A&&i(A);const T=JSON.stringify(P);localStorage.setItem("burnlist_watchlists",T),a(P)}catch{}},U=(P,A)=>{i(T=>{if(!T||!Array.isArray(T.items))return T;const $=T.items.map((Q,_)=>_===P?{...Q,buyPrice:A}:Q),W={...T,items:$};return a(Q=>{const _=Object.keys(Q).find(he=>Q[he].slug===t);if(!_)return Q;const ie={...Q,[_]:W};return localStorage.setItem("burnlist_watchlists",JSON.stringify(ie)),ie}),W})},E=P=>{let A,T;return P<=7?(A="5min",T=Math.min(250,P*78)):P<=30?(A="15min",T=250):P<=90?(A="1h",T=250):P<=365?(A="1day",T=Math.min(250,P)):(A="1week",T=Math.min(250,Math.ceil(P/7))),l.log(`📊 Requesting exactly ${T} data points for ${P} days using ${A} intervals`),{interval:A,outputSize:T}},V=async(P,A)=>{console.log("🚨 [FIND TRADING DAY] Starting for",P,"date:",A);const{fetchHistoricalData:T}=await jt(()=>Promise.resolve().then(()=>er),void 0);console.log(`🔍 [HISTORICAL FETCH] Checking if ${A} is a trading day for ${P}`),console.log("🔍 [HISTORICAL FETCH] Using direct twelvedataAdapter - no market hours validation");for(let $=0;$<=7;$++){const W=new Date(A);W.setDate(W.getDate()-$);const Q=W.toISOString().slice(0,10);try{console.log(`🔍 [FALLBACK] Day ${$}: Trying exact date ${Q}...`);const _=await T(P,Q,null,"1day");if(_&&_.historicalData&&_.historicalData.length>0){const ie=_.historicalData[0];console.log(`💰 [FALLBACK] Found price data for ${Q}: $${ie.price}`),console.log($===0?`✅ Found data for user's exact date: ${Q}`:`✅ Found nearest trading day: ${Q} (${$} day${$>1?"s":""} before user's date)`);const he={actualDate:Q,fallbackDays:$,price:ie.price};return console.log("🚨 [FIND TRADING DAY] Returning result:",he),he}}catch(_){console.log(`⏭️ ${Q} - no market data available:`,_.message)}}throw new Error(`No valid market data found near selected buy date. Please choose an earlier date (tried ${A} and 7 days prior).`)},I=async P=>{var T;const A=(T=n==null?void 0:n.items)==null?void 0:T[P];if(!A||!A.symbol||!A.buyDate){l.warn("⚠️ Cannot fetch historical data: missing ticker, symbol, or buy date"),y("Cannot fetch historical data: missing required information"),v("warning");return}l.fetch(`Manual historical data fetch for ${A.symbol}`,`from ${A.buyDate}`),await oe(P,A.buyDate.slice(0,10))},te=async P=>{var W,Q,_;const A=(W=n==null?void 0:n.items)==null?void 0:W[P];if(!A||!A.symbol){l.warn("⚠️ Cannot revert buy date: missing ticker or symbol");return}const T=((Q=A.buyDateMetadata)==null?void 0:Q.originalBuyDate)||A.addedAt,$=(_=A.buyDateMetadata)==null?void 0:_.originalBuyPrice;if(!T){y(`No original buy date found for ${A.symbol}`),v("warning");return}l.log(`🔄 Reverting ${A.symbol} to original buy date: ${T}`),i(ie=>{if(!ie||!Array.isArray(ie.items))return ie;const he=ie.items.map((de,ce)=>ce===P?{...de,buyDate:T,buyPrice:$||de.buyPrice,buyDateMetadata:void 0}:de),me={...ie,items:he};return a(de=>{const ce=Object.keys(de).find(ye=>de[ye].slug===t);if(!ce)return de;const ge={...de,[ce]:me};return localStorage.setItem("burnlist_watchlists",JSON.stringify(ge)),ge}),me}),y(`Reverted ${A.symbol} to original buy date: ${T}`),v("success")},oe=async(P,A)=>{var ie,he,me,de,ce,ge,ye,pe;if(console.log("🚨 [BUY DATE CHANGE TRIGGERED]",{index:P,newDate:A}),A==="REVERT_TO_ORIGINAL"){await te(P);return}const T=new Date().toISOString().slice(0,10);if(A>T){y("Buy date cannot be in the future"),v("warning");return}const $=(ie=n==null?void 0:n.items)==null?void 0:ie[P];if(!$||!$.symbol){l.warn("⚠️ Cannot change buy date: missing ticker or symbol");return}console.log("🚨 [CURRENT TICKER STATE]",{symbol:$.symbol,currentBuyPrice:$.buyPrice,currentBuyDate:$.buyDate,currentPrice:$.currentPrice,historicalDataLength:(he=$.historicalData)==null?void 0:he.length});const W=$.buyDate,Q=$.buyPrice,_=$.historicalData;l.log(`📅 [BUY DATE CHANGE] Starting: ${$.symbol} from ${W} to ${A}`),l.log("📅 [BUY DATE CHANGE] This should bypass all market hours validation"),f(!0),y(`Fetching historical data for ${$.symbol}...`),v("info");try{const{fetchHistoricalData:fe}=await jt(()=>Promise.resolve().then(()=>er),void 0),we=new Date(A),We=Math.floor((new Date-we)/(1e3*60*60*24));if(We>3650)throw new Error("Buy date is too far in the past. Most assets may not have data from that period.");l.log(`🔍 Step 1: Finding actual trading day for ${A}`);const ke=await V($.symbol,A),Ae=ke.actualDate,Ge=ke.price;l.log(`🔍 [TRADING DAY RESULT] for ${$.symbol}:`),l.log(`  - Requested date: ${A}`),l.log(`  - Actual trading date: ${Ae}`),l.log(`  - Buy price from that date: $${Ge}`),l.log(`  - Fallback days: ${ke.fallbackDays}`),ke.fallbackDays>0&&l.log(`📅 Using fallback trading day: ${Ae} (${ke.fallbackDays} days before ${A})`);const{interval:nt,outputSize:gt}=E(We);l.log(`📡 [HISTORICAL FETCH] Step 2: Fetching time series data from ${Ae} with interval=${nt}, outputSize=${gt}`),l.log("📡 [HISTORICAL FETCH] Using direct twelvedataAdapter - bypassing ALL market validation");let Ze;try{const g=new Date,B=g.getDay();B===0?g.setDate(g.getDate()-2):B===6&&g.setDate(g.getDate()-1);const G=g.toISOString().split("T")[0];Ze=await fe($.symbol,Ae,G,nt,gt),l.log(`✅ [HISTORICAL FETCH] API call successful - requested exactly ${gt} points with ${nt} interval from ${Ae} to ${G}`)}catch(g){l.warn(`⚠️ [HISTORICAL FETCH] API call failed with ${nt}, trying with 1day fallback:`,g);const B=new Date,G=B.getDay();G===0?B.setDate(B.getDate()-2):G===6&&B.setDate(B.getDate()-1);const X=B.toISOString().split("T")[0];Ze=await fe($.symbol,Ae,X,"1day",Math.min(We,100))}if(!Ze||!Ze.historicalData||Ze.historicalData.length===0)throw new Error(`No historical data found for ${$.symbol} from ${Ae}. This date may predate the asset's trading history.`);let Te=Ze.historicalData;if(l.log(`📊 Received exactly ${Te.length} data points as requested (target was ${gt})`),Te.length>0){const g=Te[0],B=Te[Te.length-1];l.log(`📅 API Data Range: ${g.timestamp} → ${B.timestamp}`);const G=[...Te.slice(0,3),...Te.length>6?["..."]:[],...Te.slice(-3)];l.log("📊 Sample timestamps:",G.map(X=>X==="..."?"...":`${X.timestamp} ($${X.price})`))}l.log(`📊 Received ${Ze.historicalData.length} points, using ${Te.length} for chart`),l.log(`🔧 Creating unified time-series for ${$.symbol}`),l.log(`📊 Fetched historical data: ${Te.length} points from ${Ae} to present`),l.log(`📊 Existing live data: ${((me=$.historicalData)==null?void 0:me.length)||0} points`);let Ee=[...Te];if($.historicalData&&$.historicalData.length>0){const g=$.historicalData,B=new Date((de=Te[Te.length-1])==null?void 0:de.timestamp).getTime(),G=g.filter(X=>new Date(X.timestamp).getTime()>B);G.length>0&&(Ee=[...Te,...G],l.log(`🔗 Merged ${G.length} live data points with historical data`))}Ee.sort((g,B)=>new Date(g.timestamp)-new Date(B.timestamp)),l.log(`✅ Unified time-series created: ${Ee.length} total points`),l.log(`📅 Timeline: ${(ce=Ee[0])==null?void 0:ce.timestamp} → ${(ge=Ee[Ee.length-1])==null?void 0:ge.timestamp}`);const ht=Ee.length>0?Ee[Ee.length-1].price:$.currentPrice;l.log(`💰 [BUY DATE CHANGE] Price Summary for ${$.symbol}:`),l.log(`  - Original buy price: $${Q}`),l.log(`  - New buy price: $${Ge}`),l.log(`  - Original current price: $${$.currentPrice}`),l.log(`  - New current price: $${ht}`),l.log(`  - Historical data points: ${Ee.length}`);const at={...$,buyDate:Ae,buyPrice:Ge,currentPrice:ht,historicalData:Ee,buyDateMetadata:{originalUserDate:A,actualTradingDate:Ae,fallbackDays:ke.fallbackDays,originalBuyDate:W,originalBuyPrice:Q,dataFetchedAt:new Date().toISOString(),dataPoints:Ee.length,interval:nt,mergedLiveData:((ye=$.historicalData)==null?void 0:ye.length)||0}};console.log("🚨 [ABOUT TO UPDATE STATE]",{newBuyPrice:Ge,newBuyDate:Ae,newCurrentPrice:ht,historicalDataLength:Ee.length}),i(g=>{if(!g||!Array.isArray(g.items))return g;const B=g.items.map((X,ae)=>ae===P?at:X),G={...g,items:B};return a(X=>{const ae=Object.keys(X).find(Ne=>X[Ne].slug===t);if(!ae)return X;const xe={...X,[ae]:G};return localStorage.setItem("burnlist_watchlists",JSON.stringify(xe)),xe}),console.log("🚨 [STATE UPDATED]",{updatedTicker:at,newBuyPrice:at.buyPrice,newCurrentPrice:at.currentPrice}),G});let et;ke.fallbackDays===0?et=`✅ Updated ${$.symbol}: buy date ${Ae}, buy price $${Ge.toFixed(2)}`:et=`✅ Updated ${$.symbol}: buy date ${Ae} (${ke.fallbackDays} day${ke.fallbackDays>1?"s":""} before your selected date), buy price $${Ge.toFixed(2)}`;const At=((pe=$.historicalData)==null?void 0:pe.length)||0;At>0?et+=`, unified ${Ee.length} total datapoints (${Te.length} historical + ${At} existing live)`:et+=`, ${Te.length} historical datapoints`,l.log(`✅ ${et}`),y(et),v("success")}catch(fe){l.error(`❌ Error changing buy date for ${$.symbol}:`,fe),i(we=>{if(!we||!Array.isArray(we.items))return we;const qe=we.items.map((We,ke)=>ke===P?{...We,buyDate:W,buyPrice:Q,historicalData:_}:We);return{...we,items:qe}}),y(`Failed to update buy date for ${$.symbol}: ${fe.message}`),v("error")}finally{f(!1)}},F=async P=>{if(!n||!Array.isArray(n.items))return;const A=n.items[P];if(!A||!A.symbol||!A.buyDate){l.warn("⚠️ Cannot refresh: missing symbol or buy date");return}try{l.fetch(`Price refresh for ${A.symbol}`,`buy date: ${A.buyDate}`),l.log(`📡 Fetching historical data for ${A.symbol} from Twelve Data...`);const{fetchHistoricalData:T}=await jt(()=>Promise.resolve().then(()=>er),void 0),$=new Date(A.buyDate),W=new Date,Q=Math.floor((W-$)/(1e3*60*60*24));let _=[];if(Q<=50){l.log(`📅 Buy date is ${Q} days ago, fetching daily data for entire period`),l.log(`🔍 API Call: ${A.symbol} from ${A.buyDate} to ${W.toISOString()} (1day)`);const ge=await T(A.symbol,A.buyDate,W.toISOString(),"1day");l.log("📥 Daily data result:",ge),ge&&ge.historicalData&&(_=ge.historicalData)}else{l.log(`📅 Buy date is ${Q} days ago, fetching weekly + daily data`);const ge=new Date(W.getTime()-50*24*60*60*1e3);l.log(`📅 Cutoff date: ${ge.toISOString()}`),l.log(`🔍 Weekly API Call: ${A.symbol} from ${A.buyDate} to ${ge.toISOString()} (1week)`);const ye=await T(A.symbol,A.buyDate,ge.toISOString(),"1week");l.log("📥 Weekly data result:",ye),l.log(`🔍 Daily API Call: ${A.symbol} from ${ge.toISOString()} to ${W.toISOString()} (1day)`);const pe=await T(A.symbol,ge.toISOString(),W.toISOString(),"1day");l.log("📥 Daily data result:",pe),ye&&ye.historicalData&&(_=[...ye.historicalData],l.log(`📊 Added ${ye.historicalData.length} weekly data points`)),pe&&pe.historicalData&&(_=[..._,...pe.historicalData],l.log(`📊 Added ${pe.historicalData.length} daily data points`))}if(l.log(`📊 Total historical data points: ${_.length}`),_.length===0){l.warn(`⚠️ No historical data found for ${A.symbol}`),l.error("❌ Debug info:",{symbol:A.symbol,buyDate:A.buyDate,daysDiff:Q,interval:Q<=50?"1day":"1week+1day"}),y(`No historical data found for ${A.symbol}`,"error");return}let ie=null,he=null,me=1/0;l.log(`🔍 Looking for price on ${$.toISOString().split("T")[0]} for ${A.symbol}`),l.log(`📊 Historical data points: ${_.length}`);for(const ge of _){const ye=new Date(ge.timestamp),pe=$.toISOString().split("T")[0],fe=ye.toISOString().split("T")[0];if(l.log(`🔍 Comparing: ${fe} vs ${pe}`),fe===pe){ie=ge.price,he=ge.timestamp,l.log(`✅ Found exact date match for ${A.symbol}: ${ie} at ${he}`);break}const we=Math.abs(ye.getTime()-$.getTime());we<me&&(me=we,ie=ge.price,he=ge.timestamp,l.log(`📌 Closest match so far: ${ie} at ${he} (diff: ${we}ms)`))}if(ie===null){l.warn(`⚠️ No historical price found for ${A.symbol} at ${A.buyDate}`),y(`No historical price found for ${A.symbol} at ${A.buyDate}`,"error");return}const de=$.toISOString().split("T")[0],ce=new Date(he).toISOString().split("T")[0];de!==ce&&(l.log(`⚠️ No exact date match found for ${A.symbol}`),l.log(`📅 Buy date: ${de}, Closest available: ${ce}`),l.log(`💰 Using closest price: ${ie} (from ${he})`),y(`Using closest available price for ${A.symbol} (${ce})`,"info")),l.log(`📊 Updating ${A.symbol} buy price from ${A.buyPrice} to ${ie} (date: ${he})`),l.log(`💾 Saving ${_.length} historical data points for ${A.symbol}`),l.log("📊 First data point:",_[0]),l.log("📊 Last data point:",_[_.length-1]),i(ge=>{if(!ge||!Array.isArray(ge.items))return ge;const ye=ge.items.map((fe,we)=>we===P?{...fe,buyPrice:ie,historicalData:_}:fe),pe={...ge,items:ye};return l.log(`✅ Updated watchlist item for ${A.symbol}:`,ye[P]),l.log("📊 Historical data length after update:",ye[P].historicalData.length),a(fe=>{const we=Object.keys(fe).find(Ge=>fe[Ge].slug===t);if(!we)return fe;const qe={...fe,[we]:pe};l.log(`💾 Saving to localStorage with key: ${we}`),l.log("📊 Updated watchlist items count:",pe.items.length),localStorage.setItem("burnlist_watchlists",JSON.stringify(qe));const We=localStorage.getItem("burnlist_watchlists"),Ae=JSON.parse(We)[we].items[P];return l.log("✅ Verification - Saved historical data length:",Ae.historicalData.length),qe}),pe}),y(`Updated ${A.symbol} buy price to $${ie.toFixed(2)}`,"success")}catch(T){l.error(`❌ Error refreshing price for ${A.symbol}:`,T),y(`Failed to refresh price for ${A.symbol}`,"error")}},Y=P=>{i(A=>{if(!A||!Array.isArray(A.items))return A;const T=A.items.filter((W,Q)=>Q!==P),$={...A,items:T};return a(W=>{const Q=Object.keys(W).find(ie=>W[ie].slug===t);if(!Q)return W;const _={...W,[Q]:$};return localStorage.setItem("burnlist_watchlists",JSON.stringify(_)),_}),$})};return n?o.jsxs("div",{style:{backgroundColor:K?"rgb(140,185,162)":"transparent",minHeight:"100vh",color:K?"#000000":"#ffffff",padding:"0",paddingBottom:"80px"},children:[o.jsx(tt,{}),R&&R.averagePrice>0&&o.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,zIndex:10002,backgroundColor:"rgba(0,0,0,0.9)",borderBottom:`2px solid ${yt}`,padding:"8px 20px"},children:o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"15px",fontFamily:"'Courier New', monospace",fontSize:"14px",color:yt},children:[o.jsxs("div",{style:{fontWeight:"bold"},children:["ETF Price: $",R.averagePrice.toFixed(2)]}),o.jsxs("div",{style:{color:yt,fontWeight:"bold"},children:["Next Fetch: ",se||"–:–"]}),o.jsxs("div",{style:{color:"#888"},children:[Number.isFinite(z)?`${z.toFixed(2)}%`:"–%"," (",(e==null?void 0:e.toUpperCase())||"N/A",")"]}),o.jsxs("div",{style:{color:z>=0?yt:"#e31507",fontWeight:"bold"},children:["P&L: $",R.totalGainLoss.toFixed(2)," (",z.toFixed(2),"%)"]})]})}),m&&o.jsx("div",{style:{position:"fixed",top:R&&R.averagePrice>0?60:24,left:0,right:0,zIndex:10001,display:"flex",justifyContent:"center",pointerEvents:"none"},children:o.jsx("div",{style:{minWidth:320,maxWidth:480,pointerEvents:"auto"},children:o.jsx(Oe,{message:m,type:S,onClose:()=>y("")})})}),o.jsx("div",{style:{padding:"20px 20px 0 20px",marginBottom:"50px",marginTop:R&&R.averagePrice>0?"50px":"0px"},children:o.jsx(el,{name:n.name,averageReturn:z,selected:e,notification:k?"Calculating returns and updating chart...":null,onNotificationClose:()=>f(!1),onRefresh:w,realStockCount:D,etfPriceData:R,twapData:b})}),o.jsxs("div",{style:{padding:"5px 20px 10px 20px"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px",flexWrap:"wrap",gap:"8px"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[o.jsx(rl,{selected:e,onChange:r}),o.jsx(lo,{editMode:L,setEditMode:N}),o.jsx("button",{onClick:w,disabled:k,style:{background:"transparent",color:yt,border:`1px solid ${yt}`,padding:"4px 8px",fontSize:"10px",fontFamily:"'Courier New'",cursor:k?"not-allowed":"pointer",opacity:k?.5:1},children:k?"Refreshing...":"Refresh"})]}),o.jsx(cl,{watchlistSlug:t,timeframe:e})]}),o.jsx(co,{height:505,style:{},children:o.jsx(zr,{portfolioReturnData:q,watchlistSlug:t,timeframe:e,showBacktestLine:!1,height:500,suppressEmptyMessage:!0})}),Array.isArray(n.items)&&n.items.length>0?o.jsx(ao,{items:n.items,selectedTimeframe:e,editMode:L,handleBuyPriceChange:U,handleBuyDateChange:oe,handleRevertBuyDate:te,handleFetchHistoricalData:I,handleDelete:Y,handleRefreshPrice:F}):null,(!Array.isArray(n.items)||n.items.length===0)&&o.jsx("div",{style:{fontFamily:"'Courier New', monospace",color:"#999",textAlign:"center",marginTop:"20px"},children:"⚠️ No valid data to display yet."}),o.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:"30px"},children:o.jsx(ol,{watchlists:s,setWatchlists:H,currentSlug:t,bulkSymbols:c,setBulkSymbols:u,buyPrice:p,setBuyPrice:d,buyDate:h,setBuyDate:C,setNotification:y,setNotificationType:v,handleBulkAdd:async P=>{if(!(!P||P.length===0))try{const A=localStorage.getItem("burnlist_watchlists");if(!A||A==="undefined")return;const T=JSON.parse(A),$=t,W=Object.values(T).find(ce=>ce.slug===$);if(!W||!Array.isArray(W.items))return;const Q=P.filter(ce=>ce&&ce.symbol&&typeof ce.symbol=="string"&&Array.isArray(ce.historicalData)),_=new Set((W.items||[]).map(ce=>ce.symbol)),he=Q.filter(ce=>!_.has(ce.symbol)).filter(ce=>Array.isArray(ce.historicalData)&&ce.historicalData.length>0);W.items.push(...he);const me={...T},de=Object.keys(me).find(ce=>me[ce].slug===$);if(de)me[de]=W;else return;localStorage.setItem("burnlist_watchlists",JSON.stringify(me)),a(me)}catch{}}})})]})]}):o.jsx("div",{style:{backgroundColor:K?"rgb(140,185,162)":"#000000",color:K?"#000000":"#ffffff",padding:"20px"},children:o.jsx("h2",{style:{color:"#e31507",fontFamily:"'Courier New', monospace"},children:"⚠️ Watchlist not found."})})},ul="rgb(140,185,162)",pl=()=>{const t=Xe(),e=ne(ul),r=ne("black"),n=[{path:"/universes",label:"UNIVERSE"},{path:"/journal",label:"DASHBOARD"},{path:"/market",label:"MARKET"},{path:"/screeners",label:"SCREENERS"},{path:"/",label:"GRAPH VIEW"}];return o.jsxs(o.Fragment,{children:[o.jsx("style",{children:`
          .mobile-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: ${r};
            border-top: 1px solid ${e};
            padding: 12px 16px;
            z-index: 1000;
            display: flex;
            justify-content: space-around;
            align-items: center;
            gap: 8px;
          }
          
          @media (min-width: 769px) {
            .mobile-nav {
              display: none !important;
            }
          }
          
          .mobile-nav-button {
            background: ${r};
            color: ${e};
            border: 1px solid ${e};
            padding: 8px 12px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            font-weight: bold;
            text-decoration: none;
            text-align: center;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
          }
          
          .mobile-nav-button:active {
            background: ${e};
            color: ${r};
          }
          
          @media (max-width: 480px) {
            .mobile-nav {
              padding: 8px 12px;
              gap: 6px;
            }
            .mobile-nav-button {
              font-size: 10px;
              padding: 6px 8px;
              letter-spacing: 0.3px;
            }
          }
        `}),o.jsx("div",{className:"mobile-nav",children:n.map(i=>{const s=t.pathname===i.path;return o.jsx(Mt,{to:i.path,className:"mobile-nav-button",style:{backgroundColor:s?e:r,color:s?r:e},children:i.label},i.path)})})]})};function gl(){const[t,e]=x.useState(()=>{const r=De.getWatchlists();return l.info("💾 Loaded watchlists from storage:",r),r});return x.useEffect(()=>{l.info("💾 Saving watchlists to storage:",t),De.setWatchlists(t)},[t]),x.useEffect(()=>()=>{Le.cleanup()},[]),o.jsx(Fo,{children:o.jsxs(bo,{children:[o.jsxs(So,{children:[o.jsx(Je,{path:"/",element:o.jsx(_s,{watchlists:t,setWatchlists:e})}),o.jsx(Je,{path:"/watchlist/:slug",element:o.jsx(ia,{watchlists:t,setWatchlists:e})}),o.jsx(Je,{path:"/universes",element:o.jsx(Aa,{})}),o.jsx(Je,{path:"/universe/:slug",element:o.jsx(Ca,{})}),o.jsx(Je,{path:"/trade",element:o.jsx($a,{})}),o.jsx(Je,{path:"/journal",element:o.jsx(ja,{})}),o.jsx(Je,{path:"/market",element:o.jsx(Oa,{})}),o.jsx(Je,{path:"/screeners",element:o.jsx(Wa,{})}),o.jsx(Je,{path:"/screeners/screener/:screenerSlug",element:o.jsx(Ga,{})}),o.jsx(Je,{path:"/burn/:slug",element:o.jsx(dl,{})})]}),o.jsx(pl,{})]})})}l.info("🚀 MAIN.JSX is running");Dr.createRoot(document.getElementById("root")).render(o.jsx(gl,{}));
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
